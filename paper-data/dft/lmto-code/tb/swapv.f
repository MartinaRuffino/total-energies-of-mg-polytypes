      subroutine swapV(nl2,nsites,nsp,iax,s)
C- Cludge to swap Vsp with Vps and Vpd with Vdp and Vsd with Vds
C ----------------------------------------------------------------
C Remarks
C  Force s(r1,l1,r2,l2) = s(r2,l2,r1,l1)
C  This is necessary because the hamiltonian generated by, eg,
C  skham, should distinguish V_sp from -V_ps, but does not,
C  and similarly for sd and ds, and pd and dp.
C ----------------------------------------------------------------
      implicit none
C Passed parameters
      integer nl2,nsites,nsp,niax
      parameter (niax=10)
      integer iax(niax,nsites)
      double precision s(nl2,nl2,nsites*nsp**2)
C Local parameters
      integer i,j,lm1,lm2,nsp2,isp,ii,jj
      double precision temp

      if (nl2 < 2) return

      call tcn('swapV')

      nsp2 = nsp**2
      do  100  isp = 1, nsp2
      do  100  i = 1, nsites
        ii = i+(isp-1)*nsites
        j = iax(6,i)
        if (j < i) goto 100
C     ... if iax(6) is not avaiable, use this
C        do  110  j = i, nsites
C          if (iax(1,j) == iax(2,i) .and. iax(2,j) == iax(1,i) .and.
C     .      iax(3,i) == -iax(3,j) .and.
C     .      iax(4,i) == -iax(4,j) .and.
C     .      iax(5,i) == -iax(5,j)) then

            jj = j+(isp-1)*nsites

C --- swap sp,ps ---
            do  120  lm1 = 2, 4
C              print *, ii,jj,lm1
C              print 333, s(lm1,1,ii), s(lm1,1,jj)
C  333         format(2f12.6)
C              if (s(lm1,1,ii)*s(lm1,1,jj) > 0) then
C                print*,' i = ',ii,'  j = ',jj,'  lm1 = ',lm1
C                call rx('bug in swapV')
C              endif
C              if (s(lm1,1,ii)+s(lm1,1,jj) > 1d-8) then
C                print 333, ii,jj,s(lm1,1,ii),s(lm1,1,jj)
C  333           format('swapv: swapped sp for pair',2i4,2f18.6)
C              endif
              temp = s(lm1,1,ii)
              s(lm1,1,ii) = -s(lm1,1,jj)
              s(lm1,1,jj) = -temp
  120       continue
            if (nl2 < 5) goto 100

C --- swap sd,ds ---
            do  130  lm1 = 5, 9
C              print *, ii,jj,lm1
C              print 333, s(lm1,1,ii), s(lm1,1,jj)
C              if (s(lm1,1,ii)*s(lm1,1,jj) < 0) then
C                print*,' i = ',ii,'  j = ',jj,'  lm1 = ',lm1
C                call rx('bug in swapV')
C              endif
              temp = s(lm1,1,ii)
              s(lm1,1,ii) = s(lm1,1,jj)
              s(lm1,1,jj) = temp
  130       continue

C --- swap pd,dp ---
            do  140  lm1 = 5, 9
              do  140  lm2 = 2, 4
C                print *, ii,jj,lm1,lm2
C                print 333, s(lm1,lm2,ii), s(lm1,lm2,jj)
C                if (s(lm1,lm2,ii)*s(lm1,lm2,jj) > 0) then
C                  print*,' i = ',ii,'  j = ',jj,'  lm1 = ',lm1,
C     .              '  lm2 = ',lm2
C                  call rx('bug in swapV')
C                endif
                temp = s(lm1,lm2,ii)
                s(lm1,lm2,ii) = -s(lm1,lm2,jj)
                s(lm1,lm2,jj) = -temp
  140       continue
            goto 100
C         endif
C 110   continue
  100 continue
      call tcx('swapV')
      end
