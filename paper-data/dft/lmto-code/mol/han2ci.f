      SUBROUTINE HAN2CI(TAU1,TAU2,E1,E2,R1,R2,NLM1,NLM2,B1,B2,
     .   CG,INDXCG,JCG,CY,S)
C  INTEGRALS OF PRODUCTS OF HANKEL FCTS ON TWO DIFFERENT SITES,
C  HEADS SUBTRACTED OUT. STRUX RETURNED IN B1,B2.
      IMPLICIT REAL*8 (A-H,P-Z), INTEGER(O)
      DIMENSION S(NLM1,1),CY(1),CG(1),INDXCG(1),JCG(1),DR(3),
     .   TAU1(3),TAU2(3),B1(NLM1,NLM2),B2(NLM1,NLM2),
     .   FKJ1(10),FKJ2(10),FKK(10),FJJ(10),FJK(10)
      PARAMETER (FUZZ=1D-8)
      DO 1 M=1,3
    1 DR(M)=TAU2(M)-TAU1(M)
      L1=LL(NLM1)
      L2=LL(NLM2)
C --- FOR INTEGRALS OUTSIDE SPHERES ---
      CALL WRONKJ(E1,E2,R1,L1,FKK,FKJ1,FJK,FJJ)
      CALL WRONKJ(E2,E1,R2,L2,FKK,FKJ2,FJK,FJJ)
C --- CASE E1.EQ.E2 ---
      IF (DABS(E1-E2) .LT. FUZZ) THEN
        E=(E1+E2)/2
        CALL MSTRXP(E,DR,B1,B2,NLM1,NLM2,NLM1,CG,INDXCG,JCG,CY)
        DO 10 I1=1,NLM1
          LL1=LL(I1)+1
          FAC1=FKJ1(LL1)
          DO 10 I2=1,NLM2
            LL2=LL(I2)+1
            FAC2=FKJ2(LL2)
   10     S(I1,I2)=B1(I1,I2)*(FAC1+FAC2)+B2(I1,I2)
      DO 15 J=1,NLM2
      DO 15 I=1,NLM1
   15 B2(I,J)=B1(I,J)
C --- CASE E1.NE.E2 ---
      ELSE
      CALL MSTRUX(E1,DR,B1,NLM1,NLM2,NLM1,CG,INDXCG,JCG,CY)
      CALL MSTRUX(E2,DR,B2,NLM1,NLM2,NLM1,CG,INDXCG,JCG,CY)
      DO 20 I1=1,NLM1
      LL1=LL(I1)+1
      FAC1=FKJ1(LL1)+1D0/(E2-E1)
      DO 20 I2=1,NLM2
      LL2=LL(I2)+1
      FAC2=FKJ2(LL2)+1D0/(E1-E2)
   20 S(I1,I2)=B1(I1,I2)*FAC2+B2(I1,I2)*FAC1
      ENDIF

c      DO 12 I1=1,NLM1
c   12 PRINT 333, (S(I1,I2),I2=1,NLM2)
c  333 FORMAT(9F8.5)

      END
