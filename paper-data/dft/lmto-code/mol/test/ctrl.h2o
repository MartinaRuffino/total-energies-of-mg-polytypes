% const show=F help=F
% const dimer=1
% const parallel=0 relaxed=1
% const nsp=1 mom=0 rel=T frz=F xcf=3 gga=3 tpan=0 smear=.005
% const verb=30 xcqs=1
% const n=0 s=6 
% const nbas=dimer?6:3 nspec=2
% const minimal=1 link=0
% const dyn=0 relax=0 nit=100 temp=300 time=1000 taup=10 taub=0
% const tstep=2 qrtol1=0.001 qrtol2=0.01
% const lxih=23210 rh=0.6 rfsmh=0.5 rfcuth=1.8
% const lxio=35241 ro=1.2 rfsmo=0.5 rfcuto=1.8
% const fs=0.048377 K=1/0.6333328d-5 amass=1.09716d-3
TESTMOL lmmc --fit h2o
        lmmc --atom h2o
        lmmc -vnit=2 h2o
CLEAN   rm -f ctrl.h2o h1.h2o h2.h2o log.h2o mxi.h2o mxs.h2o p1.h2o p2.h2o pd.h2o save.h2o st.h2o t1.h2o t2.h2o
        rm -f fort.71
HEADER  Water momoner and dimer
CONST   p=12 ndiv=3 nabc=ndiv*p etol=1d-6 convc=1d-5
        dabc=0.3 nbz=60 alfsi=0.003 nalf=16 ndust=2 ncupl=8 nit={nit} 
        dxo=0 dyo=0 dzo=0 dxh1=0 dxh2=0 dyh1=0 dyh2=0 dzh1=0 dzh2=0
        d=1.8306471 angle=104.25448 theta=(90-angle/2)*pi/180
        rsmfa=0
% if minimal==1
        lmxbH=109 lmxbO=219
        eb1=-1 eb2=-2 eb3=-3
% else
%   if link==1
        lmxbH=100 lmxbO=221
        eb1=-0.4 eb2=-5 eb3=-10
%   else
        lmxbH=210 lmxbO=221
        eb1=-0.57829854 eb2=-2.7687088 eb3=-4.6565720
%   endif
% endif
        beta=0.5
        fs=0.048377 K=1/0.6333328d-5
VERS    LMMC-2.0 MOL:3 LM:7 ASA:7 FP:7
TCF     NBISI=12 40 nbz NALF=nalf ADEC=1 NCUPL=ncupl NDUST=ndust
        WZTCF=0
STR     NBISI=12 40 nbz NALF=nalf ADEC=1 NCUPL=ncupl NDUST=ndust
        WZTCF=0
IO      SHOW={show} HELP={help} VERBOS={verb} WKP=F IACTIV=F TIM=F
OPTIONS REL={rel} TPAN={tpan} NSPIN={nsp}
        XCFUN={xcf} GGA={GGA} TCHK=f XCQS={xcqs}
HAM     FORCES=1 XCFUN={xcf} GGA={GGA} ALFSI=alfsi FRZWF={frz}  NSPIN={nsp} REL={rel}
        EBAS=eb1 eb2 eb3 FTMESH=nabc DABC=dabc DQVAL=0
DYN
% if dyn==1|dyn==2|dyn==3
        MD[MODE={dyn} TSTEP={tstep/fs} TEMP={temp/K} TAUP={taup/fs}
           TIME={time/fs} TAUB={taub/fs}]
% elseif relax>0
        MSTAT[MODE={relax} HESS={hess} XTOL={xtol} GTOL={gtol}
              STEP={step} NKILL={nkill}] NIT={nitf}
% endif        
STRUC   NBAS={nbas} NL=4 NSPEC={nspec} ALAT=1 PLAT=p 0 0 0 p 0  0 0 p
SPEC
        ATOM=H Z=1 LMXB=lmxbH LMXA=3 LMXL=2 LXI={lxih} A=0.03 AMASS=1/{amass}
        RSMH=.8,.6 EH=-.5,-.5   # for lmf
% if gga==0
        EREF={xcf==1?-0.95735:(xcf==2?-0.97621:-0.95711)}
% elseif gga==1
        EREF=-0.98943
% elseif gga==2
        EREF=-1
% elseif gga==3
        EREF=-1
% endif
        EXI=-2 -4 -7 -10 -14 
        R={rh} RSMG={rh}*{rfsmh} RINT=7 RCUT={rh}*{rfcuth} RHAM=3
        ISOTOPE=1 NCOR=0
        COLOUR=1 0.2 0.2
           P=1.675 2.3 3.157 4.108
           Q=1 0 0 0  
        MMOM=1 0 0 0              

        ATOM=O Z=8 LMXB=lmxbO LMXA=3 LMXL=3 NR=205 RSMFA=rsmfa A=0.03
        RSMH=.82,.7 EH=-1,-.5 AMASS=16/{amass}
% if gga==0
        EREF={xcf==1?-149.16644:(xcf==2?-149.18217:-149.16093)}
% elseif gga==1
        EREF=-149.60588
% elseif gga==2
        EREF=-150.22188
% elseif gga==3
        EREF=-150.11514
% endif
        LXI={lxio}  EXI=-3   -5 -8   -11 -14
        R={ro} RSMG={ro}*{rfsmo} RINT=7 RCUT={ro}*{rfcuto} RHAM=4 
        ISOTOPE=16 NCOR=2
        COLOUR=0.2 0.2 1
           P=2.79  2.78  3.23 4.11 
           Q=2 4 0 0 
        MMOM=0 2 0 0

% const rc=1
        ATOM=C Z=6 LMXB=lmxbO LMXA=3 LMXL=3 NR=191
% if gga==0
        EREF={xcf==1?-74.97225:(xcf==2?-74.99491:-74.96894)}
% elseif gga==1
        EREF=-75.30533
% elseif gga==2
        EREF=-75.68630
% elseif gga==3
        EREF=-75.62057
% endif
        LXI={lxio}  EXI=-3   -5 -8   -11 -14
        R={rc} RSMG={rc}/2 RINT=7 RCUT={rc}*1.8 RHAM=4
        ISOTOPE=12 COLOUR=0.2 0.2 0.2
           P=2.79  2.78  3.23 4.11 
           Q=2 2 0 0 
        MMOM=0 2 0 0

% const rn=1
        ATOM=N Z=7 LMXB=lmxbO LMXA=3 LMXL=3 NR=191
% if gga==0
        EREF={xcf==1?-108.33651:(xcf==2?-108.36133:-108.33153)}
% elseif gga==1
        EREF=-108.74195
% elseif gga==2
        EREF=-109.22138
% elseif gga==3
        EREF=-109.13555
% endif
        LXI={lxio}  EXI=-3   -5 -8   -11 -14
        R={rn} RSMG={rn}/2 RINT=7 RCUT={rn}*1.8 RHAM=4
        ISOTOPE=14 COLOUR=0.2 1 0.2
           P=2.79  2.78  3.23 4.11 
           Q=2 3 0 0 
        MMOM=0 3 0 0

BZ   NKABC=1,1,1 W=.01

SITE    
% if dimer==1
%   ifdef parallel==0 & relaxed==0
        ATOM=O  POS=  0  0  0                            anti-parallel
        ATOM=H  POS=  {d*cos(theta)} 0   {d*sin(theta)}
        ATOM=H  POS= {-d*cos(theta)} 0   {d*sin(theta)}
        ATOM=O  POS=    {s}  0  0
        ATOM=H  POS= {s}  {d*cos(theta)}   {d*sin(theta)}
        ATOM=H  POS= {s} {-d*cos(theta)}   {d*sin(theta)}
%   elseifd parallel==1 & relaxed==0
        ATOM=O  POS=  0  {-s/2}  0                           parallel
        ATOM=H  POS=  {d*cos(theta)} {-s/2}   {d*sin(theta)}
        ATOM=H  POS= {-d*cos(theta)} {-s/2}   {d*sin(theta)}
        ATOM=O  POS=  0  {s/2}  0
        ATOM=H  POS=  {d*cos(theta)} {s/2}   {d*sin(theta)}
        ATOM=H  POS= {-d*cos(theta)} {s/2}   {d*sin(theta)}
%   elseifd relaxed==1
        ATOM=O  POS=    0.933273   -0.155045   -5.078541
        ATOM=H  POS=    1.180510   -0.189802   -3.226188
        ATOM=H  POS=   -0.855118   -0.513588   -5.225628
        ATOM=O  POS=    2.133769   -0.096108    0.029482
        ATOM=H  POS=    2.887027    1.576007   -0.141373
        ATOM=H  POS=    3.569108   -1.237817   -0.147510
%   endif
% else
%   if relaxed==1
        ATOM=O  POS= 0.061218   -0.003653    0.059945
        ATOM=H  POS= 1.493579    0.014208    1.21594 
        ATOM=H  POS=-1.415687   -0.011348    1.158272
%   else
        ATOM=O  POS=               dxo  dyo               dzo
        ATOM=H  POS=  d*cos(theta)+dxh1 dyh1 d*sin(theta)+dzh1
        ATOM=H  POS= -d*cos(theta)+dxh2 dyh2 d*sin(theta)+dzh2
%   endif
% endif

ITER    CONV=etot CONVC=convc NIT={nit} MIX=A0,b=1,bv=1
START   NIT={nit} CNVG=1d-5
