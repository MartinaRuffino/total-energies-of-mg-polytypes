# This file contains input for KFe2Se2 in various supercells and magnetic configurations.
# Invoke with, e.g.
#   lm  ctrl.kfese -vnit=10 [-vnsp=1 -vzk=18.80 --onesp --band~fn=syml]
#   mpirun -n 6 lmf kfese -vconvc=1e-4 -vbeta=.2 --rhopos -vnit=30 -vasa=0 -vstripe=1 -vmet=5 -vbigbas=11 -vfile=0 -vehmax=-.3
# For conductivity:
#   lmdos -vnk1=16 ctrl.kfese `cat switches-for-lm` -vzk=18.80 --dos:mode=1:totdos:npts=801:window=-.2,.2:vec=1,0,0
# A more complete specification:  GGA in the striped phase
#    lm ctrl.kfese -vnit=10 -vnsp=2 -vnm=0 -vfile=0 -vlxcf=3 -vgga=3 -vstripe=1 -vz4e=$z4e -vzes=$zes --iactiv
# Relaxation, use e.g.  -vnit=1 --rs=3 -vrelax=10 --wpos=pos0
#
#  Notes on structure:
#    z4e = z parameter governing height of Se along z axis.  For expt, use z4e=0.3539
#    zes = same for ES ... zes=0.19 is roughly optimal for any z4e
TESTBXC lmfa kfese --rhopos -vnit=30 -vasa=0 -vstripe=1 -vmet=5 -vbigbas=11 -vfile=0 -vehmax=-.3
        lmf  kfese -vnk1=5 --rhopos -vnit=30 -vasa=0 -vstripe=1 -vmet=5 -vbigbas=11 -vfile=0 -vehmax=-.3
        rm mixm.kfese
        lmf --rs=1,0 kfese -vnk1=5 --rhopos -vnit=30 -vasa=0 -vstripe=1 -vmet=5 -vbigbas=11 -vfile=0 -vehmax=-.3 -vbxcs=1
TSTMBXC lmfa kfese --rhopos -vnit=30 -vasa=0 -vstripe=1 -vmet=5 -vbigbas=11 -vfile=0 -vehmax=-.3
        mpirun -n 6 lmf kfese -vnk1=5 --rhopos -vnit=30 -vasa=0 -vstripe=1 -vmet=5 -vbigbas=11 -vfile=0 -vehmax=-.3
        rm mixm.kfese
        mpirun -n 6 lmf --rs=1,0 kfese -vnk1=5 --rhopos -vnit=30 -vasa=0 -vstripe=1 -vmet=5 -vbigbas=11 -vfile=0 -vehmax=-.3 -vbxcs=1
% const z4e=0.3539 zes=0.19
#  The following specify particular supercells.  Choose one of them:
#  neel=1   Neel structure
#  neel=4   Neel structure doubled in x and in y
#  neel=8   Neel structure quadrupled in x and doubled in y (not implemented)
#  nsc4=1   Supercell that can accomodate one of the following:
#           morder=1:  NM (nsp=1) or FM (nsp=2)
#           morder=2:  Neel
#           morder=3:  Stripe
#           morder=4:  D-Stripe
#           You can also use in this case:
#           kvc=1 for a K vacancy, fevc=5 for a Fe vacancy
#  nsc4=2   Like nsc4=1, but doubled cell along z
#  stripe=1 Striped structure
#  stripe=4 Striped structure doubled in x and in y (not implemented)
% const neel=0 stripe=0 bistripe=0 lbstripe=0
#  shiftZ4e not used now.  Should be 1.
#  Use fm=1 for special purpose that omits Fe2 species, as in nsp=1 case
% const shiftZ4e=1 fm=0
#  In addition, these specify vacancies:
% const kvc=0 fevc=0
#  Use asa=1 for ASA, asa=0 for FP
#  Use file=0 to specify structure from this file, file=1 to specify from site file
% const asa=1 file=1 les=asa nl=4
# FP-specific inputs
% const tppc=3 bigbas=11
# k-points for space group I4/mmm should be equal; also Neel structure (Cmma)
% const nk1=8 nk2=nk1 nk3=nk1 bzj=0
# use lxcf=3 gga=3 for PBE functional, original implementation
% const lxcf=2 gga=0 so=0 bf=0 nsp=2
% const gfmode=1 nit=1 gam=f ccor=t twoc=f nc=0 qssx=0 qssy=0 qssz=0
# Set nonmag=1 if site file has some nonmagnetic elements (extra species Fe3)
% const nonmag=0
# Relax c/a
% const tet=0
% const beta=.30 nl=4 fsmom=.00001*0 nevmx=999
# Change ZK or ZSe for VCA
% const ZFe=26 ZK=19 ZAs=33 ZSe=34
% macro max(a,b) (a>b?a:b)
% const pwmode=0 pwemin=0 pwemax=3 oveps=0
% const kmxa={max(3,{pwmode?pwemax:0})}
VERS    LMASA-6 LMF-6 LM:7 FP:7 ASA:7
IO      VERBOS=31 20 31 HELP=F SHOW=F WKP=F IACTIV=F
# Below for Green's function calculations
GF      MODE={gfmode} GFOPTS=p3
% const elind=-1 wq=1 ws=1 locm=33 b2=beta convc=1e-4
# ITER    MIX=A0,b={beta},b2={b2},w={wq},{ws},locm={locm},elind={elind} CONVC={convc} ELIND={elind} NIT={nit}
# ITER    MIX=B3,b={beta},b2={b2},w={wq},{ws},locm={locm},elind={elind} CONVC={convc} ELIND={elind} NIT={nit}
# ITER     MIX=B3,b={beta},b2={b2},w=1,0,locm={locm},n=5,k=5;B3,b={beta},b2={b2},w=0,1,n=10,k=10
#          CONVC=.00001/10 ELIND={elind} NIT={nit}
# For spin dynamics
ITER    MIX=A1,b={beta},b2={b2},w={wq},{ws},locm={locm},elind={elind} CONVC={convc} ELIND={elind} NIT={nit}
        AMIX=A2,w=0,0,wa=1,fn=ma,n=1,b=1;A0,w=0,0,wa=1,fn=ma,n=4,b=1
EWALD   TOL=1e-10
% const bscal=1 bxcs=0
HAM     QASA=3 GMAX=8 TOL=1E-6 BXCSCAL={bscal<>1|bxcs<>0?(bxcs<1?1:bxcs):0}
%ifdef  lxcf & lxcf2+1
        XCFUN=0,{lxcf},{lxcf2}
%endif
	XCFUN={lxcf} GGA={gga}
        NSPIN={nsp} NONCOL={nc} SO={so} BFIELD={bf}
        PWMODE={pwmode} PWEMIN={pwemin} PWEMAX={pwemax} OVEPS={oveps}
        FORCES={so<>1} ELIND=-1*{elind}
#       Version 6 compatible
#       AUTOBAS[PNU=0 LOC=0 MTO=0 LMTO=0 GW=0 PFLOAT=0,0 xQLOC=.004]
        AUTOBAS[PNU=1*0 LOC=1*0 LMTO=5*0 MTO=2*0 GW=1]
        AUTOBAS[PNU=1 LOC=1 LMTO=1 MTO=1 GW=1]
        AUTOBAS[PNU=1 LOC=2 LMTO=1 MTO=2 GW=1]
# the following line for GW
% const sig=12 modsgp=3 nmins=0 emins=0 nmaxs=0 emaxs=2.5 asig=0.0 bsig=0.09 efits=0
# v7input:
        SIGP[MODE={modsgp} NMIN={nmins} EMIN={emins} NMAX={nmaxs} EMAX={emaxs} A={asig} B={bsig} EFIT={efits}]
        RDSIG={sig} SIGP:{modsgp},{nmins},{emins},{nmaxs},{emaxs},{asig},{bsig},{efits}
        RSRNGE=5
# % const nc=1 sforce=1 sdmod=11 fscal=15 scr=94*0
% const nc=0 sforce=0 sdmod=0 fscal=15 scr=94*0
#  pbe gga used here
OPTIONS SCR={scr} PFLOAT=0 INVIT=F
        ASA[ CCOR={ccor} TWOC={twoc} ELIN=-.2 GAMMA={gam} ]
        NSPIN={nsp} NONCOL={nc}  SDYN: {sforce},{sdmod},{fscal},0,0,0,0   #v6 input
% const optmod=0 lteto=3 lpart=0
% ifdef (optmod==-5|optmod==-6)
OPTICS  MODE={optmod} NPTS=6001 WINDOW=-.3 .3 ESCISS=0 LTET={lteto}
% else
OPTICS  MODE={optmod} NPTS=301 WINDOW=0 1 ESCISS=0 LTET={lteto}
%endif
        PART={lpart}
%ifdef relax
# DYN     MSTAT[MODE=5 HESS=t XTOL=.000 GTOL=0.005 STEP=.005 NKILL=0] NIT={relax}
DYN     MSTAT[MODE=5 HESS=t XTOL=.000 GTOL=0.002 STEP=.005 NKILL=0] NIT={relax}
DYN     MSTAT[MODE=6 HESS=t XTOL=.000 GTOL=0.005 STEP=.005 NKILL=0] NIT={relax}
%endif
DYN     SSTAT[ MODE={sforce?sdmod:-1} SCALE={fscal} TAU=0 MAXT0 ETOL=0]   #v7 input
% ifdef qssx|qssy|qssz
        SS={qssx} {qssy} {qssz} 0
% endif
% const met=asa?1:3
BZ      NKABC={nk1} {nk2} {nk3} TOL=1D-13 METAL={met}
%ifdef met==4
        N=1 W=.005 RANGE=5 NPTS=9001 DOS=-2 0.8 DELEF=.01 # EF=0.177
%endif
        N=0 W=.005 RANGE=5 NPTS=9001 DOS=-0.8 0.8
        SAVDOS=T INVIT=F EFMAX=9 NEVMX={nevmx} TETRA=T
#       COND:0,1,0,0 PUTQP=F NOINV=T
#         FSMOM={fsmom}
        BZJOB={bzj}
% const ef=0 emin=-1.3
        EMESH=20 10 {emin} {ef} .5 .5
        EMESH=15 10 -1.3 {ef} .5 .5
        EMESH=24+1 2 {ef-.001*12} {ef+.001*12} .001 .5
% const modsig=3 ecuts=2 pwb=2.7 pwc=2.2 nkgw=4 nkgw2=nkgw
GW      NKABC={nkgw} {nkgw} {nkgw2} GCUTB={pwb} GCUTX={pwc} MKSIG={modsig} ECUTS={ecuts}
% const rmax=4.2
STR     RMAX={rmax}
%ifdef nc
SYMGRP  E
%endif
# ----------- KFe2Se2, supercells based on the P4/nmm (Neel) structure ---------------------
% char cmpd KFeSe eltc K eltb Fe elta Se
% ifdef cmpd=='KFeSe'
STRUC
% const alat=7.39563231 coa=2*1.79332328 da=0
        ALAT={alat} DALAT={da}
% ifdef (nsc4==1)
        PLAT= 2.0 0.0 0.0   0.0 2.0 0.0    0.5 0.5 0.5*{coa}
        NBAS=20+{les?12:0}-{kvc==1&les==0?1:0}-{fevc>0&les==0?1:0}-{fevc>10&les==0?1:0}
% char  lbl "KFe2Se2, supercell, striped or Neel structure"
% elseifd (nsc4==2)
        PLAT= 2.0 0.0 0.0   0.0 2.0 0.0    0.0 0.0 1.0*{coa}
        NBAS=40+{les?24:0}
% char  lbl "KFe2Se2, not sure"
% elseifd stripe==4
        PLAT= 2.0 -2.0 0.0 2.0 2.0 0.0 0.5 0.5  0.5*{coa}
        NBAS=40+{les?24:0}
% char  lbl "KFe2Se2, striped structure doubled x and y"
% elseifd stripe
        PLAT= 1.0 -1.0 0.0 1.0 1.0 0.0 0.5 0.5  0.5*{coa}
        NBAS=10+{les?6:0}
% char  lbl "KFe2Se2, striped structure, space group I4/mmm (139)"
% elseifd bistripe
        PLAT= 2.0 0.0 0.0   0.0 1.0 0.0    0.5 0.5 0.5*{coa}
        NBAS=10+{les?6:0}
% char  lbl "KFe2Se2, bistriped structure"
% elseifd lbstripe
        PLAT= 2.0 -2.0 0.0 1.0 1.0 0.0 0.5 0.5  0.5*{coa}
        NBAS=20+{les?12:0}
% elseifd neel==8
        PLAT= 4.0 0.0 0.0   0.0 2.0 0.0    0.5 0.5 0.5*{coa}
        NBAS=40+{les?24:0}
% char  lbl "KFe2Se2, Neel structure, quadrupled x and doubled y"
% elseifd neel==4
        PLAT= 2.0 0.0 0.0   0.0 2.0 0.0    0.5 0.5 0.5*{coa}
        NBAS=20+{les?12:0}
% char  lbl "KFe2Se2, tetragonal (Neel) structure, doubled x and y"
% elseifd neel
        PLAT=1.0 0.0 0.0
             0.0 1.0 0.0
             0.5 0.5 0.5*{coa}
        NBAS=5+{les?3:0}
% char  lbl "KFe2Se2, tetragonal (Neel) structure, space group 129 P4/nmm"
% elseifd file
% else
% stop 1 'kfese: no structure specified'
%endif
        NSPEC=3+{nsp==2&fm==0?1:0}+{les?1:0}+{les&kvc?1:0}+{les&(fevc>0)?1:0} NL={nl}
% endif
# ----------- FeSe, Old Neel structure ---------------------
# # % char cmpd FeSe eltc La eltb Fe elta Se
# % ifdef cmpd=='FeSe'
# HEADER  FeSe, Neel, space group 129 P4/nmm
# % const alat=10.0802378 coa=1.02845209 da=0
# STRUC
#           ALAT={alat} DALAT={da}
#           PLAT=0.49752354 -.50000000 0.00000000
#                0.49752354 0.50000000 0.00000000
#                0.00000000 0.00000000 {coa}
#           NBAS=4+{les?4:0} NSPEC=2+{(nc|(nsp==1))?0:1}+{les?1:0} NL={nl}
# % endif
% ifdef tet
        SHEAR=0 0 1 {tet}
% endif
% ifdef file
        FILE=site
SITE    FILE=site
HEADER  KFe2Se2, file structure
%endif
% ifdef lbl
HEADER  {lbl}
% endif
% ifdef shiftZ4e
SITE
% ifdef neel
        ATOM=K1   POS=  0.0  0.0     0.0             # 2a
        ATOM=Fe1  POS=  0.0  0.5     0.25*{coa}      # 4d
% ifdef nsp==2
        ATOM=Fe2  POS=  0.5  0.0     0.25*{coa}      # 4d
%else
        ATOM=Fe1  POS=  0.5  0.0     0.25*{coa}      # 4d
%endif
        ATOM=Se1  POS=  0.0  0.0    {z4e}*{coa}      # 4e
        ATOM=Se1  POS=  0.0  0.0   -{z4e}*{coa}      # 4e
        ATOM=E    POS=  0.0  0.0    {zes}*{coa}
        ATOM=E    POS=  0.0  0.0   -{zes}*{coa}
        ATOM=E    POS=  0.5  0.5           0         # K layer
%endif  # end neel
% ifdef stripe
        ATOM= K1   POS=  0.0  0.0     0.0             # 2a
        ATOM= K1   POS=  1.0  0.0     0.0             # +[1 0 0]
        ATOM= Fe1  POS=   1.0   0.5   0.25*{coa}
        ATOM= Fe1  POS=   0.5   0.0   0.25*{coa}
% ifdef nsp==2
        ATOM= Fe2  POS=   1.0  -0.5   0.25*{coa}
        ATOM= Fe2  POS=   1.5   0.0   0.25*{coa}
%else
        ATOM= Fe1  POS=   1.0  -0.5   0.25*{coa}
        ATOM= Fe1  POS=   1.5   0.0   0.25*{coa}
%endif
        ATOM= Se1  POS=  0.0  0.0    {z4e}*{coa}      # 4e
        ATOM= Se1  POS=  0.0  0.0   -{z4e}*{coa}      # 4e
        ATOM= Se1  POS=  1.0  0.0    {z4e}*{coa}      # 4e
        ATOM= Se1  POS=  1.0  0.0   -{z4e}*{coa}      # 4e
        ATOM= E    POS=  0.0  0.0    {zes}*{coa}
        ATOM= E    POS=  0.0  0.0   -{zes}*{coa}
        ATOM= E    POS=  1.0  0.0    {zes}*{coa}
        ATOM= E    POS=  1.0  0.0   -{zes}*{coa}
        ATOM= E    POS=  0.5  0.5           0         # K layer
        ATOM= E    POS=  1.5  0.5           0         # K layer
SYMGRP  i::(1/2,1/2,0) r2z::(1/2,1/2,0) r2(1,1,0)::(1/2,1/2,0) AFM:E:(0,1,0)
SYMGRP  find  AFM:E:(0,1,0)
%endif     # end stripe------------------
% ifdef bistripe
        ATOM= K1   POS=  0.0  0.0     0.0             # 2a
        ATOM= K1   POS=  1.0  0.0     0.0             # +[1 0 0]
        ATOM= Fe1  POS=  1.0   0.5   0.25*{coa}
        ATOM= Fe1  POS=  1.5   0.0   0.25*{coa}
% ifdef nsp==2
        ATOM= Fe2  POS=  0.0   0.5   0.25*{coa}
        ATOM= Fe2  POS=  0.5   0.0   0.25*{coa}
%else
        ATOM= Fe1  POS=  0.0   0.5   0.25*{coa}
        ATOM= Fe1  POS=  0.5   0.0   0.25*{coa}
%endif
        ATOM= Se1  POS=  0.0  0.0    {z4e}*{coa}      # 4e
        ATOM= Se1  POS=  0.0  0.0   -{z4e}*{coa}      # 4e
        ATOM= Se1  POS=  1.0  0.0    {z4e}*{coa}      # 4e
        ATOM= Se1  POS=  1.0  0.0   -{z4e}*{coa}      # 4e
        ATOM= E    POS=  0.0  0.0    {zes}*{coa}
        ATOM= E    POS=  0.0  0.0   -{zes}*{coa}
        ATOM= E    POS=  1.0  0.0    {zes}*{coa}
        ATOM= E    POS=  1.0  0.0   -{zes}*{coa}
        ATOM= E    POS=  0.5  0.5           0         # K layer
        ATOM= E    POS=  1.5  0.5           0         # K layer
%endif     # end diagnonal bistripe------------------
% ifdef lbstripe
        ATOM= K1   POS=  0.0  0.0     0.0             # 2a
        ATOM= K1   POS=  1.0  0.0     0.0             # +[1 0 0]
        ATOM= K1   POS=   1.0   -1.0     0.0             # 2a
        ATOM= K1   POS=   2.0   -1.0     0.0             # +[1 0 0
        ATOM= Fe1  POS=  1.0   0.5   0.25*{coa}
        ATOM= Fe1  POS=  0.5   0.0   0.25*{coa}
        ATOM= Fe1  POS=  1.0  -0.5   0.25*{coa}
        ATOM= Fe1  POS=  1.5   0.0   0.25*{coa}
% ifdef nsp==2
        ATOM= Fe2  POS=   2.0   -0.5    0.25*{coa}
        ATOM= Fe2  POS=   1.5   -1.0    0.25*{coa}
        ATOM= Fe2  POS=   2.0   -1.5    0.25*{coa}
        ATOM= Fe2  POS=   2.5   -1.0    0.25*{coa}
%else
        ATOM= Fe1  POS=   2.0   -0.5    0.25*{coa}
        ATOM= Fe1  POS=   1.5   -1.0    0.25*{coa}
        ATOM= Fe1  POS=   2.0   -1.5    0.25*{coa}
        ATOM= Fe1  POS=   2.5   -1.0    0.25*{coa}
%endif
        ATOM= Se1  POS=  0.0  0.0    {z4e}*{coa}      # 4e
        ATOM= Se1  POS=  0.0  0.0   -{z4e}*{coa}      # 4e
        ATOM= Se1  POS=  1.0  0.0    {z4e}*{coa}      # 4e
        ATOM= Se1  POS=  1.0  0.0   -{z4e}*{coa}      # 4e
        ATOM= Se1  POS=   1.0   -1.0    {z4e}*{coa}      # 4e
        ATOM= Se1  POS=   1.0   -1.0   -{z4e}*{coa}      # 4e
        ATOM= Se1  POS=   2.0   -1.0    {z4e}*{coa}      # 4e
        ATOM= Se1  POS=   2.0   -1.0   -{z4e}*{coa}      # 4e
        ATOM= E    POS=  0.0  0.0    {zes}*{coa}
        ATOM= E    POS=  0.0  0.0   -{zes}*{coa}
        ATOM= E    POS=  1.0  0.0    {zes}*{coa}
        ATOM= E    POS=  1.0  0.0   -{zes}*{coa}
        ATOM= E    POS=  0.5  0.5           0         # K layer
        ATOM= E    POS=  1.5  0.5           0         # K layer
        ATOM= E    POS=   1.0   -1.0    {zes}*{coa}
        ATOM= E    POS=   1.0   -1.0   -{zes}*{coa}
        ATOM= E    POS=   2.0   -1.0    {zes}*{coa}
        ATOM= E    POS=   2.0   -1.0   -{zes}*{coa}
        ATOM= E    POS=   1.5   -0.5           0         # K layer
        ATOM= E    POS=   2.5   -0.5           0         # K layer
%endif     # end lbstripe------------------

% ifdef neel==4     # begin neel4 ------------------
        ATOM=K1   POS=  0.0  0.0     0.0
        ATOM=K1   POS=  0.0+1.0  0.0     0.0
        ATOM=K1   POS=  0.0  0.0+1.0     0.0
% ifdef kvc    # K vacancy
% ifdef asa
        ATOM=EK   POS=  0.0+1.0  0.0+1.0     0.0
%endif
%else
        ATOM=K1   POS=  0.0+1.0  0.0+1.0     0.0
%endif
% ifdef fevc==5 | (fevc-fevc%10)==50    # Fe vacancy
% ifdef asa
        ATOM=EFe  POS=  0.0  0.5     0.25*{coa}          # replace fe site 5
%endif
%else
        ATOM=Fe1  POS=  0.0  0.5     0.25*{coa}
%endif
% ifdef fevc==6 | (fevc-fevc%10)==60    # Fe2 vacancy
% ifdef asa
        ATOM=EFe  POS=  0.0+1.0  0.5     0.25*{coa}     # replace fe site 6
%endif
%else
        ATOM=Fe1  POS=  0.0+1.0  0.5     0.25*{coa}
%endif
        ATOM=Fe1  POS=  0.0  0.5+1.0     0.25*{coa}     # site 7 same class as site 6
%ifdef (fevc==8)    # Fe3 vacancy
%ifdef asa
        ATOM=EFe  POS=  0.0+1.0  0.5+1.0     0.25*{coa}  # replace fe site 8
%endif
%else
        ATOM=Fe1  POS=  0.0+1.0  0.5+1.0     0.25*{coa}
%endif
% ifdef nsp==2
        ATOM=Fe2  POS=  0.5  0.0     0.25*{coa}
        ATOM=Fe2  POS=  0.5+1.0  0.0     0.25*{coa}
        ATOM=Fe2  POS=  0.5  0.0+1.0     0.25*{coa}
        ATOM=Fe2  POS=  0.5+1.0  0.0+1.0     0.25*{coa}
%else
        ATOM=Fe1  POS=  0.5  0.0     0.25*{coa}
        ATOM=Fe1  POS=  0.5+1.0  0.0     0.25*{coa}
        ATOM=Fe1  POS=  0.5  0.0+1.0     0.25*{coa}
        ATOM=Fe1  POS=  0.5+1.0  0.0+1.0     0.25*{coa}
%endif
        ATOM=Se1  POS=  0.0  0.0    {z4e}*{coa}      # 4e
        ATOM=Se1  POS=  0.0  0.0   -{z4e}*{coa}      # 4e
        ATOM=Se1  POS=  0.0+1.0  0.0    {z4e}*{coa}      # 4e
        ATOM=Se1  POS=  0.0+1.0  0.0   -{z4e}*{coa}      # 4e
        ATOM=Se1  POS=  0.0  0.0+1.0    {z4e}*{coa}      # 4e
        ATOM=Se1  POS=  0.0  0.0+1.0   -{z4e}*{coa}      # 4e
        ATOM=Se1  POS=  0.0+1.0  0.0+1.0    {z4e}*{coa}      # 4e
        ATOM=Se1  POS=  0.0+1.0  0.0+1.0   -{z4e}*{coa}      # 4e
        ATOM=E    POS=  0.0  0.0    {zes}*{coa}
        ATOM=E    POS=  0.0  0.0   -{zes}*{coa}
        ATOM=E    POS=  0.5  0.5           0         # K layer
        ATOM=E    POS=  0.0+1.0  0.0    {zes}*{coa}
        ATOM=E    POS=  0.0+1.0  0.0   -{zes}*{coa}
        ATOM=E    POS=  0.5+1.0  0.5           0         # K layer
        ATOM=E    POS=  0.0  0.0+1.0    {zes}*{coa}
        ATOM=E    POS=  0.0  0.0+1.0   -{zes}*{coa}
        ATOM=E    POS=  0.5  0.5+1.0           0         # K layer
        ATOM=E    POS=  0.0+1.0  0.0+1.0    {zes}*{coa}
        ATOM=E    POS=  0.0+1.0  0.0+1.0   -{zes}*{coa}
        ATOM=E    POS=  0.5+1.0  0.5+1.0           0         # K layer
%endif  # end neel4 ------------------

% ifdef (nsc4==1|nsc4==2)  # begin nsc4---------------------------------
        ATOM=K1   POS=  0.0   0.0   0.0
        ATOM=K1   POS=  1.0   0.0   0.0
        ATOM=K1   POS=  0.0   1.0   0.0
%  ifdef kvc    # K vacancy
%    ifdef asa
        ATOM=EK   POS=  1.0   1.0   0.0
%    endif
%  else
        ATOM=K1   POS=  1.0   1.0   0.0
%  endif

%ifdef (nsc4==2)
        ATOM=K1   POS=  0.5   0.5   0.5*{coa}
        ATOM=K1   POS=  1.5   0.5   0.5*{coa}
        ATOM=K1   POS=  0.5   1.5   0.5*{coa}
        ATOM=K1   POS=  1.5   1.5   0.5*{coa}
%endif

%ifdef (morder==1|nsp==1)  # FM in Plane
        ATOM=Fe1  POS=  0.5   0.0     0.25*{coa}
        ATOM=Fe1  POS=  1.5   0.0     0.25*{coa}
%   ifdef fevc==5 | (fevc-fevc%10)==50    # Fe vacancy
%     ifdef asa
        ATOM=EFe  POS=  0.0   0.5     0.25*{coa}          # replace fe site 5
%     endif
%   else
        ATOM=Fe1  POS=  0.0   0.5     0.25*{coa}
%   endif
        ATOM=Fe1  POS=  1.0   0.5     0.25*{coa}
        ATOM=Fe1  POS=  0.5   1.0     0.25*{coa}
        ATOM=Fe1  POS=  1.5   1.0     0.25*{coa}
        ATOM=Fe1  POS=  0.0   1.5     0.25*{coa}
        ATOM=Fe1  POS=  1.0   1.5     0.25*{coa}

%endif
%ifdef (morder==2)  # Neel in Plane
        ATOM=Fe1  POS=  0.5   0.0     0.25*{coa}

%   ifdef (fevc%10)==4 | (fevc-fevc%10)==40    # Fe vacancy
%     ifdef asa
        ATOM=EFe  POS=  1.5   0.0     0.25*{coa}          # replace fe site 4
%     endif
%   else
        ATOM=Fe1  POS=  1.5   0.0     0.25*{coa}
%   endif
%   ifdef (fevc%10)==5 | (fevc-fevc%10)==50    # Fe vacancy
%     ifdef asa
        ATOM=EFe  POS=  0.0   0.5     0.25*{coa}          # replace fe site 5
%     endif
%   else
        ATOM=Fe2  POS=  0.0   0.5     0.25*{coa}
%   endif
        ATOM=Fe2  POS=  1.0   0.5     0.25*{coa}
        ATOM=Fe1  POS=  0.5   1.0     0.25*{coa}
        ATOM=Fe1  POS=  1.5   1.0     0.25*{coa}
        ATOM=Fe2  POS=  0.0   1.5     0.25*{coa}
        ATOM=Fe2  POS=  1.0   1.5     0.25*{coa}

%endif
%ifdef (morder==3)  # Stripe in Plane
        ATOM=Fe1  POS=  0.5   0.0     0.25*{coa}
        ATOM=Fe2  POS=  1.5   0.0     0.25*{coa}
%   ifdef fevc==5 | (fevc-fevc%10)==50    # Fe vacancy
%     ifdef asa
        ATOM=EFe  POS=  0.0   0.5     0.25*{coa}          # replace fe site 5
%     endif
%   else
        ATOM=Fe2  POS=  0.0   0.5     0.25*{coa}
%   endif
        ATOM=Fe1  POS=  1.0   0.5     0.25*{coa}
        ATOM=Fe2  POS=  0.5   1.0     0.25*{coa}
        ATOM=Fe1  POS=  1.5   1.0     0.25*{coa}
        ATOM=Fe1  POS=  0.0   1.5     0.25*{coa}
        ATOM=Fe2  POS=  1.0   1.5     0.25*{coa}

%endif
%ifdef (morder==4)  # D-biStripe in Plane
        ATOM=Fe1  POS=  0.5   0.0     0.25*{coa}
        ATOM=Fe2  POS=  1.5   0.0     0.25*{coa}
%   ifdef fevc==5 | (fevc-fevc%10)==50    # Fe vacancy
%     ifdef asa
        ATOM=EFe  POS=  0.0   0.5     0.25*{coa}          # replace fe site 5
%     endif
%   else
        ATOM=Fe2  POS=  0.0   0.5     0.25*{coa}
%   endif
        ATOM=Fe1  POS=  1.0   0.5     0.25*{coa}
        ATOM=Fe1  POS=  0.5   1.0     0.25*{coa}
        ATOM=Fe2  POS=  1.5   1.0     0.25*{coa}
        ATOM=Fe2  POS=  0.0   1.5     0.25*{coa}
        ATOM=Fe1  POS=  1.0   1.5     0.25*{coa}

%endif

%ifdef (nsc4==2) # ----Bigger cell +8 Fe Atoms----begin
%ifdef (morder==1)
%ifdef (afmz==0|nsp==1) #  P-FM  Z-FM
        ATOM=Fe1  POS=  0.5   0.0     0.75*{coa}
        ATOM=Fe1  POS=  1.5   0.0     0.75*{coa}
        ATOM=Fe1  POS=  0.0   0.5     0.75*{coa}
        ATOM=Fe1  POS=  1.0   0.5     0.75*{coa}
        ATOM=Fe1  POS=  0.5   1.0     0.75*{coa}
        ATOM=Fe1  POS=  1.5   1.0     0.75*{coa}
        ATOM=Fe1  POS=  0.0   1.5     0.75*{coa}
        ATOM=Fe1  POS=  1.0   1.5     0.75*{coa}
%else            #  P-FM  Z-AFM
        ATOM=Fe2  POS=  0.5   0.0     0.75*{coa}
        ATOM=Fe2  POS=  1.5   0.0     0.75*{coa}
        ATOM=Fe2  POS=  0.0   0.5     0.75*{coa}
        ATOM=Fe2  POS=  1.0   0.5     0.75*{coa}
        ATOM=Fe2  POS=  0.5   1.0     0.75*{coa}
        ATOM=Fe2  POS=  1.5   1.0     0.75*{coa}
        ATOM=Fe2  POS=  0.0   1.5     0.75*{coa}
        ATOM=Fe2  POS=  1.0   1.5     0.75*{coa}
%endif
%endif
%ifdef (morder==2)
%ifdef (afmz==0) #  P-Neel Z-FM
        ATOM=Fe1  POS=  0.5   0.0     0.75*{coa}
        ATOM=Fe1  POS=  1.5   0.0     0.75*{coa}
        ATOM=Fe2  POS=  0.0   0.5     0.75*{coa}
        ATOM=Fe2  POS=  1.0   0.5     0.75*{coa}
        ATOM=Fe1  POS=  0.5   1.0     0.75*{coa}
        ATOM=Fe1  POS=  1.5   1.0     0.75*{coa}
        ATOM=Fe2  POS=  0.0   1.5     0.75*{coa}
        ATOM=Fe2  POS=  1.0   1.5     0.75*{coa}
%else            #  P-Neel Z-AFM
        ATOM=Fe2  POS=  0.5   0.0     0.75*{coa}
        ATOM=Fe2  POS=  1.5   0.0     0.75*{coa}
        ATOM=Fe1  POS=  0.0   0.5     0.75*{coa}
        ATOM=Fe1  POS=  1.0   0.5     0.75*{coa}
        ATOM=Fe2  POS=  0.5   1.0     0.75*{coa}
        ATOM=Fe2  POS=  1.5   1.0     0.75*{coa}
        ATOM=Fe1  POS=  0.0   1.5     0.75*{coa}
        ATOM=Fe1  POS=  1.0   1.5     0.75*{coa}
%endif
%endif
%ifdef (morder==3)
%ifdef (afmz==0) # P-Stripe Z-FM
        ATOM=Fe1  POS=  0.5   0.0     0.75*{coa}
        ATOM=Fe2  POS=  1.5   0.0     0.75*{coa}
        ATOM=Fe2  POS=  0.0   0.5     0.75*{coa}
        ATOM=Fe1  POS=  1.0   0.5     0.75*{coa}
        ATOM=Fe2  POS=  0.5   1.0     0.75*{coa}
        ATOM=Fe1  POS=  1.5   1.0     0.75*{coa}
        ATOM=Fe1  POS=  0.0   1.5     0.75*{coa}
        ATOM=Fe2  POS=  1.0   1.5     0.75*{coa}
%else            # P-Stripe Z-AFM
        ATOM=Fe2  POS=  0.5   0.0     0.75*{coa}
        ATOM=Fe1  POS=  1.5   0.0     0.75*{coa}
        ATOM=Fe1  POS=  0.0   0.5     0.75*{coa}
        ATOM=Fe2  POS=  1.0   0.5     0.75*{coa}
        ATOM=Fe1  POS=  0.5   1.0     0.75*{coa}
        ATOM=Fe2  POS=  1.5   1.0     0.75*{coa}
        ATOM=Fe2  POS=  0.0   1.5     0.75*{coa}
        ATOM=Fe1  POS=  1.0   1.5     0.75*{coa}
%endif
%endif
%ifdef (morder==4)
%ifdef (afmz==0) # P-D-biStripe Z-FM
        ATOM=Fe1  POS=  0.5   0.0     0.75*{coa}
        ATOM=Fe2  POS=  1.5   0.0     0.75*{coa}
        ATOM=Fe2  POS=  0.0   0.5     0.75*{coa}
        ATOM=Fe1  POS=  1.0   0.5     0.75*{coa}
        ATOM=Fe1  POS=  0.5   1.0     0.75*{coa}
        ATOM=Fe2  POS=  1.5   1.0     0.75*{coa}
        ATOM=Fe2  POS=  0.0   1.5     0.75*{coa}
        ATOM=Fe1  POS=  1.0   1.5     0.75*{coa}
%else           # P-D-biStripe Z-FM
        ATOM=Fe2  POS=  0.5   0.0     0.75*{coa}
        ATOM=Fe1  POS=  1.5   0.0     0.75*{coa}
        ATOM=Fe1  POS=  0.0   0.5     0.75*{coa}
        ATOM=Fe2  POS=  1.0   0.5     0.75*{coa}
        ATOM=Fe2  POS=  0.5   1.0     0.75*{coa}
        ATOM=Fe1  POS=  1.5   1.0     0.75*{coa}
        ATOM=Fe1  POS=  0.0   1.5     0.75*{coa}
        ATOM=Fe2  POS=  1.0   1.5     0.75*{coa}
%endif
%endif
%endif   # ----Bigger cell +8 Fe Atoms----end

        ATOM=Se1  POS=  0.0   0.0    {z4e}*{coa}
        ATOM=Se1  POS=  1.0   0.0    {z4e}*{coa}
        ATOM=Se1  POS=  0.0   1.0    {z4e}*{coa}
        ATOM=Se1  POS=  1.0   1.0    {z4e}*{coa}
        ATOM=Se1  POS=  0.0   0.0   -{z4e}*{coa}
        ATOM=Se1  POS=  1.0   0.0   -{z4e}*{coa}
        ATOM=Se1  POS=  0.0   1.0   -{z4e}*{coa}
        ATOM=Se1  POS=  1.0   1.0   -{z4e}*{coa}
%ifdef (nsc4==2) # ----Bigger cell +8 Se Atoms----begin
        ATOM=Se1  POS=  0.5   0.5    {0.5+z4e}*{coa}
        ATOM=Se1  POS=  1.5   0.5    {0.5+z4e}*{coa}
        ATOM=Se1  POS=  0.5   1.5    {0.5+z4e}*{coa}
        ATOM=Se1  POS=  1.5   1.5    {0.5+z4e}*{coa}
        ATOM=Se1  POS=  0.5   0.5    {0.5-z4e}*{coa}
        ATOM=Se1  POS=  1.5   0.5    {0.5-z4e}*{coa}
        ATOM=Se1  POS=  0.5   1.5    {0.5-z4e}*{coa}
        ATOM=Se1  POS=  1.5   1.5    {0.5-z4e}*{coa}
%endif           # ----Bigger cell +8 Se Atoms----end

%ifdef asa       # ASA E atoms ----begin
        ATOM=E    POS=  0.5   0.5               0
        ATOM=E    POS=  1.5   0.5               0
        ATOM=E    POS=  0.5   1.5               0
        ATOM=E    POS=  1.5   1.5               0
        ATOM=E    POS=  0.0   0.0     {zes}*{coa}
        ATOM=E    POS=  1.0   0.0     {zes}*{coa}
        ATOM=E    POS=  0.0   1.0     {zes}*{coa}
        ATOM=E    POS=  1.0   1.0     {zes}*{coa}
        ATOM=E    POS=  0.0   0.0    -{zes}*{coa}
        ATOM=E    POS=  1.0   0.0    -{zes}*{coa}
        ATOM=E    POS=  0.0   1.0    -{zes}*{coa}
        ATOM=E    POS=  1.0   1.0    -{zes}*{coa}
%ifdef (nsc4==2) # ----Bigger cell +12 E Atoms----begin
        ATOM=E    POS=  1.0   1.0          0.5*{coa}
        ATOM=E    POS=  0.0   1.0          0.5*{coa}
        ATOM=E    POS=  1.0   0.0          0.5*{coa}
        ATOM=E    POS=  0.0   0.0          0.5*{coa}
        ATOM=E    POS=  0.5   0.5    {0.5+zes}*{coa}
        ATOM=E    POS=  1.5   0.5    {0.5+zes}*{coa}
        ATOM=E    POS=  0.5   1.5    {0.5+zes}*{coa}
        ATOM=E    POS=  1.5   1.5    {0.5+zes}*{coa}
        ATOM=E    POS=  0.5   0.5    {0.5-zes}*{coa}
        ATOM=E    POS=  1.5   0.5    {0.5-zes}*{coa}
        ATOM=E    POS=  0.5   1.5    {0.5-zes}*{coa}
        ATOM=E    POS=  1.5   1.5    {0.5-zes}*{coa}
%endif           # ----Bigger cell +12 E Atoms----end
%endif           # ASA E atoms ----end
% endif  # end (nsc4==1|nsc4==2) ----end
% endif  # end shiftz4e
%ifdef asa
SPEC
#         SCLWSR=1 OMAX1=.16  .26 OMAX2=.5 .5
% ifdef cmpd=='KFeSe'
        ATOM=K1   Z={ZK}  R=4.11     LMX=3 IDXDN=1 1 1 2 IDMOD=1 1 1 1 P=4.5,4.30,3.2,4.1
%endif
% cvar cmpd=='KFeSe' r=2.66
% cvar cmpd=='FeSe'  r=2.50
        ATOM=Fe1  Z={ZFe} R={r}      LMX=2 IDXDN=1 1 1 GRP2=1*{(sdmod==0&kvc==0&fevc==0&fm==0)?1:0}  CSTRMX=1
#       HFACB=.8
% ifdef (nsp==2&fm==0)
        ATOM=Fe2  Z={ZFe} R={r}      LMX=2 IDXDN=1 1 1 GRP2=-1*{(sdmod==0&kvc==0&fevc==0&fm==0)?1:0}
#       HFACB=.8
% endif
        ATOM=Se1  Z={ZSe} R=2.66     LMX=2 IDXDN=1 1 2  CSTRMX=1
% ifdef les
% cvar cmpd=='KFeSe' r=2.1171
% cvar cmpd=='FeSe'  r=2.4488
        ATOM=E    Z=0    R={r}  LMX=2 IDXDN=1 1 2
% ifdef kvc
        ATOM=EK   Z=0    R={4.11}  LMX=2 IDXDN=1 1 2
% endif
% ifdef (fevc>0)
        ATOM=EFe  Z=0    R={r}     LMX=2 IDXDN=1 1 2
% endif
% endif
%else
% const nelt=3
% includo semi.mater
SPEC
#    SCLWSR=1 OMAX1=0 0 0 OMAX2=.5 .5
% ifdef cmpd=='KFeSe'
% ifdef zk==0
     ATOM=K1  Z={ZK} R=0 LMX=2 A=.025 EREF=0
% ifdef base
          {base}
% endif
% else
     ATOM=K1  Z={ZK} R=3.5 LMX=3 A=.025 EREF={erefc}
#     KMXA=5 LMXA=5 RSMA=1.2
%iffile specialspecc
%  echo including file specialspecc in SPEC category
%  include specialspecc
%endif
         {strnc}
% ifdef basc
          {basc}
% endif
%endif
% endif
% cvar cmpd=='KFeSe' r=2.4
% cvar zk==0 r=2.2
% cvar cmpd=='FeSe'  r=2.3
        ATOM=Fe1 Z={ZFe} R={r} A=.025 EREF={erefb} # NR=379
%iffile specialspecb
%  echo including file specialspecb in SPEC category
%  include specialspecb
%endif
         {strnb}
% ifdef basb
          {basb}
% endif
  MMOM=0,0,2 KMXA={kmxa}
% ifdef nsp==2
          ATOM=Fe2 Z={ZFe} R={r} A=.025 EREF={erefb}#  NR=379
%iffile specialspecb
%  echo including file specialspecb in SPEC category
%  include specialspecb
%endif
         {strnb}
% ifdef basb
          {basb}
% endif
  MMOM=0,0,-2 KMXA={kmxa}
% endif
% var r=2.3
% cvar zk==0 r=2.2
          ATOM=Se1  Z={ZSe} R={r} A=.025 EREF={erefa}
%iffile specialspeca
%  echo including file specialspeca in SPEC category
%  include specialspeca
%endif
         {strna}
% ifdef basa
          {basa}
% endif
  KMXA={kmxa}
% ifdef nonmag
          ATOM=Fe3 Z={ZFe} R=2.16  A=.025 EREF={erefb}
%iffile specialspecb
%  echo including file specialspecb in SPEC category
%  include specialspecb
%endif
         {strnb}
% ifdef basb
          {basb}
% endif
  MMOM=0,0,0 KMXA={kmxa}
% endif
% ifdef les
          ATOM=E  Z= 0 R=2.165*{(les>10)?0:1} LMX=2 A=.025
         {strne}
% ifdef base
          {base}
% endif
% endif
%endif
SYMGRP  find
# PLANE NORMAL= 1 -1 0
START   BEGMOM={nit==0} CNTROL={nit==0}
%iffile qasa
%includo qasa
%exit
%ifdef
%ifdef asa
% endif
