<!-- saved file -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
 <title> Spectral function implemented in lmgf </title>
<style><!--P{font-size : medium;} --></style>
</head>
<body bgcolor="#cccccc">

<h1><b><font size="+2">Spectral function calculations with lmgf </font></b></h1>

<p> Spectral function was implemented in <b>lmgf</b> v7.10 by Bhalchandra Pujari and Kirill Belashchenko (<font size="+1"><tt>belashchenko@unl.edu</tt></font>). The details of the theory in the CPA case can be found in
<pre>I. Turek, V. Drchal, J. Kudrnovský, M. Šob, P. Weinberger. <i>Electronic structure of disordered alloys, surfaces and interfaces.</i> Kluwer academic publishers (1997), see Eqs. (4.25)-(4.29).
</pre></p>
<!--Following documentaion is intended to give user a step-by-step guide to the details of calculations.-->
<hr>
<li><a href="#calculations">How to calculate spectral functions?</a></li>
<li><a href="#vis">Plotting of the spectral function</a></li>
<li><a href="#fort">Site-resolved spectral function</a></li>
<li><a href="#issues">Know issues</a></li>

<p>
<a name="calculations"></a><font color="#858005"></font></p><h3><font color="#858005">How to calculate spectral functions?</font></h3>
The spectral function can be calculated both with and without CPA. The calculation is performed in 3 steps:<br>
<ol>
<li><i>Charge self consistency.</i>  (The spectral function can be calculated for any potential, but it is usual to work with the self-consistent one).</li>
<li><i>CPA self-consistency in the coherent interactor</i> &Omega; (CPA only).  Since &Omega; is energy dependent, it has to be calculated for the energy 
points where the spectral function is needed.  For drawing spectral functions this is usually a uniform mesh of points close to the real axis.</li>
<li><i>Calculation of the spectral function on some contour, usually a uniform mesh close to the real axis</i></li>
</ol></i>

<p>
<font color="#bb3300"><i> Charge self consistency</i></font> is performed in the usual manner, for example with the following options:
<pre>BZ       EMESH=31 <b>10</b> -.9 0 .5 .0
GF   &nbsp;   MODE=1 <b>DLM=12</b> GFOPTS=p3;omgmix=1.0;padtol=1d-3;omgtol=1d-5;lotf;nitmax=50
</pre>
Note the <font size="+1"><tt>EMESH</tt></font> mode (contour type) is elliptical (type <font size="+1"><tt>10</tt></font>). If CPA is used, the coherent interactors &#937; for all CPA sites are also iterated to self-consistency during this calculation, but this is done for the complex energy points on the elliptical contour. The following additional step is needed in this case to obtain self-consistent &#937; at those points where the spectral function will be calculated.

<p>
<font color="#bb3300"><i>Omega self-consistency</i></font> is turned on by setting <font size="+1"><tt>DLM=32</tt></font>. In this mode only &#937; for each CPA site is converged, while the atomic charges are left unchanged. It is important to converge &Omega; to high precision. Typically <font size="+1"><tt>omgtol=1d-6</tt></font> is a good criterion. The contour type should be set to <font size="+1"><tt>2</tt></font>. Example input for this step is
   <pre>BZ       EMESH=150 <b>2</b> -.25 .25  .0005  0
GF   &nbsp;   MODE=1 <b>DLM=32</b>  GFOPTS=p3;omgmix=1.0;padtol=1d-3;<b>omgtol=1d-6;lotf</b>;nitmax=50
   </pre>
The highlighted parameters are of particular importance. <font size="+1"><tt>lotf</tt></font> is required to iterate &#937; for convergence (and it is recommended to keep it enabled in all CPA calculations, including charge self-consistency). It is also necessary to monitor the output file (set <font size="+1"><tt>--pr41</tt></font>) and make sure that the required precision has been achieved for all energy points. If convergence appears to be problematic, try to start with a larger imaginary part for the complex energy or reduce the mixing parameter <font size="+1"><tt>omgmix</tt></font>.

<p>
<font color="#bb3300"><i> Calculation of the spectral function </i></font> should be done with <font size="+1"><tt>EMESH</tt></font> set to the same mesh as used for &Omega; self-consistency, e.g.
<pre>BZ       EMESH=150 <b>2</b> -.25 .25  .0005  0
GF  &nbsp;    MODE=1 <b>DLM=12</b> GFOPTS=p3;omgmix=1.0;padtol=1d-3;<b>specfun</b>
</pre>
<b>Important</b>: If there are sites treated in CPA, the contour specified by <font size="+1"><tt>EMESH</tt></font> should be kept exactly as in the previous step when CPA self-consistency was performed.

<p>
In order to start the calculation, invoke <font size="+1"><tt>lmgf</tt></font> with the <font size="+1"><tt>--band</tt></font> flag referring to the symmetry-line file (same format as used for band structure calculation with <font size="+1"><tt>lm</tt></font>):

<pre> <font size="+1"><tt>lmgf «sys» --band:fn=syml</tt></font> </pre>
 where «sys» is the extension of the <font size="+1"><tt>ctrl</tt></font> file. Once completed, the program will generate a <font size="+1"><tt>spf.«sys»</tt></font> file containing the complete spectral function along the lines given in the <font size="+1"><tt>syml.«sys»</tt></font> file. Other options included with <font size="+1"><tt>--band</tt></font> are currently not used.

<p><a name="vis"></a><font color="#858005"></font></p><h3><font color="#858005">Plotting of the spectral function</font></h3>

Upon successful completion of calculation <font size="+1"><tt>spf.«sys»  </tt></font> file will be generated. The file has the following format:<br>
<!--
<table class="image" align="right" style="border:1px solid grey">
<tbody><tr><td>
<img src="NiMnSb_Beff_3_cbfactor4_DN.png" alt="Example of spectral function" width="300" align="right">
</td></tr>
<tr><td class="caption" align="middle"> <font size="-2">Example of spectral function. <br>System: NiMnSb, Majority channel. (<tt>Beff=3</tt>) </font></td></tr>
</tbody></table>
-->
<pre>ZP        KP         SF_UP         SF_DN
.
.
-0.250   0.137      5.708839      4.742153
-0.250   0.160     10.658114      4.844647
.
.</pre>
where <font size="+1"><tt>ZP</tt></font> are the points on the energy contour,
<font size="+1"><tt>KP</tt></font> are the points of the K-mesh and <font size="+1"><tt>SF_UP, SF_DN</tt></font> are the spectral functions for Up
and Down channel respectively. The very first line of the file indicate the location of the high symmetry points of the Brillouin zone. User can utilize
this information to visualize the spectral function using any desired graphics package. A small bash utility, <font color="#bb3300"><b>SpectralFunction.sh</b></font>, is given for the sake
of convenience. This bash script uses Gnuplot to view and save the spectral function. Users with standard Linux/unix distro should be able to use it without
special prerequisites. Typical output of the script is shown in the figure. Please see <font size="+1"><tt>SpectralFunction.sh -h</tt></font> for usage. (The file spf.«sys» should be renamed specfun.«sys» to be read by this script. See below why.)

<p>
<a name="fort"></a><font color="#858005"></font></p><h3><font color="#858005">Site-resolved spectral functions</font></h3>
Site-resolved spectral functions can be obtained by including the option <font size="+1"><tt>specfr</tt></font> in <font size="+1"><tt>GFOPTS</tt></font>. (It supersedes the option <font size="+1"><tt>specfun</tt></font>.)
A series of output files will then be generated, which contain the <font color="#bb3300"> spectral function on each basis site </font>. The file names are <font size="+1"><tt>spfN.«sys»</tt></font>, where N is the index of the site. The format of this file is the same as for <font size="+1"><tt>spf.«sys»</tt></font>, and it can be also plotted using the <font color="#bb3300"><b>SpectralFunction.sh</b></font> script (first rename to specfun.«sys»).

<p><a name="issues"></a><font color="#858005"></font></p><h3><font color="#858005">Notes</font></h3>
<ul>
<li> Spectral function calculations can be run with MPI parallelization. </li>
</ul>

</body></html>
