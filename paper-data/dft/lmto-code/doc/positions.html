<H1><B><FONT size="+0">Specification of lattice coordinates and site positions</FONT></B></H1>

Primitive lattice translation vectors <FONT size="+1"><tt>P</tt></FONT> and site position vectors
<FONT size="+1"><tt>pos</tt></FONT> specify the structural data.
In this code, both are supplied in dimensionless form: the true vectors are scaled by <FONT size="+1"><tt><i>a</i></tt></FONT>,
where <FONT size="+1"><tt><i>a</i></tt></FONT> is the lattice constant in atomic units (0.529A).
Thus <FONT size="+1"><tt><i>a</i></tt></FONT>, <FONT size="+1"><tt>P</tt></FONT> and 
<FONT size="+1"><tt>pos</tt></FONT> collectively specify the crystalline lattice.

By default these parameters are supplied through the input file, <FONT size="+1"><tt>ctrl.<i>ext</i></tt></FONT>.
But there are alternative modes, as described here.

<P> <FONT color="#bb3300"><I>Default</I>.</FONT>

By default <FONT size="+1"><tt><i>a</i></tt></FONT> and <FONT size="+1"><tt>P</tt></FONT> 
are read from the input file, in category <FONT size="+1"><tt>STRUC</tt></FONT>, using the <FONT size="+1"><tt>ALAT=</tt></FONT> and
<FONT size="+1"><tt>PLAT=</tt></FONT> tags, <i>viz</i>:
<pre> 
STRUC ALAT=<i>a</i> PLAT= P<sub>11</sub> P<sub>12</sub> P<sub>13</sub>  P<sub>21</sub> P<sub>22</sub> P<sub>23</sub>  P<sub>31</sub> P<sub>32</sub> P<sub>33</sub>
</pre> 
Here <FONT size="+1"><tt>P<sub>ij</sub></tt></FONT> is the <i>i</i><sup>th</sup> Cartesian component of lattice vector <i>j</i>. 
Alternatively <FONT size="+1"><tt><i>a</i></tt></FONT> and <FONT size="+1"><tt>P</tt></FONT> can both
be read from a separate <A href="#sitefile">site file</A>.

<P>

Also by default, site positions are read through the input file, in the
<FONT size="+1"><tt>SITE</tt></FONT> category through either the <FONT size="+1"><tt>POS</tt></FONT> or <FONT size="+1"><tt>XPOS</tt></FONT> tags:
<pre> 
SITE
  ATOM=<i>name</i>  POS= x y z 
  ATOM=<i>name</i> XPOS= x y z 
</pre> 
There must be as many tags <FONT size="+1"><tt>ATOM POS</tt></FONT> or <FONT size="+1"><tt>ATOM XPOS</tt></FONT> 
as there are sites.  (You can use <FONT size="+1"><tt>POS</tt></FONT> for some sites and and <FONT size="+1"><tt>XPOS</tt></FONT> for others, but the file may be confusing to read!)
<FONT size="+1"><tt>POS</tt></FONT> and <FONT size="+1"><tt>XPOS</tt></FONT> 
supply the same information, but
<i>x,y,z</i> associated with <FONT size="+1"><tt>POS</tt></FONT> are
in Cartesian coordinates, whereas those associated with <FONT
size="+1"><tt>XPOS</tt></FONT> are in multiples of <FONT
size="+1"><tt>STRUC_PLAT</tt></FONT>: i.e. the corresponding Cartesian coordinates are 
<pre>
   <i>x</i><sub>Cart</sub> = <i>x</i>&middot;P<sub>11</sub> + <i>y</i>&middot;P<sub>21</sub> + <i>z</i>&middot;P<sub>31</sub>
   <i>y</i><sub>Cart</sub> = <i>x</i>&middot;P<sub>12</sub> + <i>y</i>&middot;P<sub>22</sub> + <i>z</i>&middot;P<sub>32</sub>
   <i>z</i><sub>Cart</sub> = <i>x</i>&middot;P<sub>13</sub> + <i>y</i>&middot;P<sub>23</sub> + <i>z</i>&middot;P<sub>33</sub>
</pre>
In either case, as noted actual positions are scaled by the lattice constant <i>a</i>.
You must supply at least <i>N</i> tags (<i>N</i> being the number of sites).  If you supply more,
the remaining tags are ignored.

<P>

<A name="sitefile">
<P> <FONT color="#bb3300"><I>Site file</I>.</FONT>

Alternatively structural data may be read from separate "site file" which can some combination of 
<FONT size="+1"><tt><i>a</i></tt></FONT>, <FONT size="+1"><tt>P</tt></FONT> and 
<FONT size="+1"><tt>pos</tt></FONT> (and optionally other site-related data).  

<P>

If the <FONT size="+1"><tt>STRUC_FILE=</tt></FONT> tag is present, i.e.
the <FONT size="+1"><tt>ctrl</tt></FONT> file contains:
<pre>
STRUC  FILE=<i>fnam</i>
</pre>
the program will try to read <FONT size="+1"><tt><i>a</i></tt></FONT> and <FONT size="+1"><tt><i>P</i></tt></FONT> from file <FONT size="+1"><tt>fnam.<i>ext</i></tt></FONT>.
It is required that <FONT size="+1"><tt>P</tt></FONT> be read;
if on the other hand <FONT size="+1"><tt><i>a</i></tt></FONT> is missing, it will be read from
the <FONT size="+1"><tt>ctrl</tt></FONT> file.

<P>

If the <FONT size="+1"><tt>SITE_FILE=</tt></FONT> tag is present, i.e.
the <FONT size="+1"><tt>ctrl</tt></FONT> file contains:
<pre>
SITE  FILE=<i>fnam</i>
</pre>
data in the <FONT size="+1"><tt>SITE</tt></FONT> category are ignored, and site positions 
are read from file <FONT size="+1"><tt>fnam.<i>ext</i></tt></FONT>.
When site data are read, not only positions are
read but other site-specific data may be read as well, as described below.

<P> <I>Format of the site file</I>.

The file's first line is a header, with information about the file contents and also (optionally)
lattice constant <FONT size="+1"><tt><i>a</i></tt></FONT> and primitive lattice vectors <FONT size="+1"><tt>P</tt></FONT>, <i>viz</i>:
<pre>
% site-data vn=3.0 xpos fast io=15 nbas=16 alat=10.268776 plat= 1.00558546 0.00000003 0.0 -0.00000003 1.00558546 0.0 0.0 0.0 2.00781236
</pre>
The tags separately mean:
<pre>
   site-data    (required) indicates that this file is a site file
   vn=3.0       (required) version number
   xpos         (optional) indicates that site positions are in multiples of P, analogous to XPOS above
                           By default positions are in Cartesian coordinates, analogous to POS above.
   fast         (optional) data can be read as numbers; no algebric expressions are used --- useful for large systems
   io=15        (required) Indicates what the file contains.
                           io=15 indicates that site data contains structural data and positions only
                           io=62 indicates that other data is associated with each site; see below.
   nbas=#       (required) number of sites
   alat=#       (optional) lattice constant
   plat=...     (Required when <FONT size="+1"><tt>P</tt></FONT> is sought from the site file) primitive lattice vectors.
</pre>

After the header come site position data.  Each line should contain data for one site.  If just positions are given (<FONT size="+1"><tt>io=15</tt></FONT>), each line
contains the species label, follwed by the site position, <i>viz</i>
<pre>
 Cr        0.4330127  -0.2500000   0.7168459
 Si        0.2886751   0.0000000   0.2389486
 ...
</pre>
If other data is given (<FONT size="+1"><tt>io=62</tt></FONT>), the code parses for other data along with the positions, as shown in this example for Cr<sub>3</sub>Si<sub>6</sub>:
<pre>
% site-data vn=3.0 fast io=62 nbas=9 alat=8.37 plat= 0.8660254 -0.5 0.0 0.0 1.0 0.0 0.0 0.0 1.43369176
#                        pos                                   vel                                    eula                   vshft  PL rlx
 Cr        0.4330127   0.2500000   1.1947431    0.0000000    0.0000000    0.0000000    0.0000000    0.0000000    0.0000000 0.000000  0 111
 Cr        0.0000000   0.5000000   0.2389486    0.0000000    0.0000000    0.0000000    0.0000000    0.0000000    0.0000000 0.000000  0 111
 Cr        0.4330127  -0.2500000   0.7168459    0.0000000    0.0000000    0.0000000    0.0000000    0.0000000    0.0000000 0.000000  0 111
 Si        0.2886751   0.0000000   0.2389486    0.0000000    0.0000000    0.0000000    0.0000000    0.0000000    0.0000000 0.000000  0 111
 Si        0.5773503   0.5000000   0.2389486    0.0000000    0.0000000    0.0000000    0.0000000    0.0000000    0.0000000 0.000000  0 111
 Si        0.7216879  -0.2500000   1.1947431    0.0000000    0.0000000    0.0000000    0.0000000    0.0000000    0.0000000 0.000000  0 111
 Si        0.1443375   0.7500000   1.1947431    0.0000000    0.0000000    0.0000000    0.0000000    0.0000000    0.0000000 0.000000  0 111
 Si        0.1443375   0.2500000   0.7168459    0.0000000    0.0000000    0.0000000    0.0000000    0.0000000    0.0000000 0.000000  0 111
 Si        0.7216879   0.2500000   0.7168459    0.0000000    0.0000000    0.0000000    0.0000000    0.0000000    0.0000000 0.000000  0 111
</pre>
Lines beginning with '#' are treated as comments.
<BR>
The columns mean:
<pre>
   Column       meaning
     1          species ID
    2-4		Coordinates
    5-7         Particle velocities (needed in molecular dynamics runs)
    8-10        <A href="rotations.html">Euler angles</A> specifying rotation of spin quantization axis, used by the ASA noncollinear branches.
    11          site-specific potential shifts, used by the layer Green's function code
    11          Principal layer, used by the layer Green's function code
    12          for dynamics and statics.  A compound of 3 1-digit numbers, corresponding to x,y,z.
                1 flags that the coordinate is to be relaxed; 0 that the coordinate is to be frozen.
</pre>

<P>


<A name="posfile"><P> <FONT color="#bb3300"><I>Positions file</I>.</FONT></A>

When this command-line argument is invoked:
<pre> --rpos=fnam </pre> 
site positions (but no other site data) can be read.
File <FONT size="+1"><tt>fnam.<i>ext</i></tt></FONT> 
should contain a 3&times;<i>N</i> matrix, in 
<A href="array-file-format.html">standard form for 2D array files</A>.
Here <i>N</i> is the number of site positions.  The file is read as an array
and the contents are copied into the site positions, overriding whatever was read earlier.

<BR> This switch is convenient when you want to shift positions to new coordinates without modifying
input files.

<P> <FONT color="#bb3300"><I>Restart file</I>.</FONT>

The restart files <FONT size="+1"><tt>rst.<i>ext</i></tt></FONT>
(<FONT size="+1"><tt>rsta.<i>ext</i></tt></FONT>) also contain site
and lattice data.  If this file is read e.g., by <b>lmf</b>, site positions
are by default read with it; this data replaces data read earlier.  
<BR>
To suppress this default, use the command-line argument <FONT size="+1"><tt>--rs=#1,#2,#3,...</tt></FONT>.
If argument #3 is nonzero, site data contained in the <FONT size="+1"><tt>rst</tt></FONT> file is ignored.
See <B><A href="Command-line-options.html#section1lmf">here</A></B> for the way <b>lmf</b> parses the <FONT size="+1"><tt>--rs</tt></FONT> switch.


<P> <FONT color="#bb3300"><I>Lattice Deformations</I>.</FONT>

Next, the entire lattice, including the site positions, can be rotated or
otherwise subject to a linear transformation.  There are several types,
specified by tags in the <FONT size="+1"><tt>STRUC</tt></FONT> category.
The following tags will generate a linear transformation:
<pre>
  SHEAR=   a volume-conserving shear transformation
  ROT=     a rigid rotation
  DEFGRD=  a 3x3 matrix specifying a general linear transformation
  STRAIN=  a Voigt strain
</pre>
<A href="lmto.html">lmto.html</A> explains how they are input in the <FONT size="+1"><tt>ctrl</tt></FONT> file.
<A href="rotations.html">rotations.html</A> explains the syntax for rigid rotations,
which the <FONT size="+1"><tt>ROT</tt></FONT> tag uses (as do other tags).

<P>

Finally, if a restart file is read, the site positions are once again
overwritten from data in the restart file, unless you specifically
specify that it not do so.  The restart file checks to see if the
lattice vectors it contains differ from those specified in the input
file.  If there is a difference, it will rotate the site postions by
the linear transformation that changes the input file's lattice
vectors into the restart file's lattice vectors.



