<HTML><HEAD><TITLE>Density of States(v7.7) </TITLE></HEAD><BODY bgcolor="#cccccc">
<H1><B><FONT size="+2">Making and plotting Density of States (v7.7)</FONT></B></H1>

The density-of-states <i>D</i>(<i>E</i>) is given by a sum over states
<i>i</i> as <i>D</i>(<i>E</i>) = &Sigma;<i><sub>i</sub>&delta;</i>(<i>E-E<sub>i</sub></i>) .

<BR>
Note: this expression applies only to non-interacting hamiltonians such as the LDA.
The DOS of an interacting hamiltonian generated by <i>GW</i> can be obtained from
the spectral function; see <A href="gw.html#sectiondos">here</A>.

<BR><BR>

Programs <b>lmf</b>, <b>lm</b>, <b>lmgf</b>, <b>lmpg</b>, <b>tbe</b>
can generate densities-of-states (DOS), in different forms.  

The band methods <b>lmf</b>, <b>lm</b>, <b>tbe</b> work in a different manner than the Green's function methods,
<b>lmgf</b> and <b>lmpg</b>.  Band programs can evaluate the above
equation directly by approximating the &delta;-function with a
gaussian function; this method is simple and safe but is slow to
converge with <i>k</i>.  In general it is less advisable than the
tetrahedron method, which is also implemented in the band programs.

<H2><A name="tdos"></H2></A>
<STRONG>Total DOS, band programs</STRONG>
<UL>

The simplest is the total DOS/cell, which you get by turning
on <FONT size="+1"><tt>BZ SAVDOS=T</tt></FONT>.

<P>
You can also generate the total DOS, if you have already completed a band calculation,
using <b>lmdos</b>.  This is particularly useful if you
want specialized DOS, e.g. in high resolution about a band edge.

If you want to run the band calculation just to prepare input for <b>lmdos</b>,
you can use <FONT size="+1"><tt>--quit=dos</tt></FONT>.  This switches tells the program
to stop after the moments file is generated.

<P> There are a few things to watch out for; see <A href="#tdosthroughldmdos">below</A>.

</UL>

<H2><A name="pdos"></H2></A>
<STRONG>Partial Density-of-States and Mulliken Analysis</STRONG>
<UL>

Programs <B>lm</B>, <B>lmf</B>, and <b>tbe</b> have a facility to resolve, or
decompose, the eigenfunction of each state <i>i</i> into component parts.


There are two kinds of decomposition available, "partial waves" and "Mulliken analysis."

<P> <FONT color="#bb3300"><I>Partial waves</I>.</FONT>

The eigenfunction inside an augmentation sphere is given by solutions
to the radial wave equation &phi;<sub><i>l</i></sub>(<i>E</i>,<i>r</i>) (&phi; is
expanded in a <A href="lmto.html#pbasp">Taylor series</A> in energy,
but that is only a practical detail.) Inside an augmentation sphere,
the wave function is

<br>

    &nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp;<i>&psi;</i><sub><i>i</i></sub>(<i>E</i>,<b>r</b>) =
    &Sigma;<sub><i>lm</i></sub><i>C</i><sub><i>lm</i></sub><sup>(<i>i</i>)</sup>  &nbsp;
    &phi;<sub><i>l</i></sub>(<i>E</i>,<i>r</i>)<i>Y</i><sub><i>lm</i></sub>(<b>r</b>)
<br>

<i>&psi;</i> is normalized:

<br>
    &nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp;&int; |<i>&psi;</i>|<sup>2</sup> <i>d</i><sup>3</sup><b>r</b> = 1
<br>

Thus the coefficients <i>C</i><sub><i>lm</i></sub><sup>(<i>i</i>)</sup> make up partial contributions to
<i>D</i>(<i>E</i>).  The contribution to <i>D</i>(<i>E</i>) from a particular partial wave
<i>&phi;<sub>l</i></sub>(<i>E</i>,<i>r</i>) is well defined, positive
and less than 1, since that contributions from all partial waves at
most sum to one.  (In the ASA, with space-filling spheres, the sum of
partial waves comprises the total wave function, and the separate
contributions to sum to 1.)

<P> <FONT color="#bb3300"><I>Mulliken analysis</I>.</FONT>

The eigenfunction is also be expanded as a linear combination of basis functions
<i>f<sub>k</i></sub>(<b>r</b>):

<br>

    &nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp;<i>&psi;</i><sub><i>i</i></sub>(<i>E</i>,<b>r</b>) =
    &Sigma;<sub><i>k</i></sub><i>F</i><sub><i>k</i></sub><sup>(<i>i</i>)</sup>
    <i>f<sub>k</i></sub>(<b>r</b>)
<br>

As in the partial wave analysis coefficients <i>F</i><sub><i>k</i></sub><sup>(<i>i</i>)</sup> make up partial contributions to
<i>D</i>(<i>E</i>).  In the LMTO method, basis functions
<i>f<sub>k</i></sub>(<b>r</b>) have a particular <i>lm</i> character;
that is <i>f<sub>k</i></sub>(<b>r</b>) can be labelled <i>f<sub>ilm</i></sub>(<b>r</b>)
(there may be multiple envelope functions <i>i</i> for a given <i>lm</i>).

Thus the
<i>F</i><sub><i>k</i></sub><sup>(<i>i</i>)</sup> may be written as <i>F</i><sub><i>ilm</i></sub><sup>(<i>i</i>)</sup>.
(When there is more than one <i>i</i> with a particular <i>lm</i>, as is typical with
<B>lmf</B>, the multiple contributions from different envelopes
<i>i</i> are contracted into a single channel.)

<br><br>

Thus both Mulliken analysis and partial pave analysis enable
decomposition of the unit norm,
&int; |<i>&psi;</i>|<sup>2</sup> <i>d</i><sup>3</sup><b>r</b>,
into partial contributions each associated with a particular site and  <i>lm</i>.  You
can tell <B>lm</B>, <B>lmf</B>, or <b>tbe</b> to accumulate weights
for a partial wave analysis or Mulliken analysis.  (Note: <b>tbe</b>
is not an augmented-wave method: a partial wave analysis is not
possible.)  After a band pass is made, the weights are assembled into
partial DOS for each channel by program
<b>lmdos</b>.  To cause
<B>lm</B>, <B>lmf</B>, or <b>tbe</b> to make the weights file for
<b>lmdos</b>, use command-line argument <FONT
size="+1"><tt>--pdos</tt></FONT> or <FONT
size="+1"><tt>--mull</tt></FONT>.  Options are available to restrict
the list of all possible partial DOS that might be generated to the
ones you want.  (This is especially useful for <b>lmf</b> in the
partial wave decomposition since the augmentation <i>l</i>-cutoff is
typically 4, whereas you normally only <i>l</i> for physically
relevant orbitals is of interest, e.g. 2 for transition metals.  You
can also (and often want to) contract the weights over individual <i>m</i>
quantum numbers, or even contract over both <i>l</i> and
<i>m</i> to obtain a site-resolved DOS.

<br><br>

<B>lmdos</B> reads in the partial dos weights from a (binary) weights
file, which must have been generated previously by <B>lm</B>,
<B>lmf</B>, or <B>tbe</B>.  By default, <B>lmdos</B> reads weights
from file <FONT size="+1"><tt>moms</tt></FONT>.  As mentioned
<B>lm</B>, <B>lmf</B> and <B>tbe</B> can decompose the dos into to <i>Rl</i> or
<i>Rlm</i> channels at the various sites.
<B>lm</B> and <B>lmf</B> will generate a weights file, generated for a
list of sites you specify, when command-line argument <FONT
size="+1"><tt>--pdos</tt></FONT> or <FONT
size="+1"><tt>--mull</tt></FONT> is used (see below for specifics).

<BR><BR>

Note: <B>lm</B> and
<B>tbe</B> typically generate a moments file automatically as
part of the band pass.  However the moments are
generated for inequivalent classes only; the weights are ordered by
<I>class</I>, and not by site.  You can run <B>lmdos</B> after a band
pass (with out argument <FONT size="+1"><tt>--pdos</tt></FONT>) to
generate partial DOS for each class (typically resolved by <i>l</i> but
not by <i>m</i>).
<B>lmf</B> does not generate a weights file by default.

<BR>

<H2><A name="pdosswitches"></H2></A>
<P> <FONT color="#bb3300"><I>Switches to generate Partial DOS or Mulliken Analysis</I>.</FONT>
<UL>

Use one of the following command-line arguments:

<pre>
   --pdos[~mode=#][~sites=site-list][~group=lst1;lst2;...][~nl=#][~lcut=<i>l</i><sub>1</sub>,<i>l</i><sub>2</sub>,...][~lmin=<i>l</i><sub>1</sub>,<i>l</i><sub>2</sub>,...]
   --mull[~mode=#][~sites=site-list][~group=lst1;lst2;...][~nl=#][~lcut=<i>l</i><sub>1</sub>,<i>l</i><sub>2</sub>,...][~lmin=<i>l</i><sub>1</sub>,<i>l</i><sub>2</sub>,...]
</pre>

<FONT size="+1"><tt>--pdos</tt></FONT> or <FONT size="+1"><tt>--mull</tt></FONT>
causes <B>lm</B>, <B>lmf</B>, or
<b>tbe</b> to generate a weights file, suitable for reading by
<B>lmdos</B>.  After completing a band pass with one of these switches, run
<B>lmdos</B> with the same switch and its modifiers to generate a set of partial DOS;
see below for examples and 
<A href="Command-line-options.html#section1lmdos">here</A> for instructions on
running <B>lmdos</B>.

<B>lmdos</B> reads the dos weights file as input, and generates as its
output an (ascii) file containing the partial dos resolved by energy for
each channel.  If you have the <B>fplot</B> plotting package installed,
program <B>pldos</B> can translate this file into a figure.

<BR><BR>

Modifiers to <FONT size="+1"><tt>--pdos</tt></FONT> or <FONT size="+1"><tt>--mull</tt></FONT>
have this meaning:

<pre>
     mode=0: weights for all sites atom-resolved
          1: weights for all sites l-resolved
          2: weights for all sites lm-resolved
          By default the mode is 2.
         <FONT color="#0033ff">
         Caution: at present programs <STRONG>lm</STRONG> and <STRONG>lmf</STRONG> don't
         symmetrize the moments.  If you resolve dos by m,
         you should <A href="#SYMGRP">suppress all symmetry operations.</A></FONT>

     sites=<i>site-list</i> specifies that the partial dos are created only for a particular list
          of sites.  By default <B>lm</B> or <B>lmf</B> will store the weights for all sites, which can become
          expensive, and is usually more information than needed.  See <A href="Integer-list-syntax.html">here</A> for the site-list syntax.

     group=<i>list</i>;<i>list</i>;... is a sequence of site-lists, separated by ";", organized into groups.
          This enables the user to combine multiple sites in a single channel.
          Running this test in the top-level directory provides an illustration:
             testing/test.lm cr3si6
          In this test the 3 Cr are summed togther as a single DOS, as are the 6 Si DOS.

     nl=<I>#</I> tells <B>lm</B> or <B>lmf</B> to discard channels whose <I>l</I> exceeds nl-1.
          By default <B>lmf</B> uses the augmentation lmax, set in the input file by
          SPEC_ATOM_LMXA, as the (site-dependent) <I>l</I>-cutoff; it is typically 4 or so.
          <B>lm</B> uses SPEC_ATOM_LMXB, which is by default nl-1.

     lmin=<i>l</i><sub>1</sub>,<i>l</i><sub>2</sub>,...
     lcut=<i>l</i><sub>1</sub>,<i>l</i><sub>2</sub>,...
          By default, <i>l</i> ranges from 0 to nl.
          lcut is a site-dependent (or group-dependent, if the group option is used)
          cutoff, overriding the default.  Supply one
          <i>l</i> for each entry in the site list (group list).
    
          lmin has the same structure as lcut, but sets a site-dependent lower bound to <i>l</i>.
          If both lmin and lcut are specified, the range is thus lmin < <i>l</i> < lcut.

</pre>

<i>Examples</i>: <BR>

1. A test in the standard <b>lmf</b> test suite generates <i>m</i>-resolved partial DOS
for Co.  Run this test with
<pre>
    fp/test/test.fp co 2
</pre>

Commands with switches relevant for the partial DOS have this structure:
<pre>
    lmf ...  --pdos:mode=2:sites=2
    echo 501 -.8 .7 | lmdos .. --pdos:mode=2:sites=2
</pre>
It generates <i>m</i>-resolved DOS for site 2.  In the body of the output there is this line:

<pre>
 sumlst:  Partial DOS mode 5 (site list lm-projected)  1 sites 9 channels
</pre>

2. The Cr<sub>3</sub>Si<sub>6</sub> test generates <i>l</i>-resolved DOS, grouping
DOS for the three Cr atoms into three channels (<i>spd</i>) and
DOS for the six Si atoms into two channels (<i>sp</i>), for 5 channels all together.
<BR>
Run this test with
<pre>
    fp/test/test.fp cr3si6 2
</pre>

Commands with switches relevant for the partial DOS have this structure:

<pre>
    lmf   ... '--pdos~mode=1~group=1:3;4:9~lcut=2,1'
    lmdos ... '--pdos~mode=1~group=1:3;4:9~lcut=2,1' --dos:npts=501:window=-.8,.5
</pre>

<BR>
</UL>

<H2><A name="tdosthroughldmdos"></A></H2>
<STRONG>Total DOS via lmdos</STRONG>

<P> 

If you have already run a band calculation with <b>lmf</b> or <b>lm</b>, you can 
use <b>lmdos</b> to make the total DOS.

<P>
If your ran your band calculation with e.g.
<pre>
    lm lm-args <i>ext</i>
</pre>
run <b>lmdos</b> in the same way, with an extra argument
<pre>
    lmdos lm-args <i>ext</i> --dos:totdos
</pre>

The lmdos calculation might not work, for several reasons.  

<UL>
<LI>
If you used <FONT size="+1"><tt>BZ_METAL</tt></FONT>=0,
file <FONT size="+1"><tt>moms.<i>ext</i></tt></FONT> probably will not
contain the DOS weights.  
<A href="tokens.html#BZcat"><FONT size="+1"><tt>BZ_METAL</tt></FONT></A> 
must be set to a positive number (1, 2, or 3 for <b>lm</b>; and 2, 3, or 4 for <b>lmf</b>)

<LI>
The band code might reduce the symmetry where <b>lmdos</b> does not.
In particular if SO coupling is turned on, inversion symmetry is not automatically added.
Run <b>lmdos</b> with 
<pre>
    lmdos lm-args <i>ext</i> --dos:totdos --noinv
</pre>
</UL>


The DOS generated by <b>lmdos</b> might also be different.  This will
happen if file <FONT size="+1"><tt>moms.<i>ext</i></tt></FONT> does
not contain all the eigenstates.  <b>lm</b> in particular will only store a
a number up to some cutoff.  This cutoff is control internally but
you can set them manually with
<A href="tokens.html#BZcat"><FONT size="+1"><tt>BZ_EFMAX</tt></FONT></A>
and 
<A href="tokens.html#BZcat"><FONT size="+1"><tt>BZ_NEVMX</tt></FONT></A>.
To get the DOS over the full window, set both to large numbers.



