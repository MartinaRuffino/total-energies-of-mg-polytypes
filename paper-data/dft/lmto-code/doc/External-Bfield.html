<HTML><HEAD><TITLE>Adding external field (v7.03) </TITLE></HEAD><BODY bgcolor="#cccccc">
<H1><B><FONT size="+2">Adding external Zeeman field to potential (v7.03)</FONT></B></H1>

Note: this page has not been carefully worked out, especially the description of
the Stoner parameter may not be accurate.

<P>


<H2><A name="section1"><FONT size="+2"> </FONT></A></H2>

You can add to the crystal potential an external magnetic field inside
each augemetation sphere, in the ASA program <b>lm</b> and
full-potential program <b>lmf</b>.

Use token <FONT size="+1"><tt>BFIELD</tt></FONT> to tell <b>lm</b> or <b>lmf</b>
that a field is to be read.  The calculation must be spin polarized, e.g.

<pre>
HAM    NSPIN=2 BFIELD=2
       ...
</pre>

<FONT size="+1"><tt>BFIELD=1</tt></FONT> allows the field to point in
any direction; <FONT size="+1"><tt>BFIELD=2</tt></FONT> restricts the
field to the <i>z</i> axis.  The former case generates a noncollinear
hamiltonian; the latter is spin diagonal.  (The hamiltonian may also
be noncollinear for another reason, e.g. spin-orbit coupling is turned
on.)  

<BR>
<FONT color="#0033ff">
Caution: <b>lmf</b> does not as yet generate noncollinear output densities.
Self-consistent calculations with
noncollinear <b>B</b> fields are not possible; also the
total energy is not trustworthy if <b>B</b> is not along the <i>z</i> axis.
</FONT>
<BR><BR>

By selecting <FONT size="+1"><tt>BFIELD</tt></FONT> nonzero, you are telling
<b>lm</b> or <b>lmf</b> that a (site-dependent) Zeeman field is to be
added.  In this case you must also supply a site-dependent external
field, which you do through the additional file <FONT
size="+1"><tt>bfield.ext</tt></FONT>.  If this file is omitted, the
program will not execute.  <FONT size="+1"><tt>bfield.ext</tt></FONT>
contains one row for each site; each row contains three numbers
corresponding to
<i>x</i>,<i>y</i>,<i>z</i> components of <b>B</b>.  (The file must
always contain three components <i>B<sub>x</sub></i>
<i>B<sub>y</sub></i>
<i>B<sub>z</sub></i> even if <FONT
size="+1"><tt>BFIELD=2</tt></FONT>.)

<BR>
The GdN test case (part of the test suite) is an instructive example.  In the
top-level directory, run this test:

<pre>
  fp/test/test.fp gdn 
</pre>

This test combines the LDA+<i>U</i> hamiltonian with spin-orbit
coupling.  Bands are calculated for that case; then a magnetic field
of 0.25&nbsp;eV=0.037/2&nbsp;Ry is added to the Gd site and the bands are
recalculated.  GdN has two atoms and file <FONT
size="+1"><tt>bfield.gdn</tt></FONT> reads:

<pre>
0 0 .037/2
0 0 0
</pre>

<IMG
 WIDTH="361" HEIGHT="312" ALIGN="LEFT" BORDER="0"
 SRC="bnds-gdn.png"
>

The test generates files <FONT
size="+1"><tt>bnds.bfield.gdn</tt></FONT> and <FONT
size="+1"><tt>bnds.nobfield.gdn</tt></FONT>
To analyze the bands you need to use a graphics package.
If you have the <FONT size="+1"><tt>FPLOT</tt></FONT> packaged
installed, you can draw the picture shown below comparing the two cases, by
invoking the following commands after running the test:
<pre>
  echo -8,8,5,10 | plbnds -fplot -ef=0 -scl=13.6 -lbl=L,G,X,W,G -dat=blue bnds.nobfield.gdn
  echo -8,8,5,10 | plbnds -fplot -ef=0 -scl=13.6 -lbl=L,G,X,W,G -dat=dat  bnds.bfield.gdn
  mv plot.plbnds plot.plbnds~
  echo "% char0 colr=3,bold=4,clip=1,col=1,.2,.3" >>plot.plbnds
  echo "% char0 colb=2,bold=2,clip=1,col=.2,.3,1" >>plot.plbnds
  awk '{if ($1 == "-colsy") {sub("-qr","-lt {colr} -qr");print;sub("dat","blue");sub("colr","colb");print} else {print}}' plot.plbnds~ >>plot.plbnds
  fplot -disp -f plot.plbnds
</pre>

<P>

In the figure, blue bands are LDA+<i>U</i> results.  Because
spin-orbit coupling is included both minority and majority spin bands
appear.  You can see majority Gd <i>f</i> states near -6.5&nbsp;eV,
and minority <i>f</i> states near +5.5&nbsp;eV.  Gd <i>d</i> states
are spin-split by the exchange-correlation field originating from spin
splitting of the Gd <i>f</i> states; majority and minority <i>d</i>
states are found near 2.5&nbsp;eV and 3.5&nbsp;eV, respectively, at
the &Gamma; point.

<P>

Red bands use the same potential as the LDA+<i>U</i> case, except that
a <i>B<sub>z</sub></i> field of magnitude 0.5&nbsp;eV was added to the Gd site.
<i>B<sub>z</sub></i> causes the the following shifts:

<LI> The majority <i>f</i> shifts <i>down</i> by ~0.22&nbsp;eV, and the
     minority <i>f</i> states shift <i>up</i> by ~0.27&nbsp;eV.
     States that are purely atomic like and are little affected by the 
     kinetic energy will be shifted by the Zeeman field, &plusmn;<i>B</i>/2.
     This is the case for Gd <i>f</i> orbitals.

<LI> The majority <i>d</i> states at &Gamma; shift <i>down</i> by ~0.16&nbsp;eV;
     the minority <i>d</i> states shift <i>up</i> by ~0.20&nbsp;eV.

<LI>  The As <i>p</i> states, in the (-4,0)&nbsp;eV range, are only slightly shifted.

</LI>

<P> <FONT color="#bb3300"><I>Longitudinal susceptibility</I>.</FONT>

<BR>

The magnetic susceptibility is the system's magnetic response to an external magnetic field:
<pre>
     &delta;<i>M</i> = &chi;&nbsp;&delta;B or
     &delta;B = &chi;<sup>-1</sup>&nbsp;&delta;<i>M</i>
</pre>

&delta;<i>M</i> itself can be obtained from a derivative of the total energy:
<pre>
     &delta;<i>M</i> =  (&part;<i>E</i>/&part;B) &delta;B
</pre>      

Thus
<pre>
     &chi;   = (&part;<sup>2</sup><i>E</i>/&part;B<sup>2</sup>)  and
     &chi;<sup>-1</sup> = (&part;<sup>2</sup><i>E</i>/&part;<i>M</i><sup>2</sup>)
</pre>      

In linear response theory, &chi;<sup>-1</sup> can be written
as a sum of a noninteracting part and an interacting part
<pre>
&chi;<sup>-1</sup> = &chi;<sub>0</sub><sup>-1</sup> - <i>I</i>
</pre>

The kernel <i>I</i> is often associated with the "Stoner parameter."  It is
typically about 1&nbsp;eV in 3<i>d</i> transition metals.

<br>

The noninteracting part
&chi;<sub>0</sub><sup>-1</sup> is connected with the induced magnetization of the noninteracting system, i.e. 
<pre>
     &delta;B = &chi;<sub>0</sub><sup>-1</sup>&nbsp;&delta;<i>M</i><sub>0</sub>
</pre>

where &delta;<i>M</i><sub>0</sub> is the magnetization induced by
&delta;B without taking into account the internal potential shifts
that &delta;<i>M</i> cause.  In the density-functional context,
&delta;<i>M</i><sub>0</sub> can be obtained from an initially
self-consistent potential <i>V</i><sub>0</sub>, which is generated in
the absence of an external field.  &delta;<i>M</i><sub>0</sub> is then
the change in <i>M</i> for the potential
<i>V</i><sub>0</sub>+&delta;B.  In practice this is obtained by
evaluating the change in <i>M</i> from the change in output density of a
1-shot calculation with potential <i>V</i><sub>0</sub>+&delta;B.

<BR><BR>

You can use <b>lmf</b> to apply a field and calculate
<i>E</i><sup>LDA</sup> and &delta;<i>M</i> as a function of B.
By comparing self-consistent and 1-shot calculations you can in principle also obtain <i>I</i>.

The example below does this in an approximate way for Fe, using input file <FONT
size="+1"><tt>fp/test/ctrl.felz</tt></FONT>.  

Note: a proper calculation of
<i>I</i> would require a supercell large enough that the interactions
between external <i>B</i>-fields would be sufficiently small.
(<i>I</i> is a local function of <b>r</b> in density functional theory; thus
<i>I</i> is a site-diagonal matrix.)  Here we only consider a single atom
cell.  The interactions are not small, and <i>I</i> is underestimated.

<BR>
The results below were generated by this command:
<pre>
   lmf -vnk=16 --pr31 -vrel=1 -vnit=50 -vso=0 --rs=1 -vbeta=.3 -vbf=2 -vbz=$bz -vconv=1d-6 -vconvc=1d-6 felz 
</pre>
<FONT size="+1"><tt>bz</tt></FONT> must be set as a shell variable.

<BR><BR>

<IMG
 WIDTH="350" HEIGHT="680" ALIGN="LEFT" BORDER="0"
 SRC="EvsB.png"
>

Magnetization and total energy (relative to the B=0 case) were generated for several values of B, and
&part;E/&part;B was obtained from numerical differentiation of <i>E</i>.  

<!--
<pre>
       B            <i>M</i>          <i>E</i>          &part;<i>E</i>/&part;B
   -0.015000   -2.530669    0.002081   -0.045803
   -0.012500   -2.508834    0.001794   -0.141957
   -0.011250   -2.494412    0.001619   -0.136459
   -0.010000   -2.478604    0.001444   -0.155273
   -0.008750   -2.456725    0.001216   -0.226173
   -0.007500   -2.422810    0.000896   -0.250013
   -0.006250   -2.389330    0.000630   -0.152653
   -0.005000   -2.372586    0.000502   -0.102367
   -0.003750   -2.349969    0.000354   -0.110760
   -0.002500   -2.326599    0.000226   -0.111420
   -0.001250   -2.286808    0.000082   -0.095987
    0.000000   -2.252722    0.000000   -0.035760
    0.001250   -2.238697   -0.000016   -0.007633
    0.002500   -2.219217   -0.000022    0.014807
    0.003750   -2.200351    0.000019    0.034427
    0.005000   -2.189761    0.000058    0.034867
    0.006250   -2.179195    0.000109    0.043480
    0.007500   -2.168691    0.000170    0.061085
    0.008750   -2.152303    0.000264    0.032825
    0.009500   -2.141683    0.000334    0.320330
    0.010000   -2.119570    0.000521    0.262016
    0.010500   -2.113101    0.000580    0.084716
    0.011250   -2.103398    0.000676    0.128578
    0.012500   -2.088834    0.000835    0.136786
    0.015000   -2.047343    0.001369    0.394227
    0.017500   -1.954348    0.002835    0.722893
    0.020000   -1.867715    0.004405    0.356802
</pre>
-->

<!-- fplg -tmx .005 -s circ -colsy 3 dat2 -xl '&{B}' -lbl -.005,.0035 cc '&{E}-&{E}(&{B}=0)' -->
<!-- fplg -tmx .005 -y -.25,.25 -x -.012,.012 -map -inc 'abs(x1)<.015' 1:nr -lt 2 -s circ -ord x2+2.2527222 dat2 -ord x4 -lt 1 dat2 -xl '&{B}' -lbl 0,.2 cc '&{M-M}(&{B}=0), &{dE}/&{dB}' -->


<P>

As the top figure shows, the total energy <i>E</i> has a minimum near, but
not exactly at B=0.  This shows that there are some slight errors in
the LDA calculation (in an exact self-consistent LDA calculation
<i>E</i> should be minimum at exactly B=0).

<BR>

<i>E</i> is smooth in the interval (&minus;0.01,0.01)&nbsp;Ry, as
the figure shows.  The behavior is somewhat unsmooth near
B=&minus;0.01&nbsp;Ry, and is a discontinuity or near discontinuity is
evident near B=0.01&nbsp;Ry.  

That means numerical differentiation &part;E/&part;B is a bit problematic,
particularly outside the (&minus;0.01,0.01) interval.  Nevertheless we can
perform it.  In the bottom figure, <i>M</i>&minus;<i>M</i>(B=0) and
&part;E/&part;B are plotted respectively as a function of B as dashed
lines+circles, and a solid line.  The two curves track
fairly well, though &part;E/&part;B is noisy; nor is <i>M</i>(B) 
particularly smooth. 

<BR><BR><BR><BR>

We can obtain &chi; from the slope &part;<i>E</i>/&part;B.  There is some
uncertainty in the calculation since <i>M</i> is not particularly
smooth (note in particular that (&part;E/&part;B)<sub>+</sub> and
(&part;E/&part;B)<sub>&minus;</sub> are a little different).

<BR><BR>

We can also obtain both &chi;<sub>0</sub> by obtaining
&delta;<i>M</i><sub>0</sub> from a 1-shot calculation.  The table
below shows <i>M</i><sub>0</sub> and <i>M</i> for two values of B:


<pre>
       B              <i>M</i><sub>0</sub>             <i>M</i>
    -0.005         -2.363587     -2.402973
     0.005         -2.234213     -2.219662

</pre>

Thus we get:
<pre>
  &chi;<sub>0</sub><sup>&minus;1</sup> = 0.01/(&minus;2.234213&minus;&minus;2.363587) = 0.0773 Ry &rArr; &chi;<sub>0</sub> = 12.9 Ry<sup>&minus;1</sup> = 0.95 eV.
  &chi;<sup>&minus;1</sup>  = 0.01/(&minus;2.219662&minus;&minus;2.402973) = 0.0546 Ry &rArr; &chi;  = 18.3 Ry<sup>&minus;1</sup> = 1.35 eV.
  I = &chi;<sub>0</sub><sup>&minus;1</sup> &minus; &chi;<sup>&minus;1</sup> = 0.0227 Ry = 0.30 eV
</pre>

As noted above, <i>I</i> calculated in this way only approximately
corresponds to the Stoner <i>I</i>.  A better calculation should produce <i>I</i> about 1 eV.
