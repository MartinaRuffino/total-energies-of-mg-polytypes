<!DOCTYPE html><html>

<head>
<title>Tutorial for the LMTO-ASA basic package (v7.10)</title>
<style>

/* For hyperlinks */
a:link {color:#FF0000;}      /* unvisited link */
a:link {color:#222288;}      /* unvisited link */
a:visited {color:#228822;}  /* visited link */
a:hover {color:#FF00FF;}  /* mouse over link */
a:active {color:#0000FF;}  /* selected link */
a:link {text-decoration:none;}
a:visited {text-decoration:none;}
a:hover {text-decoration:underline;}
a:active {text-decoration:underline;}

body {
<!--       background-color:#d0e4fe; -->
     }
 h1 {
      color:#880000;
      text-align:center;
      font-size:12px;
    }
 h2 {
      color:#bb3300;
      FONT-size:"+1";
    }
  P {
<!--  font-family:"Times New Roman"; -->
<!--  font-size:12px; -->
<!--  color: red; -->
    }

  q {
      color: red;
    }

  a {
        color: blue;
    }

  tlarge {
       <font-size="+1">
    }

</style>
</head>

<H1><B><FONT size="+2">ASA tutorial (v7.10)</FONT></B></H1>

<P>
<FONT size="+1">
<FONT color="#bb3300"><I>Purpose</I></FONT>
</FONT>

<P>
This tutorial demonstrates how to set up and run band calculation in
the Atomic Spheres Approximation (ASA), using the <b>lm</b> program.  It:

<!-- <P STYLE="text-indent: 2.5in"> -->

<DL>
<DD> 1. describes how to <A href="#section1">build the input file.</A> 
     <BR><BR>
<DD> 2. explains the <A href="#section2">output of a self-consistent calculation</A>.
     <BR><BR>
<DD> 3. shows how to generate energy bands and partial DOS.
</DL>

<A href="FPtutorial.html">This link</A> provides a corresponding tutorial
for the full-potential LDA program <b>lmf</b>.  Much of the structure
is the same, so you are advised to go through this tutorial first.

<P><A name="section1">
<FONT size="+1">
<FONT color="#bb3300"><I>1. Building the Input file</I></FONT>
</FONT>
</A>

<P>
This tutorial explains an a sample calculation for Si, using 
<A href="input-file-style.html#sampleinputfile">this input file</A> as a template.
You may choose to create some or all of your own input file from
scratch; or you can just
copy <A href="ASAsamples/ctrl.si"><FONT size="+1"><tt>doc/ASAsamples/ctrl.si</tt></FONT></A>
to your current working directory.  The top-level directory is assumed
to be "<FONT size="+1"><tt>~/lm</tt></FONT>."  It is assumed that
executables <b>lmchk</b>,
<b>lm</b>, <b>lmstr</b>, etc are in your path.

<P> Before going through these steps, read how the <A href="input-file-style.html">input
file is structured</A>, including the <b>categories</b>
and <b>tokens</b> that organize it.  You should also read
the <A href="lmto.html">ASA documentation</A>.

<UL>
<LI> create category <A href="tokens.html#VERScat">VERS</A>.  It is
     is required to check version control.
     <BR><BR>

<LI> (optional) create category 
     <A href="tokens.html#HEADERcat">HEADER</A> (if you want some documentation
     written to the output file)<br><br>

<LI> (optional) create the <A href="tokens.html#IOcat">IO</A> category. <br>
     Tokens in <FONT size="+1"><tt>IO</tt></FONT> control how
     much and what kind of information is printed out <br><br>

<LI> (optional) create the <A href="tokens.html#HEADERcat">HEADER</A> category.
     This is intented to enable documentation to be printed to standard out.<br><br>

<LI> (optional) create the <A href="tokens.html#SYMGRPcat">SYMGRP</A> category, which
     enables the user to set symmetry operations by hand.
     Normally symmetry operations are determined autmatically but there are some
     useful special cases where additional information may be supplied.<br><br>

<A name="STRUC"></A>
<LI> Set up the crystal structure. (categories
     <A href="tokens.html#STRUCcat">STRUC</A> and
     <A href="tokens.html#SITEcat">SITE</A>). Si is zincblende, with a
     lattice constant 5.431 A.  Because the input takes atomic
     units, the input file converts to a.u. by declaring a variable a0
     (which later on, <FONT size="+1"><tt>STRUC_ALAT</tt></FONT> uses):
       <pre>  CONST   a0=.5292  </pre>
     Category <A href="input-file-style.html">CONST</A> is
     special. It does not supply any tokens for input; its only
     purpose is to declare symbolic variables for use elsewhere. 

<P> You supply information defining the lattice structure in the 
     <A href="tokens.html#STRUCcat">STRUC</A> category through
     <FONT size="+1"><tt>ALAT</tt></FONT> and <FONT size="+1"><tt>PLAT</tt></FONT>;
     supply site position data in the 
     <A href="tokens.html#SITEcat">SITE</A> category.  Each site must
     be associated with a chemical element, or species; you supply
     information about the "personality" of species in
     the <A href="tokens.html#SPECcat">SPEC</A> category.

<P> Si has one species and two atoms/cell, but because the ASA makes
     shape approximations to the potential, its use becomes
     problematic when dealing with open structures.  To compensate
     two artificial "empty" sites (atomic number 0) are added to the
     basis.  Thus for purposes of this calculation, the basis has four
     atoms: two Si atoms and two others just to fill the interstitial.
     Specify the number of sites 
     in <FONT size="+1"><tt>STRUC_NBAS</tt></FONT>.

<H2><A name="SPEC"></A></H2>
<LI> Set up the <A href="tokens.html#SPECcat">SPEC</A> category.  Species labels (following <FONT size="+1"><tt>ATOM=</tt></FONT>) can be any short string. 
     In this case there are two species.  In addition, use 
     <FONT size="+1"><tt>STRUC_NSPEC</tt></FONT> to specify how many species.

<BR><FONT color="#0000bb"><I>*Aside</I>&nbsp;</FONT> If you do not
supply <FONT size="+1"><tt>STRUC_NSPEC</tt></FONT>, the parser will
look for all the species as it can find in the <FONT size="+1"><tt>SPEC</tt></FONT> category, and set <FONT size="+1"><tt>NSPEC</tt></FONT> to the number it finds.

<P> Note that each species label
     (following <FONT size="+1"><tt><FONT size="+1"><tt>ATOM</tt></FONT></tt></FONT>)
     in the <FONT size="+1"><tt>SITE</tt></FONT> category must match
     a label in the <FONT size="+1"><tt>SPEC</tt></FONT> category.
     This is how the code determines the chemical character of element at each site.

<P> These programs will splits species into symmetry-equivalent
    classes.  In the ASA codes
    (<b>lm</b>, <b>lmgf</b>, <FONT size="+1"><tt>lmpg</tt></FONT>)
    labels are assigned to each class.  Class labels are derived from
    species labels by appending numbers to the species labels.  They
    cannot exceed 8 characters, so usually you should limit the
    species labels to 6 or so characters (fewer if you have many
    atoms).

     <P> The atomic number <A href="tokens.html#SPECcat"><FONT size="+1"><tt>Z=</tt></FONT></A> is required for each species. 

     <P> You must choose a sphere radius, choosing one of
     <A href="tokens.html#SPECcat"><FONT size="+1"><tt>R=</tt></FONT></A>,
     <A href="tokens.html#SPECcat"><FONT size="+1"><tt>R/W=</tt></FONT></A> or
     <A href="tokens.html#SPECcat"><FONT size="+1"><tt>R/A=</tt></FONT></A>.

     The choice of sphere radii is the Achilles heel in augmented wave
     methods.  This is particularly true in the ASA because one must
     choose a balance between the following competing needs:
     <DL>
     <DD>  (1) the average potential at each MT surface should be similar
     <DD>  (2) small sphere overlaps
     <DD>  (3) spheres that are not too large
     <DD>  (4) small interstitial
     </DL>

<P> It is difficult for the user to choose radii that satisfy (1), but
      a switch is available in program <b>lmchk</b> to determine these
      radii automatically, as described HEREXX.  (The automatic input
      file generator, program <b>blm</b>
      uses this same algorithm to supply sphere radii.)  
      
<P>   (2) and (4) are diametrically opposed.  In the ASA it is
      essential the the sum-of-sphere volumes equals the cell volume
      (i.e. the interstitial volume be zero) which means empty spheres
      are needed for all but close-packed structures.  In the FP case
      one still prefers to make the interstitial as small as possible
      because the augmented wave basis is better than the envelope
      (interstitial) basis.

<P> The sample input file makes a simple choice: all the spheres have
      the same radii, namely the average Wigner-Seitz radius <i>W</i>;
      radii are chosen as <FONT size="+1"><tt>R/W=1</tt></FONT>.

<LI> create the <A
     href="tokens.html#HAMcat">HAM</A> category.  This category is
     responsable for reading the parameters defining the hamiltonian.
     Token <FONT size="+1"><tt>QASA=0</tt></FONT> specifies that 
     Methfessel conventions are to be used for 2<sup>nd</sup> generation ASA moments 
     <A href="lmto.html#section2">Q<sub>0</sub>, Q<sub>1</sub>, Q<sub>2</sub></A>.
     Usually it doesn't make much difference, but
     <FONT size="+1"><tt>QASA=3</tt></FONT> is generally recommended.
     <FONT size="+1"><tt>NSPIN=1</tt></FONT> tells the program that
     the calculation is not spin polarized.  (You can
     omit <FONT size="+1"><tt>NSPIN</tt></FONT> all together; the token is
     optional as you can see by invoking the program with 
     <A href="input-file-style.html#inputswitch"><FONT size="+1"><tt>--input</tt></FONT></A>.)
     Note also the
     token <FONT size="+1"><tt>REL=F</tt></FONT>.  This means use the
     Schrodinger equation rather than the scalar form of the Dirac
     equation.  This is not usual.
<BR><FONT color="#0000bb"><I>*Aside</I>&nbsp;</FONT> In versions prior to v7, <FONT size="+1"><tt>NSPIN=</tt></FONT> and <FONT size="+1"><tt>REL=</tt></FONT> belonged
     to the <FONT size="+1"><tt>OPTIONS</tt></FONT> category.

<P>
<LI> (optional) create the <A href="tokens.html#OPTIONScat">OPTIONS</A>
     category.  The sample file uses this option
     <pre> OPTIONS ASA[ CCOR=F ADNF=F] </pre>
     Brackets <FONT size="+1"><tt>[..]</tt></FONT> are ncessary because
     <FONT size="+1"><tt>OPTIONS_ASA_CCOR</tt></FONT>  and
     <FONT size="+1"><tt>OPTIONS_ASA_ADNF</tt></FONT> are tokens
     nested to the 3<sup>rd</sup> level.   <FONT size="+1"><tt>CCOR</tt></FONT>
     tells the ASA not to include the ``combined correction'' term
     (not generally
     recommended).  <FONT size="+1"><tt>ADNF=T</tt></FONT> would turn
     on a feature to automatically search for orbitals to downfold
     (remove from the basis).  All these tags (the <FONT size="+1"><tt>OPTIONS</tt></FONT> category itself, and
     <FONT size="+1"><tt>OPTIONS_ASA_CCOR</tt></FONT>  and
     <FONT size="+1"><tt>OPTIONS_ASA_ADNF</tt></FONT> optional; see
     see <A href="#section2">below</A>.

<P>
<LI> (optional) create the <A href="tokens.html#STRcat">STR</A> category.
     For 2nd generation ASA, the most important input is <FONT size="+1"><tt>RMAX</tt></FONT>,
     which specifies the range of real-space structure constants,
     see discussion following <A href="#lmstr">invoking lmstr</A>.

<H2><A name="BZ"></A></H2>
<LI> create the <A href="tokens.html#BZcat">BZ</A> category.  Note that the
     number of <i>k</i>-point divisions is specified through variable
     <FONT size="+1"><tt>nk</tt></FONT>, which was declared and assigned to the value `4' in <FONT size="+1"><tt>CONST</tt></FONT>.
     <BR><BR>

<LI> create the <A href="tokens.html#ITERcat">ITER</A> category.  This
     contains tokens governing the maximum number of iterations
     (<FONT size="+1"><tt>NIT=7</tt></FONT>) to converge to
     self-consistency, and convergence criteria
     (<FONT size="+1"><tt>CONVC=1e-4</tt></FONT> for
     charge, <FONT size="+1"><tt>CONV=0</tt></FONT> for energy change
     from prior iteration) that tell the program when you are
     sufficiently converged to self-consistency.

<P> <FONT size="+1"><tt>ITER</tt></FONT> also holds the content of
     the <FONT size="+1"><tt>MIX</tt></FONT>
     token, <FONT size="+1"><tt>MIX=A,b=.8</tt></FONT>, a string.
     This string is passed charge mixer, which mixes the input
     density <i>n</i><sub>in</sub> (some trial density which generates
     the potential), with the output density <i>n</i><sub>out</sub>
     generated by the potential.  The aim is to find the
     self-consistent density,
     where <i>n</i><sub>out</sub>=&nbsp;<i>n</i><sub>in</sub>.  Some
     kind of mixing is usually necessary to stabilize convergence.
     '<FONT size="+1"><tt>A</tt></FONT>' tells the mixer to use
     the Anderson mixing scheme; it mixes 80% of output charge with 20%
     of input charge because <FONT size="+1"><tt>b=.8</tt></FONT>.  The
     <A href="lmto.html#section2">ASA density is completely specified</A>
     by the logarithmic derivatives at the sphere boundary, via
     parameters <FONT size="+1"><tt>P</tt></FONT>, and the 
     multiple moments
     <FONT size="+1"><tt>Q<sub>0</sub>,Q<sub>1</sub>,Q<sub>2</sub></tt></FONT>.
     Theu the parameters mixed in the ASA are
     <FONT size="+1"><tt>(P,Q)</tt></FONT>: four numbers for
     each <i>l</i> channel and class.  In the
     <A href="FP.html">FP implementation</A>, the full charge density
     is mixed.   Other programs, e.g. 
     <A href="tbe.html">self-consistent empirical tight-binding</A>, mix still other quantities.
     But the mixing commands are mostly common to all programs.

<P> There are many other choices in this string.  Unfortunately
     difficult to make a general specification about the best mixing
     procedure to converge <FONT size="+1"><tt>P</tt></FONT>
     and <FONT size="+1"><tt>Q</tt></FONT> to self-consistency (in the
     full-potential case, it mixing the sphere and interstitial densities)
     If you have problems, The first thing to do is down the mixing
     parameter `<FONT size="+1"><tt>b</tt></FONT>'.  You can also use Broyden mixing
     (<FONT size="+1"><tt>MIX=B</tt></FONT>) rather than Anderson mixing; indeed 
     this is recommended.  For difficult cases, see 
     <A href="linear-response-asa.html">linear-response-asa.html</A>.

<LI> (optional) create the <A href="tokens.html#STARTcat">START</A>
     category to supply guesses
     for <A href="lmto.html#section2">P,Q</A> for
     both <FONT size="+1"><tt>Si</tt></FONT>
     and <FONT size="+1"><tt>ES</tt></FONT> species.  If you do not
     specify anything the program will use some defaults.  In the
     example, the specifications of P and Q were commented out (note
     the '<FONT size="+1"><tt>#</tt></FONT>') so default values will
     be used.  Default values are crude, so the initial trial density 
     will be far from the self-consistent one.
     </UL>
</UL>


This completes the creation of the input file.

<P><A name="section2">
<FONT size="+1">
<FONT color="#bb3300"><I>2. Running programs in the ASA package</I></FONT>
</FONT>
</A>

<P> Before carrying out a self-consistent calculation, run
program <b>lmchk</b> for some preliminary checks. 
This program's main function is to checks sphere packing and overlaps, but
it has a number of other features.  
<P> Use <FONT size="+1"><tt>--showp</tt></FONT> to see the operation of the 
<A href="input-file-style.html#preprocessor">preprocessor</A>:
<pre> 
  lmchk si --showp              (or equivalently)
  lmchk ctrl.si --showp
</pre>
In this case what is printed on the screen is nearly identical to the input file,
except commented lines are not printed.  This file makes no use of
the preprocessor so no lines are modified.

<P> Next, use <FONT size="+1"><tt>--show=2</tt></FONT> to see what
data is read.  This switch tells the program to print out what the
parser reads, or infers from defaults, and exits without further processing.
<pre> 
  lmchk ctrl.si --show=2
</pre>
Many tokens are printed out; note in particular <FONT size="+1"><tt>NSPIN</tt></FONT>
token was read. There should be a line <FONT size="+1"><tt>HAM_NSPIN</tt></FONT>
in the output:
<pre> 
  Token            Input   cast  (size,min,read,def)     result
  ...
  HAM_NSPIN         opt    i4       1,  1,   1,  0       1
</pre>

<P>
      Program <b>lmchk</b> checks sphere packing, and has
      the following options:

     <UL>
     <LI>  Print out a list of neighboring shells surrounding each site:<BR>
           <pre> lmchk --shell si</pre>
           which produces this <A href="ASAsamples/out.si.lmchk">output</A> for the sample <FONT size="+1"><tt>ctrl.si</tt></FONT>.
     <LI>  Move atoms to minimize sphere overlaps (useful to locate empty spheres in low-symmetry geometries).
           To do this, invoke something like
           <pre> lmchk --mino~z --wpos=<I>newpos</I> file-ext ... </pre>
     </UL>

     Once created, <B>lmchk</B> and other programs can read these positions as well:
     <UL>
       <pre> lmchk --rpos=<I>newpos</I> file-ext ... </pre>
     </UL>



<LI> Invoke <b>lmchk</b> to check sphere overlaps.
       <pre>   lmchk si </pre>
     Verify <A href="ASAsamples/out.si.lmchk">output</A> that the
     sum-of-sphere volumes equals the total volume.
     <BR>Note that you can see what tokens <b>lmchk</b> looks for by invoking
       <pre>   lmchk --input </pre>
     and you can see what values lmchk is actually using (including
      for tokens you didn't specify) by invoking
       <pre>   lmchk --show </pre>

<H2><A name="lmstr"></A></H2>
<LI> Invoke <b>lmstr</b> to generate real-space structure constants.
       <pre>   lmstr si </pre>
     Notice in the <A href="ASAsamples/out.si.lmstr">output</A> that
     the each site has 27 neighbors, which corresponds to three
     shells.  The number of neighbors depends on the choice of 
     <A href="tokens.html#STRcat">RMAX=</A>,
     which is 3.2 for this example.  If we hadn't specified anything,
     the program defaults to RMAX= is 2.7 which for bcc packing here
     will generate 15, or two shells of neighbors.  This isn't too
     bad, for total energies but is a little crude.  Few neighbors
     correspond to a low Fourier series cutoff in reciprocal space,
     and thus don't pick up rapid oscillations in the bands.  More neighbors
     are also needed for reasonable description of higher-lying
     bands.<BR><BR>

     Setting <A href="tokens.html#STRcat">STR</A> SHOW=t has the effect of
     displaying some portion of the structure constants; the amount of
     detail displayed depends on the verbosity.<BR><BR>

     By increasing verbosity, <b>lmstr</b> prints out more
     information.  For example, setting the verbosity to 41 or higher
     causes <b>lmstr</b> to print out a neighbor table.  The verbosity in the
     ctrl file is set to 40.  You can change the VERBOS= token in the
     file, or override it using a command line argument:
       <pre>   lmstr si --pr41 </pre>
     <BR>

<H2><A name="lm"></A></H2>
<LI> Invoke <b>lm</b> to generate a self-consistent potential
       <pre>   lm si </pre>
     The output shown <A href="ASAsamples/out.si.lm#start">here</A> was
     doctored slightly to incorporate some hyperlinks.  Note the
     following points:

     <OL>

     <LI> At the <A href="ASAsamples/out.si.lm#start">beginning</A> of
          the output there is a brief epitome of some important
          parameters and program switches, e.g. ``nonrel'' and
          ``no-ccor''.
<BR><BR>
     <LI> No <A href="tokens.html#SYMGRPcat">SYMGRP</A> category was
          supplied, so the program found its own
          <A href="ASAsamples/out.si.lm#symgrp">symmetry group operations</A>.
<BR><BR>
     <LI> The <A href="ASAsamples/out.si.lm#bz">BZ mesh</A> generated
          10 <I>k</I>-points from the specified number of divisions (4x4x4)
          and the BZJOB=1 switch.  The latter causes the <I>k</I>-mesh
          to be offset from the &Gamma; point (mesh does not contain <I>k</I>=0)
<BR><BR>
     <LI> Note the potential parameters PPAR generated in the <A
          href="ASAsamples/out.si.lm#sphere">sphere branch</A>.
          Parameter C is the band center of gravity; you see that it
          is (in this first iteration) rather deep for the Si s, about
          -0.7 Ry, near zero for the Si p and about 1.5 Ry for the Si
          d.  This is as expected: the bottom of the valence bands are
          Si s-like; the valence bands are Si p-like, and the
          conduction bands are Si d like.  It is interesting to note
          how much these parameters have changed when self-consistency
          is reached; see the corresponding data for the <A
          href="ASAsamples/out.si.lm#spheren">last iteration</A>.
<BR>
          Parameter E<SUB>&nu</SUB> is the linearization energy, which is
          connected to the choice of P.  P, and consequently E<SUB>&nu</SUB>,
          change quite a lot in the iterations towards
          self-consistency.  Because 
          <A href="tokens.html#SPECcat">SPEC</A> 
          IDMOD=0, P was allowed to float so that enu falls at the
          center-of-gravity of the occupied parts of the bands.  This
          corresponds to making the first energy moment Q1=0.
          <BR><BR>

     <LI> Next comes a table of average <A
          href="ASAsamples/out.si.lm#vmad">potentials</A> at each MT
          boundary.  This data is averaged to construct the ASA
          muffin-tin zero, VMTZ.
          <BR><BR>

     <LI> In the <A href="ASAsamples/out.si.lm#band">band pass</A>
          some energy bands are printed out.  The amount of data
          printed depends on the verbosity.  Because BZJOB=1, the no
          <I>k</I>-point lies at &Gamma; where the valence-band maximum lies.
          <BR><BR>
<H2><A name="efermi"></A></H2>
     <LI> Next comes the determination of the
          <A href="ASAsamples/out.si.lm#bzint">Fermi level</A>.
          Because Si is an insulator, this branch is particularly simple.
          For a metal, you will get something like the following
          (depending on what integration method and verbosity you select)
<pre>
 BZWTS : --- Tetrahedron Integration ---
         Est E_f           Window        Tolerance  n(E_f)
        -0.148571  -0.150937  -0.148426   0.002511  14.958994
        -0.148573  -0.148577  -0.148552   0.000025  14.819478
        -0.148573  -0.148573  -0.148573   0.000000  14.820559
 BZINTS: Fermi energy:     -0.148573;  41.000000 electrons
         Sum occ. bands:  -24.813178, incl. Bloechl correction: -0.006528
</pre>
          The <A href="bzintegration.html#tetrahedron">tetrahedron method</A> is generally the most accurate way to perform Brillouin zone integrations.
          This code incorporates <A href="http://prb.aps.org/abstract/PRB/v49/i23/p16223_1">Blochl
          corrections</A> so that the integration error scales as something like <i>h</i><sup>3</sup> (<i>h</i> = k-point spacing) rather than <i>h</i><sup>2</sup>
          of the standard tetrahedron integration method.
          But band crossings may occur which messes up the integration.  There is a telltale sign of a
          band crossing, namely the integrated number of electrons
          doesn't come out to an exact integer.  There is alternative generalized 
          <A href="bzintegration.html#sampling">generalized sampling integration method</A> developed by
          <A href="http://link.aps.org/doi/10.1103/PhysRevB.40.3616">Methfessel and Paxton</A>.
          For M/P integration
          you must choose <FONT size="+1"><tt>N</tt></FONT> and <FONT size="+1"><tt>W</tt></FONT> by trial and error---but you get a
          good idea by looking at the bands at the Fermi surface. For
          steep bands use <FONT size="+1"><tt>W</tt></FONT> about 0.05 - 0.1 and for flat bands, use 
          <FONT size="+1"><tt>W</tt></FONT> about 0.01 to 0.05 and then adjust <FONT size="+1"><tt>N</tt></FONT> between 1 and 4 or 5.
          See <A href="bzintegration.html">this page</A> for a detailed comparison of the two methods.

          <br> Also printed is the sum of occupied
          bands, which is needed together with the potential to
          compute the total energy.  The Bloechl correction is of
          interest because it shows how much the energy changes from
          straight tetrahedron (converges as <i>h</i><sup>2</sup>) and the
          Bloechl-corrected tetrahedron (which converges faster than <i>h</i><sup>2</sup>)
          <BR>

<H2><A name="eh1stit"></A></H2>
     <LI> Next comes the printout of the Harris-Foulkes
          <A href="ASAsamples/out.si.lm#ehf"> total energy</A>.  <FONT size="+1"><tt>delsev</tt></FONT>
          should be small when near self-consistency.  (Note: 
          in this special case the 
          <A href="http://link.aps.org/doi/10.1103/PhysRevB.39.12520">Harris-Foulkes</A>
          total energy is not generated 
          <A href="ASAsamples/out.si.lm#sumetot">in the first iteration</A>.  
          This is an artifact of the initial condition where the
          moments and therefore empty sphere potential is exactly
          zero, which deceives
          <B>lm</B> into thinking that double-counting terms
          were never generated.  It is a buglet not worth pursuing,
          since it is not connected to any physical condition.)<BR><BR>

     <LI> Immediately following the output moments 
          <A href="lmto.html#section2"><FONT size="+1"><tt>Q0,Q1,Q2</tt></FONT></A>
          are shifted so that the &nbsp;<FONT size="+1"><tt>P</tt></FONT>'s&nbsp; can float to the band centers of gravity.<BR><BR>

     <LI> The output moments are <A href="ASAsamples/out.si.lm#mix">mixed</A>
          with the starting moments to form a new set of moments,
          which with luck will closer to the self-consistent numbers; also
          the RMS deviation between the two is printed.

<BR><BR>
     <LI> A <A href="ASAsamples/out.si.lm#sphere2">new pass</A>
          is made through the sphere branch, creating a new potential
          and set of potential parameters.

<BR><BR>
     <LI> Some <A href="ASAsamples/out.si.lm#sumetot">information</A>
          summarizing the total energy and how close this pass was to
          achieving the tolerances for self-consistency is printed.
          (See <A href="#eh1stit">note above</A> about 1st iteration
          Harris-Foulkes energy.)  This ends the first iteration.  The
          cycle is repeated until self-consistency is reach, or the
          maximum number of iterations is encountered.  <BR><BR>

     <LI> Invoke <b>lmctl</b> to extract the self-consistent <FONT size="+1"><tt>P,Q</tt></FONT>.
          (This step is optional).  Edit the file &nbsp;<FONT size="+1"><tt>log.si</tt></FONT>&nbsp;
          and paste the results to the bottom of the &nbsp;<FONT size="+1"><tt>ctrl</tt></FONT>&nbsp; file.
          <BR> <FONT color="#0000bb"><I>*Caution</I>&nbsp;</FONT> 
          take care with what P,Q the program uses.  Since the
          &nbsp;<FONT size="+1"><tt>START</tt></FONT>&nbsp; category is set up as &nbsp;<FONT size="+1"><tt>BEGMOM=T CTRL=T</tt></FONT>, it will
          <i>always</i> read any &nbsp;<FONT size="+1"><tt>P,Q</tt></FONT>&nbsp; it finds in &nbsp;<FONT size="+1"><tt>START</tt></FONT>, and 
          make a <i>new potential</i> from those values.
          Since our specification of &nbsp;<FONT size="+1"><tt>P,Q</tt></FONT>&nbsp; have been commented out, we
          don't have any worries; the program will use whatever it finds on the disk.
</OL>


<P><A name="section3"><A name="bands"></A>
<FONT size="+1">
<FONT color="#bb3300"><I>3. Generating energy bands and densities-of-states</I></FONT>
</FONT>

<OL>
     <LI> Energy bands are typically plotted along specified symmetry lines,
          which information you supply through a symmetry-line file.  
          Rather than create one, we will just copy one from the startup directory to <FONT size="+1"><tt>syml.si</tt></FONT>.
          <pre>
  cp <A href="../startup/syml.fcc">startup/syml.fcc</A> ./syml.si
          </pre>
          <FONT size="+1"><tt>syml.si</tt></FONT> has rows such as:
          <pre>
   41  .5 .5 .5     0  0 0                L to Gamma   (Lambda)
   ...
    0    0 0 0  0 0 0
          </pre>
          Each line of text specifies a line segment in k-space.  In
          the first line of this file the segment runs
          from <b>k</b>=(1/2,1/2,1/2) to 0 in units of 2&pi;/<i>a</i>
          (L to &Gamma;).  '41' specifies the number of <i>k</i>
          points are generated in this segment.  At present the
          remainder of the line is not used.
          The last line tells the line reader not to read any more lines.

<P>       To generate the ASA energy bands, do:
          <pre>
  lm si --band:fn=syml </pre>
          The bands are generated and saved in file <FONT size="+1"><tt>bands.si</tt></FONT>.

<P>
          If you have the <FONT size="+1"><tt>plbnds</tt></FONT> program installed from the FPLOT
          package, you can plot the bands by invoking one of the following
          <pre>  echo -15 15 5 10 | plbnds -scl=13.6 -ef=0 si </pre>
          which creates directly a postscript file 
          <FONT size="+1"><tt>ps.si</tt></FONT>, or better:
          <pre>  echo -15 15 5 10 | plbnds -fplot -scl=13.6 -ef=0 si </pre>
          which creates an fplot command, in file <FONT size="+1"><tt>plot.plnds</tt></FONT>.
          Use fplot to create a postscript file:
          <pre>  fplot -f plot.plbnds </pre>
          which creates a postscript file <FONT size="+1"><tt>ps.dat</tt></FONT>.

<P>
          The energy bands generator has an optional feature that
          enables you to highlight a particular orbital character in
          the energy bands.  See <A href="#bandweights">color
          weights</A> below.

     <LI> To generate the <i>total</i> density-of-states (DOS), you don't have to do anything
          special.  If <FONT size="+1"><tt>BZ_SAVDOS=T</tt></FONT>, the total DOS
          is automatically written to disk every band pass.  We will generate the partial DOS here.
          It is particularly simple in the ASA; in the FP code you need to set some extra switches.

<P>       When making DOS, you should run
          <b>lm</b> once more with many k-points, and also use
          tetrahedron integration. 
          (Note: check that <FONT size="+1"><tt>BZ_SAVDOS=T</tt></FONT>).
          You can reset the switches in <FONT size="+1"><tt>ctrl.si</tt></FONT>
          tetrahedron or sampling (it doesn't matter how you made it
          self-consistent).  For DOS plotting, <FONT size="+1"><tt>W</tt></FONT> must be about 1/10th the
          distance between peaks (<FONT size="+1"><tt>N</tt></FONT> = 1) or larger for <FONT size="+1"><tt>N</tt></FONT> > 1.  The
          defaults are <FONT size="+1"><tt>N</tt></FONT>=0, <FONT size="+1"><tt>W</tt></FONT>=.005; <FONT size="+1"><tt>N</tt></FONT>=0 always gives conventional
          Gaussian smearing with Gaussian width, <FONT size="+1"><tt>W</tt></FONT>.

<P>
          Instead of altering the <FONT size="+1"><tt>ctrl</tt></FONT> file, we take advantage of the
          ability to alter the value of variables from command-line
          arguments.  Since <FONT size="+1"><tt>CONST</tt></FONT> doesn't change the value of variables
          already declared, command-line declarations take precedence
          over the <FONT size="+1"><tt>CONST</tt></FONT> entries.  Also, because we don't want the
          program to change the potential, we use interactive mode,
          and make it stop after the bands have been completed.
          Finally, we turn down the verbosity, since there will be so
          many <i>k</i>-points
          <pre>   lm si -vnk=16 -vmet=1 --iactiv --pr30 </pre>
          You will encounter lines beginning with &nbsp;<FONT size="+1"><tt>QUERY:</tt></FONT>
          Press &nbsp;<FONT size="+1"><tt>return</tt></FONT>&nbsp; to each query until you reach this line:
          <pre>   QUERY: beta (def=0.8)? </pre>
          which is asking you if you want to change the mixing
          parameter.  Just type &nbsp;<FONT size="+1"><tt>q</tt></FONT>&nbsp; and the program will stop.
<P>
<FONT color="#0000bb"><I>*Aside</I>&nbsp;</FONT> it is interesting to note that <FONT size="+1"><tt>RMS DQ=3e-4</tt></FONT>,
          which is the error we made because we only used 4
          divisions of <i>k</i>-points to make the potential
          self-consistent.  This is a relatively small error; but in metals the errors
          would be significantly larger: 4 divisions is not usually
          sufficient in such a case.

<P>
<A name="DOS"></A>
          The ASA program has the ability to use files generated as a byproduct of the band pass to 
          immediately generate DOS resolved by orbital and class.  This is done using <b>lmdos</b>.  Invoke
          <pre>   lmdos si -vnk=16 -vmet=1 --iactiv --pr30 </pre>
	  You will be queried with a prompt:
          <pre>   Enter npts (def=501), emin and emax (def=-1,0): </pre>
          enter <FONT size="+1"><tt>1001 -1 .3 RETURN</tt></FONT>, or do the whole thing in one go:
          <pre>   echo 1001 -1 .3 / | lmdos si -vnk=16 -vmet=1 --iactiv --pr30 </pre>
          This generates partial partial DOS in 6 channels: three for the <i>s,p,d</i>
          channels on the Si and three for the <i>s,p,d</i> channels on the
          "empty" site (effectively the interstitial).  
<BR>
<FONT color="#0000bb"><I>*Aside</I>&nbsp;</FONT> if you add the command-line argument <FONT size="+1"><tt>--dos:totdos</tt></FONT>, then
          <b>lmdos</b> would combine the partial DOS to make only the total DOS.
<BR>
          Either way, the DOS are output in file &nbsp;<FONT size="+1"><tt>dos.si</tt></FONT>.

<P>
          If you have installed the FPLOT package, you can use <b>pldos</b> to
          create pictures of DOS from this file.  For example,
          <pre>   echo 8 7 / | pldos -fplot '-lst=1,2,3;4,5,6' dos.si </pre>
          creates a file &nbsp;<FONT size="+1"><tt>dosp.dat</tt></FONT>&nbsp; with two columns containing partial
          dos (one column combines dos 1,2,3 ---the Si dos and the
          other combines dos 4,5,6---the Es dos), and a file
          &nbsp;<FONT size="+1"><tt>plot.pldos</tt></FONT>&nbsp; which holds the <b>fplot</b> command that creates a
          postscript file for this DOS. 
          <pre>   fplot -disp -pr10 -f plot.dos </pre>
          creates and displays postscript file &nbsp;<FONT size="+1"><tt>ps.dat</tt></FONT>. You can see
          from the DOS that there is a direct gap near the Fermi level
          of about 0.04 Ry, which is the LDA gap for Si.  Note: there
          is a facility to draw two DOS in a single panel, one above
          the 'zero' and one below.  This is particulary convenient in
          spin polarized cases when you want to compare the majority
          and minority DOS.  Example: in file &nbsp;<FONT size="+1"><tt>dos.dat</tt></FONT>&nbsp; the majority
          DOS are in channels 1,3,5 (atom 1) and 7,9,11 (atom 2), and
          the minority DOS are in channels 2,4,6 (atom 1) and 8,10,12
          (atom 2), invoke, e.g.
          <pre>   echo 8 7 / | pldos -fplot '-lst=1,3,5;7,9,11' '-lst2=2,4,6;8,10,12' dos.dat </pre>

</OL>
</UL>

<H2><A name="bandweights"></A></H2>
<FONT color="#bb3300"><I>
<FONT size="+1">
Use of color to highlight orbital character in energy bands or DOS
</FONT>
</I>&nbsp;</FONT> 

<P>
Starting with v6.16, the energy bands maker will allow you to generate
weights together with the bands themselves.  With this option, each
energy levels is assigned a corresponding weight which can be used by
a graphics package to highlight orbital character associated with
them.  The <B>fplot</B> graphics package, for example, can
read these weights and to draw bands with continuously varying color
fixed by the weights.

<BR><BR>

The orbital character is defined through the Mulliken weights, defined as follows.
Consider a basis of orthonormal orbitals, with
orbital component <I>i</I> of the <I>n</I><sup>th</sup> eigenvector, <I>z</I><sub><i>in</i></sub></I>.
The inner product
  <pre> &Sigma;<sub><i>i</i></sub> (<I>z</I><sub><i>in</i></sub></I>)<sup>&dagger;</sup></I> <I>z</I><sub><i>in</i></sub></I> </pre>
is unity.  This is just a statement that the wave function is
normalized, or that the eigenstate carries unit charge.  The unit norm
can be resolved into individual orbital contributions (Mulliken
decomposition), which gives insight into the orbital character of a
particular state.  By supplying the orbital-list above, the weight
assigned to each state is the fraction of the total norm comes from
the specified list of orbitals.  This weight is written into 
the energy bands file.
<BR><BR>

To see how the orbitals are ordered, run the
energy band program (<B>lm</B> or <B>lmf</B>) with rather high
verbosity (<U>&gt;</U>51) and look for the tables following <font size="+1"><tt>Makidx</tt></font>.

<BR>

Here is a sample output for GaAs run using <b>lmf</b>.  This case
contains two sites, and two additional sites with floating orbitals.


<pre>
 Makidx:  basis arranged in downfolding order:
  ib     low      intermed       high        .. offH ..
   1  spdf (16)       (0)        g (9)       0    0    0
  k2    sd (6)        (0)      pfg (19)     16    0    9
  k3     d (5)        (0)          (0)      22    0   28
   2  spdf (16)       (0)        g (9)      27    0   28
  k2     p (3)        (0)     sdfg (22)     43    0   37
  k3     s (1)        (0)          (0)      46    0   59
   3   spd (9)        (0)       fg (16)     47    0   59
  k2       (0)        (0)    spdfg (25)     56    0   75
   4   spd (9)        (0)       fg (16)     56    0  100
  k2       (0)        (0)    spdfg (25)     65    0  116

 Makidx:  hamiltonian dimensions Low, Int, High, Negl: 65 0 141 94
 kappa   Low   Int   High  L+I  L+I+H  Neglected
   1      50     0    50    50   100       0
   2       9     0    91     9   100       0
   3       6     0     0     6     6      94
  all     65     0   141    65   206      94

 Orbital positions in hamiltonian, resolved by l:
 Site  Spec  Total   By l ...
   1   Ga     1:27   1:1(s)   2:4(p)   5:9(d)   10:16(f) 17:17(s) 18:22(d) 23:27(d)                                     
   2   As    28:47   28:28(s) 29:31(p) 32:36(d) 37:43(f) 44:46(p) 47:47(s)                                              
   3   EA1   48:56   48:48(s) 49:51(p) 52:56(d)                                                                         
   4   EC1   57:65   57:57(s) 58:60(p) 61:65(d)                                                                         
</pre>

This particular hamiltonian has three kinds of orbitals per <i>l</i>
channel ("<i>&kappa;</i>'s"), so there are potentially three groups of
<i>s</i> orbitals, three groups of <i>p</i> orbitals, three groups of
<i>d</i> orbitals, and so on.  They are labelled <font
size="+1"><tt>'1', 'k2', 'k3'</tt></font> in the top table, one set
for each site.  (<font size="+1"><tt>'k3'</tt></font> orbitals are
local orbitals in <b>lmf</b>.)

The left column under <font size="+1"><tt>offH</tt></font> tabulates the number of
orbitals <I>preceding</I> a particular block.  The 'low' block contains 
all basis functions in the actual hamiltonian.

<P>

The &nbsp;<FONT size="+1"><tt>Orbital Positions</tt></FONT>&nbsp; table offers the most convenient way to find
orbitals for color weights for color weights.  The As atom, for
example, occupies columns <font size="+1"><tt>28..47</tt></font> in
the hamiltonian.  To assign a color to orbitals associated with As,
invoke <b>lmf</b> with the <A href="lmto.html#section9lm">--band</A>
switch, modified by the list of orbitals you want to highlight, i.e.
<font size="+1"><tt>--band~col=orbital-list~...</tt></font>.  For example:

  <pre>   lmf --band~col=28:47~syml ... </pre>

will read information about what lines to plot from file <font
size="+1"><tt>syml.ext</tt></font>, and assign a color weight to
orbitals 28..47.  For the general syntax of `<font
size="+1"><tt>orbital-list</tt></font>', see <A
href="Integer-list-syntax.html">Syntax of Integer Lists</A>.

Supposing you wanted to assign a color to just the As <i>p</i>
orbitals.  (The valence band maximum is pure <i>p</i> character; the
conduction band minimum is pure <i>s</i> character.)  As either of the
above tables show, there are two sets of As <i>p</i> orbitals (no
local orbitals in this example). Invoke <b>lmf</b> with:
  <pre>    lmf --band~col=29:31,44:46~syml ... </pre>

<b>lmf</b> (or <b>lm</b>) will place into the bands band file <font
size="+1"><tt>bnds.ext</tt></font> both the eigenvalues and a a
corresponding set of weights which can be used by a graphics package
to highlight band features connected with them.  For example, the
<B>fplot</B> plotting package will use these weights to
color the energy bands according to the weight.  It is a very useful
way to pick out a particular orbital character in the energy bands.

<BR><BR>

To see this feature illustrated, copy <FONT size="+1"><tt>doc/ASAsamples/ctrl.gas</tt></FONT>
to your current working directory.  Verify that the potential is
self-consistent:
<pre>
  lmstr gas
  lm gas
</pre>

Let's select pick out the orbitals of As <I>p</I> character.
To see where there are in the hamiltonian, do
<pre>
  lm gas --pr51 --quit=ham
</pre>
These tables should appear in the output:
<pre>
 Makidx:  basis arranged in downfolding order:
  ib     low      intermed       high        .. offH ..
   1    sp (4)      d (5)   +                0    0    0
   2    sp (4)      d (5)   +                4    5    0
   3    sp (4)      d (5)   +                8   10    0
   4    sp (4)      d (5)   +               12   15    0

 Makidx:  hamiltonian dimensions Low, Int, High, Negl: 16 20 0 0
 kappa   Low   Int   High  L+I  L+I+H  Neglected
   -      16    20     0    36    36       0

 Orbital positions in hamiltonian, resolved by l:
 Site  Spec  Total    By l ...
   1   GA    1:4    1:1(s)   2:4(p)                                                                                     
   2   AS    5:8    5:5(s)   6:8(p)                                                                                     
   3   E1    9:12   9:9(s)   10:12(p)                                                                                   
   4   E2   13:16   13:13(s) 14:16(p)                                                                                   
</pre>
The second atom is the As atom.  Orbitals 6,7,8 are the As <I>p</I> orbitals.
Create a symmetry-lines file or copy one:
<pre> cp <A href="../startup/syml.fcc">startup/syml.fcc</A> ./syml.gas </pre>
Then generate the bands with
<pre>
  lm gas --band~col=6,7,8~fn=syml
</pre>
If you have the FPLOT graphics installed, you can draw a picture with
<pre>
  echo -14,10,5,10 | plbnds -fplot -ef=0 -scl=13.6 -lt=1,col=1,.2,.1,colw=.1,.2,1 -lbl=L,G,X,W,G  bnds.gas
  fplot -f plot.plbnds
</pre>

The blue lines are valence bands, The two heavy hole bands
<I>p<sub>x</sub></I> and <I>p<sub>y</sub></I> character between 0 and
-3 eV.  The valence band are apparently carried mostly by As <I>p</I>
states.  The light hole band of <I>p<sub>z</sub></I> character is
<I>p</I>-like only at &Gamma; ; most of this valence band (running
between 0 and -7 eV) is purple, reflecting the hybridization of the As
<I>p</I> state with other states.

<BR><BR>

Another useful application is to distinguish between majority and
minority bands in the spin-orbit coupled case.  Suppose the basis
consists of 80 orbitals.  With SO coupling, the basis is doubled to
160 orbitals.  Using option ~col=1:80 in the <FONT size="+1"><tt>--band</tt></FONT> switch assigns
whatever weight the first spins contribute to the eigenvalue.  The
color of the energy bands as generated by fplot will be related to its
spin character.

<BR><BR>

One final point: the LMTO basis is not orthogonal, so the inner product
defining the norm is a little different from the orthogonal case.  It is:
<pre>
  &Sigma;<sub>i</sub> (<I>z</I><sub>ni</sub></I>)<sup>-1</sup></I> <I>z</I><sub>in</sub></I>
</pre>
This changes nothing except that it need not be true that each
individual orbital contributes a positive weight to the norm.  The sum
of all contributions is still unity.

<H2><A name="section3"><FONT size="+0">
Pairs of color weights: examples using <b>lmf</b> </FONT></A></H2>

Both <b>lm</b> and <b>lmf</b> will generate <i>two sets</i> of color
weights.  

<P>
For a ready-made example using <B>lmf</B> with spin orbit coupling, run
the Co test case in the standard distribution.
If <FONT size="+1"><tt>lm</tt></FONT> is the top-level directory where the codes are installed, run
<pre>
     <FONT size="+1"><tt>~/lm/fp/test/test.fp co 1</tt></FONT>
</pre>
This test has two sets of <i>spd</i> orbitals in the basis.
The <FONT size="+1"><tt>--band</tt></FONT> switch reads:
<pre>
  --band~col=5:9,dup=9~col2=18+5:18+9,dup=9~fn=syml
</pre>
Orbitals 5-9 are the Co <i>d</i> orbitals of the first set (corresponding to <FONT size="+1"><tt>EH...</tt></FONT>).
String '<FONT size="+1"><tt>dup=#</tt></FONT>' is an extension of the standard integer-list syntax.
It means: take the list generate so far, and replicate each element adding # to it.
In this example orbitals <FONT size="+1"><tt>14:18</tt></FONT> are the <i>d</i> bands of the <FONT size="+1"><tt>EH2</tt></FONT> channel.
The basis consists of 18 orbitals, which is doubled to 36 with spin-orbit coupling.
Thus
<pre>
  col=5:9,dup=9 
and
  col2=18+5:18+9,dup=9
</pre>
correspond respectively to the two pairs of <i>d</i> orbitals of the first spin and of the second spin.  Thus the first color
weight singles out all spin-up states of <I>d</I> character, the second spin-down <i>d</i> states.

<P>

A figure with showing bands with colors corresponding to Mulliken weights,
can be found at the top of the <A href="generating-energy-bands.html">energy bands documentation
</A>.  Instructions for drawing the figure using <b>fplot</b> are also there.

<BR><BR><BR>

The following outlines a more complex example.  Suppose we are studying
Ba<sub>3</sub>ZnTa<sub>2</sub>O<sub>9</sub>, and we want to know which
bands are predominantly Ta character and which are predominantly Zn
character.  Suppose 
<pre>
  lmf --pr51 --quit=band
</pre>
yields this table:
<pre>
   Orbital positions in hamiltonian, resolved by l:
   Site  Spec  Total   By l ...
     1   Ba2     1:19    1:1(s)     2:4(p)     5:9(d)     10:16(f)   17:19(p)                                             
     2   Ba     20:38    20:20(s)   21:23(p)   24:28(d)   29:35(f)   36:38(p)                                             
     3   Ba     39:57    39:39(s)   40:42(p)   43:47(d)   48:54(f)   55:57(p)                                             
     4   Ta     58:78    58:58(s)   59:61(p)   62:66(d)   67:67(s)   68:70(p)   71:75(d)   76:78(p)                       
     5   Ta     79:99    79:79(s)   80:82(p)   83:87(d)   88:88(s)   89:91(p)   92:96(d)   97:99(p)                       
     6   Zn    100:114   100:100(s) 101:103(p) 104:108(d) 109:109(s) 110:114(d)                                           
     7   O1    115:127   115:115(s) 116:118(p) 119:123(d) 124:124(s) 125:127(p)                                           
     8   O1    128:140   128:128(s) 129:131(p) 132:136(d) 137:137(s) 138:140(p)                                           
     9   O1    141:153   141:141(s) 142:144(p) 145:149(d) 150:150(s) 151:153(p)                                           
    10   O2    154:166   154:154(s) 155:157(p) 158:162(d) 163:163(s) 164:166(p)                                           
    11   O2    167:179   167:167(s) 168:170(p) 171:175(d) 176:176(s) 177:179(p)                                           
    12   O2    180:192   180:180(s) 181:183(p) 184:188(d) 189:189(s) 190:192(p)                                           
    13   O2    193:205   193:193(s) 194:196(p) 197:201(d) 202:202(s) 203:205(p)                                           
    14   O2    206:218   206:206(s) 207:209(p) 210:214(d) 215:215(s) 216:218(p)                                           
    15   O2    219:231   219:219(s) 220:222(p) 223:227(d) 228:228(s) 229:231(p)                                           
   suham :  375 augmentation channels, 375 local potential channels
</pre>

Invoke
  <pre>    lmf --band~col=58:99~col2=100:114~syml ... </pre>
to assign the first color weights to the two Ta atoms, and the second
color weight to Zn.


</HTML>
