<HTML><HEAD><TITLE>CPA Enhancement of the Green's function package (v7.8) </TITLE><STYLE><!--P{font-size : medium;} --></STYLE></HEAD><BODY bgcolor="#cccccc">
<H1><B><FONT size="+2">CPA Enhancement of the Green's function package (v7.8)</FONT></B></H1>

As of version 7.8, <B>lmgf</B> contains an implementation of the
Coherent Potential Approximation (CPA) and Disordered Local Moments (DLM) theory.
It was implemented by Kirill Belashchenko and questions should be directed to him
(<FONT size="+1"><tt>belashchenko@unl.edu</tt></FONT>).

<P><P>

The CPA implementation for substitutional alloys and for spin disorder
follows the formulation explained in these articles:
<pre>
I. Turek et al., Electronic strucure of disordered alloys, surfaces and interfaces (Kluwer, Boston, 1996).
J. Kudrnovsky and V. Drchal, Phys. Rev. B 41, 7515 (1990).
J. Kudrnovsky, V. Drchal, and J. Masek, Phys. Rev. B 35, 2487 (1987).
</pre>

Particularly, see the description of the numerical implementation in
Turek's book. 

<P><P>

CPA self-consistency is based on iterating the coherent
interactor &Omega;, which is a spin-dependent single-site matrix defined
for each CPA site at each complex energy point. The linear mixing of
&Omega; can be interleaved with charge mixing steps. However, experience
shows that much faster convergence can be achieved by iterating &Omega;
at each z-point until its misfit reaches a sufficiently low tolerance
(say, 1d-3), between charge mixing steps. In addition, it is better to
skip charge mixing if sufficiently accurate charge-neutrality has not
been achieved (the reason being that &Omega; is not
<A href="gf.html#section2">Pade-adjusted</A>). There are a few
parameters controlling &Omega; convergence, which are summarized below
along with the recommended settings that work quite well in most
cases. The &Omega; matrices are recorded in files 
<FONT size="+1"><tt>omegaN.ext</tt></FONT>, where N is
the number of the CPA site. A human-readable version (with fewer
decimal digits) is recorded in <FONT size="+1"><tt>om-hrN.ext</tt></FONT>.

<H2><A name="section1"><FONT size="+1">
CPA-specific input
</FONT></A></H2>

To turn on chemical and/or magnetic CPA, additons are required to
the <FONT size="+1"><tt>SPEC</tt></FONT> and 
<FONT size="+1"><tt>GF</tt></FONT> categories in
the <FONT size="+1"><tt>ctrl</tt></FONT> file.

<H2><A name="section1.2"><FONT size="+0">
SPEC category
</FONT></A></H2>

<P> <FONT color="#bb3300"><I>Chemical Disorder</I>.</FONT>

Additional species must be defined for chemical CPA, and their concentrations.

<pre>
SPEC ATOM CPA= and C= together turn on chemical CPA for a particular species.
</pre>
They specify which species are to be alloyed with this species, and the concentrations
of the other species.  For example, 
<pre>
SPEC ATOM=Fe ... CPA=1 4 5 C=0.5 0.3 0.2 
</pre>
specifies that species <FONT size="+1"><tt>Fe</tt></FONT> (whenever it
appears in the basis (defined in <FONT size="+1"><tt>SITE</tt></FONT>
category) in fact refers to a disordered site composed of three kinds
of elements.  Numbers following <FONT size="+1"><tt>CPA=</tt></FONT>
refer to indices in the SPEC category: thus "<FONT size="+1"><tt>CPA=1
4 5</tt></FONT>" indicate that the three elements to be identified
with sites referring to this species are the 1<sup>st</sup>,
4<sup>th</sup>, and 5<sup>th</sup> species declared in
the <FONT size="+1"><tt>SPEC</tt></FONT> category.
<FONT size="+1"><tt>C=</tt></FONT> indicates the concentrations
of each species; the concentrations must sum to 1.  In the example given,
sites with species label <FONT size="+1"><tt>Fe</tt></FONT> are
composite elements with with 50% of species 1, 30% of species
4 and 20% of species 5 (up to 10 species may be given).

<P>
A CPA species may
refer to itself. For example, if the
<FONT size="+1"><tt>Fe</tt></FONT> species above is the first species
to be read from the <FONT size="+1"><tt>ctrl</tt></FONT> file,
then <FONT size="+1"><tt>CPA=1</tt></FONT> refers to itself.
All other parameters like
<FONT size="+1"><tt>Z</tt></FONT>, 
<FONT size="+1"><tt>R</tt></FONT>, 
will be taken from this species.

<P> 

<FONT color="#bb3300"><I>Spin Disorder</I>.</FONT>  No additional
species are required, but the number of orientations must be
specified.

<pre>
SPEC ATOM NTHET= turns on spin disorder for a particular atom type.
</pre>
A species with non-zero <FONT size="+1"><tt>NTHET</tt></FONT> can be
listed as a CPA component, and it will be included as 
<FONT size="+1"><tt>NTHET</tt></FONT> components with different
directions of the local moment.

<P>

<FONT size="+1"><tt>NTHET=2</tt></FONT> specifies that there will be
two CPA-DLM components with polar angles 0 and &pi;. 
<FONT size="+1"><tt>NTHET=N </tt></FONT> with
<FONT size="+1"><tt>N>2</tt></FONT>
specifies a vector-DLM model, for which 
<FONT size="+1"><tt>N</tt></FONT> polar angles for the local moment
direction are selected using the Gaussian quadrature for the
sphere. (Axial symmetry is always assumed and the integral over the
azimuthal angle is taken analytically.)

<P>
<FONT color="#bb3300"><I>Combined Chemical and Spin Disorder</I>.</FONT>

Either spin or chemical disorder may be specified; they may also be
included simultaneously.
If only 
<FONT size="+1"><tt>CPA=</tt></FONT> is chosen, that species will be
treated with chemical, not spin, disorder.
If only <FONT size="+1"><tt>NTHET=</tt></FONT> is chosen, that species
be treated with spin disorder only.  Specifying both means that the
CPA will include <i>both</i> chemical and spin disorder.

For example, in the above example for CPA, if <FONT size="+1"><tt>SPEC ATOM=Fe</tt></FONT>
includes a tag
<FONT size="+1"><tt>NTHET=2</tt></FONT> (while species 4 and 5 have
<FONT size="+1"><tt>NTHET=0</tt></FONT>), species 
<FONT size="+1"><tt>Fe</tt></FONT> describes a CPA site with 4
components: 25% <FONT size="+1"><tt>Fe</tt></FONT>, 25% 
<FONT size="+1"><tt>Fe</tt></FONT> with a reversed local moment, 30%
species 4 and 20% species 5.

<P>

<H2><A name="section1.1"><FONT size="+0">
GF category
</FONT></A></H2>

<P>
The following token turns on the CPA and/or DLM:
<pre>
GF DLM= controls what is being calculated. 
</pre>
At present, these values are supported:
<pre>
  DLM=12: normal CPA calculation; both charges and &Omega;'s are iterated
  DLM=32: no charge self-consistency; only CPA it iterated until &Omega; reaches
          prescribed tolerance for each z-point.
  DLM=112: special-purpose experimental branch (not documented)
</pre>

The following are optional inputs:
<pre>
GF BXY=1 turns on the self-consistent determination of the
   constraining fields for vector DLM calculations.

GF TEMP= supplies the spin temperature (not implemented yet)
</pre>

<P>
Self-consistency in &Omega; is controlled by the following tags supplied
in GF GFOPTS:

<pre>
lotf    if present, &Omega; is iterated at each <i>z</i>-point until converged to omgtol (recommended)
nitmax= maximum number of &Omega; iterations (30 is usually sufficient)
omgmix= linear mixing parameter for &Omega; (0.4 works well in most cases)
omgtol= tolerance for &Omega;
padtol= same meaning as usual, but note that &Omega; is not mixed unless padtol is reached (1d-3 is recommended for all CPA calculations)
dz=     special branch, in which <i>z</i>-points are shifted by dz along the real axis (experimental)
</pre>

Recommended options:
<pre>
GF GFOPTS=[...];omgmix=0.4;padtol=1d-3;omgtol=1d-3;lotf;nitmax=30
</pre>

<FONT color="#bb3300"><I>Compatibility with other features</I>.</FONT><P>

Downfolding is supported. Note, however, that downfolding applies to the
crystal Green's function and not to individual CPA components. The downfolding
options are taken from the first species appearing in the CPA list.

Gamma representation is supported with a caveat. CPA does not allow random
structure constants, which means that the screening parameters must be the
same for all components on the same CPA site. In the present implementation,
the screening parameters are taken from the first class listed for the given
CPA site (for a DLM site this is angle #1).

<P>
<FONT size="+1"><tt>LDA+U</tt></FONT> is not supported, and density
matrices are not calculated for the components on the CPA
site. However, the modes 
<FONT size="+1"><tt>IDU=4</tt></FONT> and
<FONT size="+1"><tt>IDU=5</tt></FONT> are supported. The 
<FONT size="+1"><tt>U</tt></FONT>
and <FONT size="+1"><tt>J</tt></FONT> parameters for these modes are
taken from the first species appearing in the CPA list.

<P>
Broyden mixing for charged works fine if 
<FONT size="+1"><tt>omgtol</tt></FONT> is set to a sufficiently low
value. If Broyden mixing seems to act strangely, try to reduce 
<FONT size="+1"><tt>omgtol</tt></FONT>.  Charge self-consistency in
CPA may sometimes be difficult for impurities with low
concentrations. (Note that an isolated impurity can be described by
adding it as a CPA component with zero concentration.)

<P><FONT color="#bb3300"><I>Atomic files</I></FONT><P>

It is important to understand the atomic file handling with CPA. For a CPA
site (say, species 
<FONT size="+1"><tt>Fe</tt></FONT>) the code creates an atomic file
per each CPA component.  In the above example with 
<FONT size="+1"><tt>SPEC ATOM=Fe ... NTHET=2 CPA=1 4 5</tt></FONT>
there will be four atomic files: 
<FONT size="+1"><tt>fe#1.ext</tt></FONT> for 
<FONT size="+1"><tt>Fe</tt></FONT>
 with angle 0, 
<FONT size="+1"><tt>fe#2.ext</tt></FONT>
for <FONT size="+1"><tt>Fe</tt></FONT> with angle &pi;, 
<FONT size="+1"><tt>fe#3.ext</tt></FONT>
for species type 4, and 
<FONT size="+1"><tt>fe#4.ext</tt></FONT> for species type 5.  Note
that <FONT size="+1"><tt>fe#3</tt></FONT> and 
<FONT size="+1"><tt>fe#4</tt></FONT> will not actually correspond to
Fe atoms, but to those described by species 4 and 5.  Because
convergence can be delicate, it is always recommended to copy
appropriately prepared atomic files before attempting a CPA
calculation. In the above example, converge a Fe atom and copy the
atom file to <FONT size="+1"><tt>fe#1.ext</tt></FONT>
and <FONT size="+1"><tt>fe#2.ext</tt></FONT>; then converge species
type 4 and copy it to <FONT size="+1"><tt>fe#3.ext</tt></FONT>, and so
on. For DLM with 
<FONT size="+1"><tt>NTHET=N</tt></FONT>, make <i>N</i> copies of the atomic file: say,
<FONT size="+1"><tt>fe#1.ext</tt></FONT>, <FONT size="+1"><tt>fe#2.ext</tt></FONT>, ..., 
<FONT size="+1"><tt>fe#N.ext</tt></FONT>.

<P><FONT color="#bb3300"><I>Outputs</I></FONT><P>

At the beginning of the run, some debugging information is printed,
listing the indexing for the CPA
sites. <FONT size="+1"><tt>DLMWGTS</tt></FONT> lists the polar angles
(0 for non-DLM classes) and weights for all CPA classes (this is also
for debugging purposes). <FONT size="+1"><tt>GETZV</tt></FONT> prints
the total valence charge, which in CPA is generally not
integer. Output for each CPA component includes the usual information
(charge, local moment, etc.).

Exchange constants <i>J</i><sub>0</sub> are automatically calculated
for all CPA components using the linear response formula from
Liechtenstein et al. (it can not be disabled, but the computational
cost in any case negligible).  Off-diagonal local moments and
constraining fields are always printed out, even if DLM is not
used. These include the diagonal local moment as well. All these
moments are output, unmixed values. In the self-consistent state the
<i>z</i>-component should equal to the input moment.

<P>

At the end of the iteration &Omega; is mixed, and its misfit for each
CPA site is printed out (see "Mixed Omega for site ...")

The total energy is correctly calculated and printed out as 
<FONT size="+1"><tt>ehk</tt></FONT>, as usual.

<P><FONT color="#bb3300"><I>Partial densities of states</I></FONT><P>

Partial DOS can be calculated as usual using contour type 2 and adding 
<FONT size="+1"><tt>pdos</tt></FONT> to the 
<FONT size="+1"><tt>GFOPTS</tt></FONT> tag. Note that in this case
&Omega; needs to be converged anew at each point of the new
contour. This destroys the old converged &Omega; file, so it is
recommended to create a separate directory for a DOS calculation. The
file <FONT size="+1"><tt>dos.ext</tt></FONT> contains the usual
information, but the data for CPA sites are averaged over
components. The partial DOS for all components are separately recorded
in files <FONT size="+1"><tt>dosN.ext,</tt></FONT> where N is the
number of the CPA site. The format of this file is the same as that of
<FONT size="+1"><tt>dos.ext</tt></FONT>, as if it described a system
with <i>M</i> sites (where <i>M</i> is the number of CPA
components). For example, for a binary CPA on site 2 with <i>spd</i>
basis, file <FONT size="+1"><tt>dos2.ext</tt></FONT> contains channels
1:6 for the first CPA component and channels 7:12 for the second CPA
component. This file can be processed using <b>pldos</b>, as a
conventional <FONT size="+1"><tt>dos</tt></FONT> file.

<P><FONT color="#bb3300"><I>Spectral Functions</I></FONT><P>

<b>lmgf</b> can generate spectral functions.
It is very useful way to see the broadening of states from disorder, and you can plot energy bands with it.
<A href="SpectralFunction.html">This document</A> explains how to make them and draw energy bands.



