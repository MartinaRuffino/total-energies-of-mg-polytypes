<HTML><HEAD><TITLE>Energy bands(v7.8) </TITLE></HEAD><BODY bgcolor="#cccccc">
<H1><B><FONT size="+2">Making and plotting energy bands (v7.8)</FONT></B></H1>

<IMG
 WIDTH="350" HEIGHT="350" ALIGN="LEFT" BORDER="0"
 SRC="co-bands.png"
>

Programs <b>lmf</b>, <b>lm</b>, <b>tbe</b> can generate energy bands
for a set of specified <i>k</i>-points.  A particularly useful and
unique feature of the band generator is the ability to generate bands
with color weights, that is the band color at a particular
<i>k</i>-point is a connected to a weight obtained from the
eigenvectors.  The meaning of the weights and how to select them is described
in the <A href="ASAtutorial.html#bandweights">ASA tutorial</A>.  A common choice is
to select out a particular <i>l</i> channel.  The figure shows bands
of Co, with green identifying the majority <i>d</i> band, red the
minority <i>d</i> band, and blue everything else.

<BR> You should be able to generate this figure using the <b>lmf</b> code with the following command.
If <FONT size="+1"><tt>lm</tt></FONT> is the top-level directory where the codes are installed, run
<pre>
     <FONT size="+1"><tt>~/lm/fp/test/test.fp co 1</tt></FONT>
</pre>
This will generate a self-consistent potential as well as energy bands.
To generate the figure you will need a suitable plotting package.  The figure shown
was generated with the <b>fplot</b> package, version <FONT size="+1"><tt>FPLOT.3.45.tar.gz</tt></FONT>, with these commands:
<pre>
 echo -10,5,5,10 | plbnds -fplot -ef=0 -scl=13.6 -lt=1,col=0,0,1,colw=1,0,0,colw2=0,1,0 -lbl=M,G,A,L,G,K bnds.co
 fplot -f plot.plbnds
<P><BR><BR><BR>
</pre>
See <A href="ASAtutorial.html#section3">this section</A> of the ASA tutorial
for further discussion of this example.

<BR><BR><BR>

Programs that make bands <i>E</i>(<i>k</i>) use a common interface to
read <i>k</i> points and write bands.  See the <A href="ASAtutorial.html#bands">ASA tutorial</A> or the <A
href="FPtutorial.html#bands">FP tutorial</A> for illustrations; for further details on
how to highlight bands with color weights, read
<A href="ASAtutorial.html#bandweights">this section</A> of the ASA tutorial.

<P>

When these programs encounter <FONT size="+1"><tt>&nbsp;--band&nbsp;</tt></FONT>
on the command-line, they generate energy
levels on a list of
<i>k</i>-points (e.g. bands) rather than go through the standard cycle
of integration of states over the Brillouin zone.

<P>
The general syntax (common to all programs) is:
<pre>
  lmf|lm|tbe --band[~option~option...] <i>ext</i>
</pre>

<H2><A name="switches"><FONT size="+1">Default operation using &nbsp;<FONT size="+1"><tt>--band</tt></FONT>&nbsp;switch</FONT></A></H2>

The set of <i>k</i>-points are specified in a file.  Unless otherwise
specified, the following defaults are used:

<OL><LI>
The file name is <FONTsize="+1"><tt>qp.<i>ext</i></tt></FONT>

<LI>
The format of <FONTsize="+1"><tt>qp.<i>ext</i></tt></FONT> is designed for drawing bands along specified lines in <i>k</i>.
The user supplies the starting <i>k</i>, the ending <i>k</i>, and number of points <i>n<sub>k</sub></i>, 
in this order:
<br>
<FONT size="+1"><tt>
&nbsp;&nbsp;
    <i>n<sub>k</sub></i>  <i>k</i><sub>start</sub>  <i>k</i><sub>end</sub>
</tt></FONT>
<br>

<LI> 
Bands are written in an ASCII format to file <FONT size="+1"><tt>bnds.<i>ext</i></tt></FONT>.
The format of <FONT size="+1"><tt>bnds.<i>ext</i></tt></FONT> depends on 
the <A href="#formatmode">mode</A> 
used to read <i>k</i> points.

<LI> 
The Fermi level will be written to the bands file.  An attempt is
made to read the Fermi level from program-generated file <FONT
size="+1"><tt>wkp.<i>ext</i></tt></FONT>.

</OL>

The default mode is intended to draw bands on specified symmetry lines.
In addition to the default mode, <A href="#formatmode">alternative modes</A> are available (list and mesh mode for contour plots), with different purposes.


<H2><A name="switches"><FONT size="+1">Options to &nbsp;<FONT size="+1"><tt>--band</tt></FONT>&nbsp;switch</FONT></A></H2>


Options to switch &nbsp;<FONT size="+1"><tt>--band</tt></FONT>&nbsp;
can modify each of these default actions.  Specify options by,
e.g. <FONT size="+1"><tt>--band[~option][~option]...</tt></FONT>.  A
summary of available options are as follows:

<pre>
  Options:
  ~qp          list mode. An arbitrary list of <i>k</i> points can be specified.
               See <A href="#formatmode">Modes for Reading <i>k</i>-point Lists</A> for further description.

  ~con         mesh mode for contour plot.
               <i>k</i>-points are specified on a uniform 2D grid;
               data is written for a specified list of bands.
               See <A href="#formatmode">Modes for Reading <i>k</i>-point Lists</A> for further description.

  ~bin         write bands as a binary file, file name <b>bbnds.ext</b>.
               NB: works only with ~qp and ~con options.

  ~fn=<b>fnam</b>     read <i>k</i> points from file <b>fnam</b>.<i>ext</i>
               Default name is qp.<i>ext</i> .

  ~ef=#        Use # for Fermi level.

  ~spin1       generate bands for 1st spin only (spin polarized case)

  ~spin2       generate bands for 2nd spin only (spin polarized case)

  ~mq          q-points are given as multiples of reciprocal lattice vectors
               Applies to symmetry line and qp-list modes only

  ~long        write bands with extra digits precision
               (has no effect for default mode)

  ~rot=<b>strn</b>    rotates the given <i>k</i> by a rotation defined by <b>strn</b>.
               The syntax is defined in <A href="rotations.html">rotations.html</A>.
               
  ~lst=<b>list</b>    write only a subset of energy levels by an integer list.
               (contour mode only)
               For syntax of <b>list</b>, see <A href="Integer-list-syntax.html">Integer-list-syntax.html</A>.

  ~nband=#     Write out no more than # bands (not to be used in conjunction with ~lst !)

  ~col=<b>orbital-list</b>    assign weights to orbitals specified in a list.
               For syntax of <b>orbital-list</b>, see <A href="Integer-list-syntax.html">Integer-list-syntax.html</A>.

               This option tells the band generator to save, in addition to
               the energy bands, a corresponding weight for each energy.
               Each band is resolved into individual orbital character by a Mulliken decomposition
               The sum of Mulliken weights from <b>orbital-list</b> is the weight assigned to a state.
               Thus if <b>orbital-list</b> contains all orbitals the weights will be unity.

               The individual orbitals make up the hamiltonian basis. States specified in <b>orbital-list</b>
               corresponding to the ordering of the orbitals in the hamiltonian.  You can get a
               table of this ordering by invoking <FONT size="+1"><tt>[<b>lm|lmf</b>] --pr55 --quit=ham ...</tt></FONT>
               Choose <b>orbital-list</b> from the orbitals you want to select out of the Table.

               This list can sometimes be rather long and complex.  To accomodate this, 
               there are simple enchancements to the standard <A href="Integer-list-syntax.html">integer-list syntax</A>.
               See below and in the <A href="ASAtutorial.html#section3">this section</A> of ASA tutorial for further
               description of how the bands were generated for Co shown above.

               Note: <b>tbe</b> does not yet have this capability.

  ~col2=<b>orbital-list</b>   generate a second weight to orbitals specified in a list.
               With this option you can make band plots
               with three independent colors.

  ~evn=#       keep track of smallest and largest eval for #th band.
               Print result at close.
</pre>

Example command-line arguments:
<pre>
  --band~mq~col=161:220~fn=syml      &larr;  <A href="#symmetrylinemode">symmetry line mode</A>
  --band~long~qp~lst=2:5             &larr;  qp <A href="#listmode">list mode</A>
  --band~con~fn=fs                   &larr;  <A href="#contourmode">mesh mode</A> for, e.g. Fermi surfaces
</pre>


<!-- qp file modes -->

<H2><A name="formatmode"><FONT size="+1">Modes for Reading <i>k</i>-point Lists</FONT></A></H2>

<i>k</i>-point are specified in the input files as one of three types, or modes.  

<LI>  The (default)
<B><A href="#symmetrylinemode">symmetry line mode</A></B>
is designed for plotting energy bands along symmetry lines.  In this
case <i>k</i>-points are specifed by a sequences of lines with start
and end points.  The output is a bands file in a specially adapted format.

<LI>  
The <B><A href="#listmode">list mode</A></B> is a general purpose mode
to be used when energy levels are sought at some arbitrary set of
<i>k</i>-points, specified by the user.  Data is written in a standard
format with k-points followed by eigenvalues.

<LI>  
The <B><A href="#contourmode">mesh mode</A></B> is a mode that
generates states on a uniform mesh of <i>k</i>-points in a plane.  Its
purpose is to generate contour plots of constant energy surfaces,
e.g. the Fermi surface. Data file output is written in a special mode, with 
levels for a particular band at all <i>k</i> written as a group.

<OL>


<UL>
<H2><A name="symmetrylinemode"><FONT size="+1" color="#bb3300">Symmetry line mode</FONT></A></H2>
This is the default mode.  The <i>k</i>-points file consists of a list
of symmetry lines and the number of <i>k</i>-points in each line.
Each line of text in the file specifies one symmetry line with the syntax

<pre>
                   #pts  start-k   end-k
</pre>

<FONT size="+1"><tt>start-k</tt></FONT> and <FONT size="+1"><tt>end-k</tt></FONT> each consist of three
numbers specifying a <i>k</i>-point.  The set of lines is ended by a final line,
where <FONT size="+1"><tt>#pts</tt></FONT> is zero.  For example:
<pre>
                   51   0  0  0    0  0  1
                   51   0  0  1    0 .5 .5
                   0    0  0  0    0  0  0
</pre>

<i>Output, symmetry-line mode</i> <BR>

Bands are written to file <FONT size="+1"><tt>bnds.ext</tt></FONT> in
a format specially tailored to symmetry lines.
The first line consists of of a header, which contains the (maximum) number of
bands, the Fermi level, and the number of color weights, e.g.:
<pre>
   44  -0.01870     0
</pre>
Next follow, for each symmetry line:
<UL>
<LI>
 A line with specifying the number of points for the current symmetry line.
 Next follow for each point <i>i</i>:
<UL>
<LI>
a line containing <i>k<sub>i</sub></i> (3 numbers).
<LI>
one or more lines with the energy levels for <i>k<sub>i</sub></i>
</LI>
</UL>
</LI>
</UL>

<i>Plotting, symmetry-line mode</i> <BR>

An auxillary program, <b>plbnds</b>, can read this file format and
generate a band picture in postscript.  Alternatively, <b>plbnds</b>
can generate data files and a set of plotting instructions for the
plotting program <b>fplot</b>.
<b>plbnds</b> and <b>fplot</b> come in a separate
package, <b>FPLOT.vsn.tar.gz</b>.

<H2><A name="listmode"><FONT size="+1" color="#bb3300">List mode</FONT></A></H2>

This mode is specifed by, e.g. command line argument <FONT size="+1"><tt>--band~qp</tt></FONT>. <BR>

Use this mode to generate energy levels for a particular set of 
<i>k</i>-points.  The <i>k</i>-points file consists of a list of points, e.g.

<pre>
                 -.01  0  0
                   0   0  0
                  .01  0  0
</pre>

The file format is very flexible; data is read according to a standard
format used for reading 2D arrays, as described <A
href="array-file-format.html">here</A>.  This file must
have 3 columns, corresponding to the <i>x,y,z</i>, components of
<b>k</b>.  The number of rows in the array are the number of <i>k</i>
points.  

<BR> <i>Alternative file format</i> <BR>

There is an alternative format available for this mode: it is the
format automatically generated by <FONT
size="+1"><tt>BZ_PUTQP=t</tt></FONT>, or by the command-line switch
<FONT size="+1"><tt>--putqp</tt></FONT>.  When this switch is set, <b>lm</b> (or similar programs that do numerical
integrations over the Brillouin zone) will save information about the
<i>k</i>-points it uses for integration to file <FONT
size="+1"><tt>qpts.ext</tt></FONT>.  "List" mode can read this format;
there is some flexibility in the format also.  As a minimum the first
line should consist of <FONT size="+1"><tt>nkp=#</tt></FONT>, which
specifies the number of
<i>k</i>-points in the file.  Then follows a list of <i>k</i>-points,
e.g.

<pre>
   nkp=2  
    1  0.100000000000D+00  0.000000000000D+00  0.000000000000D+00
    2 -2.600000000000D-01  2.500000000000D-01  2.500000000000D-01
</pre>

The file reader will automatically distinguish between
<b>mcx</b>-compatible formats and formats compatible with those
autogenerated by <FONT size="+1"><tt>PUTQP=t</tt></FONT>.

<BR> <i>Output, list mode</i> <BR>

Bands are written in the standard 2D array format used by matrix
calculator <b>mcx</b>.  The first three columns are the <i>k</i> point;
the remaining columns are the bands.  If color weights are specified,
an additional group of columns are appended.

<BR> <i>Plotting, list mode</i> <BR>

Because the <i>k</i>-points need not follow any particular pattern,
there is no generic plotting scheme.  As noted, the format can be read by
<b>fplot</b>, and easily read by other programs such as MATLAB.


<BR> <i>Additional options, list mode</i> <BR>

The list mode has additional sub-options, that make it convenient to
collate distinct groups of <i>k</i>-points into a single list.
Switch
<pre>
  --band~qp~...
</pre>
may be extended with any of these switches:
<pre>
  --band~qp[,inc=<i>expr</i>][,merge=fnam][,save=fnam]~...
</pre>

<ul type="square">
<LI>
<FONT size="+1"><tt>[,inc=expr]</tt></FONT> causes the list reader to
parse each <i>k</i>-point, and exclude those for which <i>expr</i> is
not satisfied.  <i>expr</i> is an ASCII string containing an algebraic
expression.  <i>expr</i> can (and is expected to) contain <i>k</i>-point
specific variables, which include:
<pre>
  iq   <i>k</i>-point index
  qx   <i>k<sub>x</sub></i>
  qy   <i>k<sub>y</sub></i>
  qz   <i>k<sub>z</sub></i>
  q    |<b>k</b>|=[<i>k<sub>x</sub></i><sup>2</sup>+<i>k<sub>y</sub></i><sup>2</sup>+<i>k<sub>z</sub></i><sup>2</sup>]<sup>1/2</sup>
</pre>
The expression should be integer (returning 0 or nonzero). 
Example:
<pre>
  --band~qp,inc=q<1/2
</pre>
In this case only <i>k</i>-points read from the file whose magnitude is
less than 0.5 will be retained.

<LI>
<FONT size="+1"><tt>[,merge=fnam]</tt></FONT> causes the list reader
to read a <i>second</i> file (named <FONT
size="+1"><tt>fnam.ext</tt></FONT>, (in an acceptable qp format mode)
and append the list read from it to the original list.

<LI>
<FONT size="+1"><tt>[,save=fnam]</tt></FONT> causes the list reader to
write the final <i>k</i>-points list to file <FONT
size="+1"><tt>fnam.ext</tt></FONT>.  After writing the program automatically stops.

</UL>

<H2><A name="contourmode"><FONT size="+1" color="#bb3300">Mesh mode</FONT></A></H2>

In this mode <i>k</i>-points are generated on a uniform 2D mesh,
intended for contour plots.  Invoke with
<pre>
  --band~con~...
</pre>

The mesh is specified by a file containing lines of the form
<pre>
                    <i>v<sub>x</sub>     range  n<sub>x</sub>     v<sub>y</sub>     range  n<sub>y</sub>   height  band</i>
</pre>      
where:
<pre>
                   <i>v<sub>x</sub></i> and <i>v<sub>y</sub></i> are two reciprocal lattice vectors defining a plane
                   <i>range</i> is a pair of numbers marking starting and ending points along each vector
                   <i>n<sub>x</sub></i> and <i>n<sub>y</sub></i> are the number of divisions along the first and second vectors
                   <i>height</i> specifies the offset normal to the plane
                   <i>band</i> specifies which band is to be saved. 
</pre>
Example:
<pre>
       1 0 0   -1 1   51   0 1 0   -1 1   51   0.00    4,5
</pre>

<BR> <i>Output, mesh mode</i> <BR>

Bands are written in the standard 2D array format used by matrix
calculator <b>mcx</b> and the <i>xy</i> plotting program <b>fplot</b>.
The number of rows is the number of divisions in the first vector; the
number of columns is the number of divisions in the second vector.  No
<i>k</i> point information is written (it is implicit in the uniform
mesh).

<BR> <i>Plotting, mesh mode</i> <BR>

If you have the graphics package <b>fplot</b> installed, you can
easily plot Fermi surfaces in conjunction with the files generated in the mesh mode.


<H2><A name="deform"><FONT size="+1">Transformation of the supplied <i>k</i>-points</FONT></A></H2>

The <i>k</i>-points as supplied from the input file can be transformed.

This is useful in several contexts.  If spin-orbit coupling is present
on the bands depend on the relative orientation of the coordinate
system and spin quantization axis (the <i>z</i> axis by default).

In an angle-resolved photoemission experiment, <b>k</b> normal to the
surface (<i>k</i><sub>&perp;</sub>) is modified on exiting the
surface, whereas <b>k</b><sub>&#8741;</sub> is conserved.  This means that
<b>k</b> measured by ARPES slightly different from <b>k</b> calculated
from the band structure.  The larger the kinetic energy the smaller
the effect, but in typical PE experiments it is not negligible.

<P>

There are two ways to transform the <b>k</b> point.  The first is to use
the <FONT size="+1"><tt>~rot=</tt></FONT> option to
the <FONT size="+1"><tt>--band</tt></FONT> switch (see above).  The second
is through a sequence of algebraic expressions which you specify in the
first line of the <i>k</i>-points input file.  This line consists of a sequence of algebraic expressions,
which generate one or more of <i>k</i><sub><i>x</i></sub>, <i>k</i><sub><i>y</i></sub>, or 
<i>k</i><sub><i>z</i></sub>, which modifies one of more of the Cartesian components of <b>k</b>.

<P>

To modify <i>k</i><sub><i>x</i></sub>, <i>k</i><sub><i>y</i></sub>, or <i>k</i><sub><i>z</i></sub>
insert a line at the beginning of the file.
The first character must be a '%', followed by one or more strings with algebraic expressions defining the <i>x</i>-, 
<i>y</i>, and <i>z</i> components of the modified <b>q</b>:
<pre>
%   [var=<i>expr</i> var=<i>expr</i> ...]   kx=<i>expr</i>  ky=<i>expr</i>  kz=<i>expr</i>
</pre>
<FONT size="+1"><tt>kx,ky,kz</tt></FONT> are the Cartesian coordinates of the modified <i>k</i>-point.

<FONT size="+1"><tt><i>expr</i></tt></FONT> are algebraic expressions involving these variables:
<pre>
  qx   <i>k<sub>x</sub></i>
  qy   <i>k<sub>y</sub></i>
  qz   <i>k<sub>z</sub></i>
  q    |<b>k</b>|=[<i>k<sub>x</sub></i><sup>2</sup>+<i>k<sub>y</sub></i><sup>2</sup>+<i>k<sub>z</sub></i><sup>2</sup>]<sup>1/2</sup>
</pre>
The expression should be integer (returning 0 or nonzero). 
Example:
<FONT size="+1"><tt>qx,qy,qz,q</tt></FONT> are the cartesian components and absolute value of the unmodified <i>k</i>-point.

Any of the 
<FONT size="+1"><tt>kx=<i>expr</i>  ky=<i>expr</i>  kz=<i>expr</i></tt></FONT>
may be present; any missing component will be left unchanged from its original value.

This example in symmetry line mode modifies <i>k<sub>x</sub></i> such that the kinetic energy is increased by .1^2 a.u.
<pre>
% map kx=(q^2+.1^2-qy^2-qz^2)^.5
41  .5 .5 .5     0  0 0                L to Gamma
...
</pre>

<P> You should verify that code reading the k-points modified the q points by inspecting the output.
It should contain the following lines:

<pre>
 suqlst: map qp using the following:
 kx=(q^2+.1^2-qy^2-qz^2)^.5
</pre>

The <FONT size="+1"><tt>~rot=</tt></FONT> switch may be used in conjuction
with the modification through alegbraic expresssions.  For example suppose
you want to modify <i>k</i><sub>&perp;</sub> normal to the (1,-1,0) direction,
while preserving <b>k</b><sub>&#8741;</sub> in the (1,1,0),(0,0,1) plane.

<P> Take Cu as a concrete example.  If <FONT size="+1"><tt>lm</tt></FONT>
is your top-level directory, set up the calculation for Cu with
<pre>
~/lm/fp/test/test.fp cu 1
</pre>
This should set up a self-consistent potential for Cu and save generate energy bands in file
<FONT size="+1"><tt>bnds.cu-pwmode11</tt></FONT>.

The input file as constructed uses the normal Cartesian coordinates for a cube.  But if
you invoke <b>lmf</b> with <FONT size="+1"><tt>-vrot=t</tt></FONT>, viz
<pre>
lmf -vrot=t cu --showp 
</pre>
you will see that token <FONT size="+1"><tt>STRUC_ROT=z:pi/4</tt></FONT> appears in the preprocessed input file.
This tells <b>lmf</b> to rotate the crystal axes, the basis vectors, and the symmetry group operations.
Rotation <FONT size="+1"><tt>(1,-1,0)pi/2</tt></FONT> rotates (1/2,1/2,0) to the -z axis.
Do this:
<pre>
lmf -vrot=t cu --quit=ham
</pre>
and you should see:
<pre>
           Lattice vectors:                         Transformed to:
   0.0000000   0.5000000   0.5000000     0.1035534   0.6035534  -0.3535534
   0.5000000   0.0000000   0.5000000     0.6035534   0.1035534  -0.3535534
   0.5000000   0.5000000   0.0000000     0.0000000   0.0000000  -0.7071068
</pre>

Run the band calculation exactly as was done in the test case, but modify it as follows.
Replace the original
<pre>
  lmf  --no-iactiv cu -vnk=8 -vbigbas=t -vpwmode=11 -voveps=0d-7 --band:fn=syml
</pre>
with:
<pre>
  lmf  --no-iactiv cu -vnk=8 -vbigbas=t -vpwmode=11 -voveps=0d-7 -vrot=t --rs=101 '--band~rot=(1,-1,0)pi/2~fn=syml'
</pre>
<FONT size="+1"><tt>--rs=101</tt></FONT> tells the charge density reader to rotate the local densites (the density was generated in the unrotated coordinate system).
<P>
<FONT size="+1"><tt>--band~rot=</tt></FONT> is necessary because lmf will not automatically rotate
the k-points read from the <FONT size="+1"><tt>syml</tt></FONT> file.

<P>
Run modifed band pass calculation and compare
<FONT size="+1"><tt>bnds.cu</tt></FONT> with 
<FONT size="+1"><tt>bnds.cu-pwmode11</tt></FONT>.
You should see that the <i>k</i>-points are different, but that the
bands are essentially identical.  (There are slight differences
relating to the numerical instabilities in the overlap originating from the
addition of APW's.)

This shows that the bands are replicated in the rotated coordinate system.

<P>

Finally, modify <FONT size="+1"><tt>syml.cu</tt></FONT> by uncommenting the first line so it reads:
<pre>
% map kz=(q^2+.01^2-qx^2-qy^2)^.5*(qz>0?1:-1)
</pre>
and repeat the <b>lmf</b> band pass.  You should see that <i>k<sub>x</sub></i> and
<i>k<sub>y</sub></i> are unchanged, but <i>k<sub>z</sub></i> is slightly modified.
Similarly the bands are slightly modified.

