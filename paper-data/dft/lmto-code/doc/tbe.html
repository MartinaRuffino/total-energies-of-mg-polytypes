<!DOCTYPE html><html>

<head>
<title>TBE: empirical tight binding</title>
<style>

/* For hyperlinks */
a:link {color:#FF0000;}      /* unvisited link */
a:link {color:#222288;}      /* unvisited link */
a:visited {color:#228822;}  /* visited link */
a:hover {color:#FF00FF;}  /* mouse over link */
a:active {color:#0000FF;}  /* selected link */
a:link {text-decoration:none;}
a:visited {text-decoration:none;}
a:hover {text-decoration:underline;}
a:active {text-decoration:underline;}


body {
       background-color:#ffffgg;
     }
 h1 {
      color:#880000;
      text-align:center;
      font-size:12px;
    }
 h2 {
      color:#bb3300;
      font-size:120%;
      font-weight:normal;
      font-style:italic;
    }

 h3 {
      color:#33bb00;
      font-size:110%;
      font-weight:normal;
      font-style:italic;
      text-indent: 0.5em;
    }

 h4 {
      color:#000000;
      font-size:100%;
      font-weight:bold;
      text-indent: 1.0em;
    }

 h5 {
      color:#444488;
      font-size:100%;
      font-weight:bold;
      font-style:normal;
      text-indent: 1.5em;
    }

 hn {
      color:#000000;
      font-size:100%;
      font-weight:normal;
      font-style:normal;
      text-indent: 1.5em;
    }

  P {
<!--  font-family:"Times New Roman"; -->
<!--  font-size:12px; -->
<!--  color: red; -->
    }

  q {
      color: red;
    }

  a {
        color: blue;
    }

  tlarge {
       <font-size="+1">
    }

  p.pos_left
  {
  position:relative;
  left:-20px;
  }

  p.pos_right
  {
  position:relative;
  left:20px;
  right:520px;
  }

div.ex
{
width:3in;
padding:10px;
border:5px solid gray;
margin:0px;
}


</style>

<!-- Enables the use of latex -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]}
  });
</script>

<!--
<script type="text/javascript"  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script>
<script type="text/javascript" src="/Users/markvanschilfgaarde/MathJax/MathJax.js"></script>
-->

</head>

<h1><B><FONT size="+2">TBE: empirical tight binding (v9.14)</FONT></b></h1>

<H1><B><FONT size="+2">Empirical tight binding</FONT></B></H1>
<pre>
  Written by Mark van Schilfgaarde, John Klepeis, Tony Paxton, Sasha Lozovoi, Dimitar Pashov
  Bugs and comments to <A HREF=MAILTO:Tony.Paxton@kcl.ac.uk>Tony.Paxton@kcl.ac.uk</A>
  Documentation for Version 9.14 June 2014 (lm v7.11)
</pre>

<OL>
 <LI> <A HREF=#section1>Background, and specification of matrix elements</A>
 <LI> <A HREF=#section2>The <b>TB</b> and <A HREF="tokens.html#STARTcat">START</A> categories</A>
 <LI> <A HREF=#section3>Self consistent, polarisable ion, tight binding</b></A>
 <LI> <A HREF=#section4>Magnetic tight binding</A>
 <LI> <A HREF=#section5>Molecular dynamics and statics</A>
 <LI> <A HREF=#section6>Band and DOS plotting</A>
 <LI> <A HREF=#section7>tbe-specific switches</A>
 

<H2><A name="section1"><FONT size="+1"><FONT size="+1">
1.  Background, and specification of matrix elements
 </FONT></FONT></A></H2>
<P>
Initially the TBE program was written to make quick and easy TB calculations in 
the spirit of the early work by <A HREF="#Chadi">Jim Chadi [1]</A> and Walter Harrison. See 
<A HREF="#Walt">Walt's book [2].</A>
Later, after the invention of the <A HREF="#PITB-PRL">polarisable ion tight binding theory [3]</A>,
the code became much more sophisticated and now includes charge and
spin self consistency, molecular statics and dynamics. The theory has now been described in detail
in <A HREF="#FinnisBook">Mike Finnis's book [4]</A> and in <A HREF="#Paxton">Tony Paxton's lecture notes [5]</A>.
Magnetic tight binding is explained in <A HREf="#PaxFin">Paxton and Finnis [6]</A>.
<P>
The empirical tight binding was built around the ASA package so as to exploit the
sparse matrix handling, symmetrisation, BZ integration and so on. As a
result, some ASA tokens are sought from <tt>ctrl</tt>, even if they are
not used. An example is the sphere radius, or R/W, which is a
<i>compulsory</i> token. Another awkward consequence is the reading of
the hamiltonian matrix elements which is done via two passes through
the control file after the driver program,
<b>tbzint</b>, has been called. There is not unlimited scope for
specification of the hamiltonian; modern environment dependent
matrix elements or complicated functions of distance are not catered
for.  In such cases the user will have to extend the code, possibly by
enabling a disc read of tabulated functions, or an adaptation of the
segment <B>tbham.f</B>.

Diagonal matrix elements are read from the <A HREF=#section2>START category</A>.
Off diagonal matrix elements of the hamiltonian, overlap and the pair
potential are read from <tt>ctrl</tt> at the ME category, having the
following syntax.

<PRE>
ME    is a category that tells the program what hamiltonian matrix
      to use. It begins with an integer, which defines a mode
      to specify the form of matrix elements.  
      `mode' is one of:
         0  to indicate that the hopping integrals are fixed
         1  to use the Harrison universal matrix elements for
            semiconductors
         2  for exponential decay
         3  for inverse power decay
         4  general power * exponential decay
         5  for Goodwin Skinner Pettifor (GSP) scaling 
</PRE>

Each mode has a group of numbers of input, whose meaning (and number)
depend on the mode.  But for each mode, the hamiltonian is specified
by a pattern like this:
<PRE>
ME  <I>mode</I>
    name1  name2 | (set-of-numbers-specifying-matrix-elements)
</PRE>
name1 and name2 indicate the two species of atoms as referenced in the 
<A HREF="tokens.html#SPECcat">SPEC category</A>
of the ctrl file; the bar (|) indicates
that a set of numbers will follow; how many numbers and what they mean depends on  <I>mode</I>.

<BR><BR>
<I>Mode 0</I>: matrix elements are fixed to constant values, independent
of, e.g. bond length <I>d</I>.  The hamiltonian matrix elements are given as
a string of numbers.  Following the bar (|) 10 numbers are read in:
<PRE>
     ss&sigma;, sp&sigma;, pp&sigma;, pp&pi;,  
     sd&sigma;, pd&sigma;, pd&pi;, dd&sigma;,
     dd&pi;, dd&delta; 
</PRE>
These are integrals <i>V<sub>ij</sub></i>, read in the order shown.

<BR>
<I>Mode 1</I>: matrix elements follow Harrison's universal form from <A HREF="#Walt">his Solid State Table [2].</A>
<P>
  That is:
  <i>V<sub>ij</sub></i> = <i>&eta;<sub>ij</sub> hbar<sup>2</sup> / md<sup>2</sup></i>

<PRE>
     <i> &eta;<sub>ss&sigma;</sub>  </i> = -1.32 eV
     <i> &eta;<sub>sp&sigma;</sub>  </i> = +1.42 eV
     <i> &eta;<sub>pp&sigma;</sub>  </i> = +2.22 eV
     <i> &eta;<sub>pp&pi;</sub>  </i> = -0.63 eV
</PRE>

In this mode, the user does not specify any rules for matrix elements.  Note that 
this mode is suitable to <i>sp</i> semiconductors only.

<BR><BR>
<I>Modes 2 and 3</I>: additional information is supplied about the
dependence of the matrix element on bond length <I>d</I>.  Mode 2 uses
an exponential decay; Mode 3 a power law decay.
<br>
For each matrix element two coefficients (<i>a</i> and <i>b</i>) are required to define a matrix element:
<PRE>
  <i>V</i> = <i>a</i>&times;<i>e<sup>-b d</SUP> </i> (exponential decay) or <i>V</i> = <i>a</i>&times;<i>d<sup>-b</SUP></i> (power law decay)
</PRE>

Coefficients <i>a</i> are specified as a vector of 10 (or fewer)
numbers, in the same format as Mode 0 above.<br> The decay
parameters <i>b</i> are specified by a vector following token <FONT size="+1"><tt>DECAY=</tt></FONT>.
<b>Important note:</b> For ME modes 2 and 3, <FONT size="+1"><tt>DECAY=</tt></FONT> expects to read the
quantities <i>b</i> as <b>positive</b> numbers. <tt>tbe</tt> will make "sanity checks" on the parameters
to identify any sign errors.
<br>

For example, in the canonical <i>d</i> band model of <A HREF="#SD84">Spanjaard and Desjonqueres [7]</A>, we would write:

<PRE>
    ME      2 
            1 1  | 0 0 0 0 0 0 0 -fd*6 fd*4 -fd  
                   DECAY=0 0 0 0 0 0 0 q q q
</PRE>

You can specify a global default decay coefficient.
If an explicit specification is omitted for a particular pair,
the default value is used.  Specify the default parameter with 
token <FONT size="+1"><tt>DECAY0=</tt></FONT>, after the ME mode specification.
The <A HREF="#SD84">Spanjaard and Desjonqueres [7]</A> rule could thus have been specifed as:
<PRE>
    ME      2  DECAY0=q
            1 1  | 0 0 0 0 0 0 0 -fd*6 fd*4 -fd  
</PRE>

<BR>

<I>Mode 4</I>: the matrix element takes the form
<BR>
<DD>
         <span>&Sigma;</span><SUB><I>i</I></SUB> a<SUB><I>i</I> </SUB><I>d</I><SUP>b<SUB><I>i</I></SUB></SUP> exp(-c<SUB><I>i</I></SUB><I>d</I>)</I>
</DD>
<BR>
where <I>i</I>=1..3 and <I>d</I> is bond length. Thus, each matrix element requires 9 numbers as input.  
<BR>
The nine numbers after the bar (|) are the three groups of <i>a b c</i> parameters.

<BR><BR>
<I>Mode 5</I>: The Goodwin-Skinner-Pettifor matrix elements take the form
<DD>
        V (r<SUB>0</SUB>/d)<SUP>n</SUP> exp[n(-{d/r<SUB>c</SUB>}<SUP>n<SUB>c</SUB></SUP>+{r<SUB>0</SUB>/r<SUB>c</SUB>}<SUP>n<SUB>c</SUB></SUP>)]
</DD>
<BR>
In this mode, each matrix element requires 5 numbers, read in the order 
<PRE>
        V n n<SUB>c</SUB> r<SUB>0</SUB> r<SUB>c</SUB>
</PRE>
     For example, a hamiltonian with <i>s</i> and <i>p</i> orbitals would read:
<PRE>
     ME  5
             1 1 | ss&sigma; n nc r0 rc
                   sp&sigma; n nc r0 rc
                   pp&sigma; n nc r0 rc
                   pp&pi;    n nc r0 rc
</PRE>

<BR>
<I>Empirical pair potential</I>: Many tight-binding hamiltonians adopt a classical
pair potential (energy) to stabilize the lattice at its equilibrium spacing.
A pair potential may be specified by a shriek (!); the format follows
the power-law-exponential decay format, i.e.
<DD>
       <span>&Sigma;</span><SUB><I>i</I></SUB> a<SUB><I>i</I> </SUB>d<SUP>b<SUB><I>i</I></SUB></SUP> exp(-c<SUB><I>i</I></SUB><I>d</I>)</I>
</DD><BR>
where <I>i</I>=1..3. The nine numbers after the shriek are the three groups of <i>a b c</i> parameters.
In the canonical model of <A HREF="#SD84">Spanjaard and Desjonqueres [7]</A>, the hamiltonian and pair potential
are thus specified as:
<PRE>
      ME      2 
              1 1  | 0 0 0 0 0 0 0 -fd*6 fd*4 -fd  
                     DECAY=0 0 0 0 0 0 0 q q q
              1 1  ! b 0 p   0 0 0    0 0 0       
</PRE>


<BR>
If the power exponents are positive, then the pair potential does not take the above form
but <A HREF="#Chadi">Chadi's form [1]</A> instead, namely 
<i>a<SUB>1</SUB>&epsilon;</i> +  <i>a<SUB>2</SUB>&epsilon;<SUB>2</SUB></i>: 
the third number in each set is the equilibrium bond length.

<BR>
A line such as this
<PRE>
       ! A 1 -1 n nc r0 rc 0 0
</PRE>
implements a pair potential of the GSP form. The last two numbers
should be zero for the standard GWP potential.  If they are nonzero,
an exponential or power law is <I>added</I> to the GSP potential
depending whether the last number is positive (last number is decay) or negative
(last number is the power).  The second-last coefficient is the prefactor.

<BR><BR>

      Additional syntax enables the input of further parameters. Here is a complete
      list.
<PRE>
ME    [...]
      name1 name2 | rule for Hamiltonian
      name1 name2 ! rule for the classical repulsive pair potential
      name1 name2 @ rule for overlap
      name1 name2 & rule for crystal field
      name1 name2 % rule for crystal field-overlap

</PRE>
Of the last three all take
exactly the same number of parameters as the hamiltonian. (In general
an overlap matrix element will take the opposite sign to its
corresponding hamiltonian matrix element.) The last two implement Jim Chadi's
<A HREF="#ChadiXF">empirical crystal field scheme [8]</A>; to a large extent this is now superseded by 
<A HREF=#section3>self consistent tight binding with polarisable ions</A>. 
<P>

Note that if the basis is non orthogonal, then the overlap matrix elements must also
have their scaling specified by DECAY= and CUT= tokens.

<P>
The ME category also accepts these additional tokens, which may be specified 
differently for each species pair.
<PRE>
MEMODE=    In this way the mode can be different for different species pairs
POLY=      The degree of the cut-off polynomial (4 or 5)
CUTMOD=    cutoff mode							     
	   0 no cutoff							     
	   1 augmentative cutoff: all functions augmented with the cutoff polynomial 
	   2 multiplicative cutoff: all functions multiplied by the cutoff polynomial
	   (see <tt>poly45.f</tt> for more documentation)                                  
CUTPP=     cut off radii, <i>r<sub>1</sub></i> and <i>r<sub>1</sub></i>, the
           cut-off polynomial is defined on [<i>r<sub>1</sub></i>, <i>r<sub>1</sub></i>]
           so as to match value and slope at <i>r<sub>1</sub></i> and to have zero
           value and slope at <i>r<sub>2</sub></i>. <i>r<sub>1</sub></i> and <i>r<sub>1</sub></i> are expected
           in either bohr (a.u.) or units of <tt>ALAT</tt> depending on the value
           of the token SCALE= in category <A HREF="tokens.html#TBcat">TB</A>.
PPMODE=    0 no pair potential
           10 a sum of power law times exponential (up to three terms)
           20 Quadratic pair potential (see <A HREF="#Chadi">ref [1]</A>)
           21 sum of a polynomial defined in [0 < <i>r</i> < <i>r<sub>2</sub></i>] and two power law functions
           30 GSP
           32 GSP + power law decay 
           33 GSP + (a1*exp(-2r) + a2/r^6)*left_cutoff
           (see code segments <tt>makvp.f</tt> and <tt>vppder.f</tt> for full documentation)
</PRE>
<P>
If MEMODE= is set, there still needs to be a global mode set as the first number after the
"ME" string in the ME category. Here is an example for a case of two species "Fe" and "C" in 
which the values have been set in the <A HREF="tokens.html#CONSTcat">CONST category</A>. Note
it is not enough to give the "Fe C" parameters, the "C Fe" parameters must also be given. Indeed
they do not need to be the same. In this way the typical case in semiconductors can be covered:
say in GaAs, the <i>s</i>(Ga)-<i>p</i>(As) need not be equal to <i>p</i>(Ga)-<i>s</i>(As); however
only sp&sigma; and not ps&sigma; are specfied in each input line. <tt>tbe</tt> will take
care of symmetrising the hamiltonian in this case.

<PRE>
ME      2
        Fe Fe MEMODE=2 PPMODE=10 POLY=5 CUTMOD=cutmod CUTPP=r1pp rcpp
            | fss fsp fpp -fpp/2 fsd fpd -fpd/sqrt(3)
                                                 fdds fddp fddd
        DECAY=qss qsp qpp qpp    qsd qpd  qpd    qdds qddp qddd
        CUT=r1ss rcss 0 0 0 0 0 0 r1sd rcsd 0 0 0 0 r1dd rcdd r1dd rcdd r1dd rcdd
            @ oss osp opp -opp/2 osd opd -opd/sqrt(3)
                                                 odds oddp oddd
        DECAY=qoss qsp qpp qpp    qosd qpd  qpd    qdds qddp qddd
        CUT=r1ss rcss 0 0 0 0 0 0 r1sd rcsd 0 0 0 0 r1dd rcdd r1dd rcdd r1dd rcdd
            ! b0 m0 p0   b1 m1 p1   0 0 0

        C C MEMODE=CCmode PPMODE=10 POLY=5 CUTMOD=cutmod CUTPP=r1CC rcCC
            | fCCsss fCCsps fCCpps fCCppp 0 0 0 0 0 0
        DECAY=qssCC   qspCC    qppCC    qppCC     0 0 0 0 0 0
        CUT=  r1CC rcCC r1CC rcCC r1CC rcCC r1CC rcCC
              0 0  0 0  0 0  0 0  0 0  0 0
            @ oCCsss oCCsps oCCpps oCCppp 0 0 0 0 0 0
        DECAY=qssCC   qspCC    qppCC    qppCC     0 0 0 0 0 0
        CUT=  r1CC rcCC r1CC rcCC r1CC rcCC r1CC rcCC
              0 0  0 0  0 0  0 0  0 0  0 0
            ! bCC mCC pCC  0 0 0    0 0 0

        Fe C MEMODE=2 PPMODE=10 POLY=5 CUTMOD=cutmod CUTPP=r1CFpp rcCFpp
            | fCFss  fCFsp  0  0 fCFsd fCFpds fCFpdp 0 0 0
        DECAY=qCFss  qCFsp  0  0 qCFsd qCFpds qCFpdp 0 0 0
        CUT=  r1CFs rcCFs r1CFsp rcCFsp 0 0 0 0
              r1CFd rcCFd r1CFd  rcCFd r1CFd rcCFd 0 0 0 0 0 0
            @ oCFss  oCFsp  0  0 oCFsd oCFpds oCFpdp 0 0 0
        DECAY=qoCFss qoCFsp  0  0 qoCFsd qoCFpds qoCFpdp 0 0 0
        CUT=  r1CFs rcCFs r1CFsp rcCFsp 0 0 0 0
              r1CFd rcCFd r1CFd  rcCFd r1CFd rcCFd 0 0 0 0 0 0
            ! b0CF n0CF q0CF   b1CF n1CF q1CF  0 0 0
        C Fe MEMODE=2 PPMODE=10 POLY=5 CUTMOD=cutmod CUTPP=r1CFpp rcCFpp
            | fCFss  fCFsp  0  0 fCFsd fCFpds fCFpdp 0 0 0
        DECAY=qCFss  qCFsp  0  0 qCFsd qCFpds qCFpdp 0 0 0
        CUT=  r1CFs rcCFs r1CFsp rcCFsp 0 0 0 0
              r1CFd rcCFd r1CFd  rcCFd r1CFd rcCFd 0 0 0 0 0 0
            @ oCFss  oCFsp  0  0 oCFsd oCFpds oCFpdp 0 0 0
        DECAY=qoCFss qoCFsp  0  0 qoCFsd qoCFpds qoCFpdp 0 0 0
        CUT=  r1CFs rcCFs r1CFsp rcCFsp 0 0 0 0
              r1CFd rcCFd r1CFd  rcCFd r1CFd rcCFd 0 0 0 0 0 0
            ! b0CF n0CF q0CF   b1CF n1CF q1CF  0 0 0
</PRE>
<P>

Each species of atom may be given basis function orbitals up to <i>l=2</i>, that is,
<i>s</i>, <i>p</i> and <i>d</i>. To implement <i>f</i> orbitals would
require an impractically large rewrite of the code. The global token
<tt>NL=</tt> in
category <A HREF="tokens.html#STRUCcat">STRUC</A> specifies the
maximum number of <i>l</i>'s at any site, and the species specific
tokens <tt>IDXDN=</tt> in
category <A HREF="tokens.html#SPECcat">SPEC</A>. are used to specify
which orbitals are required for each species: as in the
ASA <tt>IDXDN=1</tt> includes an orbital in the basis
and <tt>IDXDN=3</tt> excludes it. Thus if
<tt>NL=3</tt>, a species with <tt>IDXDN=1 3 1</tt> will have an
<i>sd</i> basis, while a species with <tt>IDXDN=3 1 3</tt> 
has <i>p</i> orbitals only.

<P>
<H2><A name="section2"><FONT size="+1"><FONT size="+1">
2. The <A HREF="tokens.html#TBcat">TB</A> and <A HREF="tokens.html#STARTcat">START</A> categories
 </FONT></FONT></A></H2>
Most species-independent, <b>tbe</b>-specific input
is placed in category <A HREF="tokens.html#TBcat">TB (q.v.)</A>.
<P>
<A NAME="moments"></A>
The <A HREF="tokens.html#STARTcat">START</A> category is used to read in diagonal hamiltonian matrix
elements and the free-atom charges where needed.  
See the <A HREF="lmto.html#pbasp"> general description</A> of
parameters P and Q in the ASA documentation, and <A
HREF="lmto.html#START"> here</A> for the format of input tokens.

The P parameters must be set for consistency with the ASA, but they
are not used. The Q parameters which in the ASA correspond to the
<i>0th</i> <i>1st</i> and <i>2nd</i> moments, correspond in <b>tbe</b> to the
number of electrons, the on-site hamiltonian elements and the Hubbard
<i>U</i> for each class. <b>tbe</b> uses a hierarchy of choices to
determine the total number of electrons: if <tt>ZVAL=</tt> is set in
the <A HREF="tokens.html#BZcat">BZ</A> category it will use this
number; if not then it will taken
from <A HREF="tokens.html#STARTcat">START</A> as the
total <i>0<sup>th</sup></i> moment; if these are all zero, <b>tbe</b>
will use the (compulsory) atomic numbers, <tt>Z=</tt> in
category <A HREF="tokens.html#SPECcat">SPEC</A>.

<H2><A name="section3"><FONT size="+1"><FONT
size="+1"> 3. Self consistent, polarisable ion, tight binding
</FONT></FONT></A></H2> The theory is described in detail in
in <A HREF="#FinnisBook">Mike Finnis's book [4]</A> and in 
<A HREF="#Paxton">Tony Paxton's lecture notes [5]</A> and this
branch of <b>tbe</b> is designed to implement the scheme
<i> exactly</i> as written down there.
<P>
It is invoked by setting UL=T in category <A HREF="tokens.html#TBcat">TB</A>. Polarisability of each
species is specified through parameters called &Delta;<SUB><i>l'l''l</i></SUB>
They are entered in <FONT size="+1"><tt>ctrl</tt></FONT> at the token
<tt>QPOL=</tt> in category <A HREF="tokens.html#SPECcat">SPEC</A> which takes up to ten numbers of which
the first seven are 
<PRE>
        &Delta;<SUB>011</SUB> = &Delta;<SUB>101</SUB>
        &Delta;<SUB>112</SUB>
        &Delta;<SUB>022</SUB> = &Delta;<SUB>202</SUB>
        &Delta;<SUB>121</SUB> = &Delta;<SUB>211</SUB>
        &Delta;<SUB>222</SUB>
        &Delta;<SUB>123</SUB> = &Delta;<SUB>213</SUB>
        &Delta;<SUB>224</SUB>
</PRE>

<P>
The Hubbard <i>U</i> are read from category <A HREF="tokens.html#STARTcat">START</A>.
<P>
<A NAME="units">
<b>Important note on units:</b></A> in non self consistent mode <b>tbe</b> can in
principle take input in any consistent set of units (say, eV and angstrom); however
if <tt>UL=T</tt> is set, then input must be in atomic Rydberg units.
<P>
Token <tt>IODEL=</tt> amounts to a "restart" switch: <b>tbe</b> writes
the increments of the hamiltonian or the multipole moments of the
charge to disc and these can be read back in at the start of a new
calculation.
<P>
<A NAME="mixing">
Mixing is implemented in three modes.</A>
<ol>
 <li> The default is to mix the increments to the hamiltonian
 <li> The command line option <tt>--mxq</tt> enables mixing of the charge
 <li> The command line option <tt>--mxq2</tt> enables mixing of the charge and magnetic moment separately
 </ol>
<P>
Mixing parameters are set exactly as in ASA using the category <A HREF="tokens.html#ITERcat">ITER</A>, the
only option being Anderson mixing. 

Convergence is specified with respect to the <i>rms</i> difference in
charge through the token <tt>CNVG=</tt> in category <A HREF="tokens.html#STARTcat">START</A>, with
the maximum number of iterations following the token <tt>NIT=</tt>,
also in category <A HREF="tokens.html#STARTcat">START</A>.

<H2><A name="section4"><FONT size="+1"><FONT size="+1">
4. Magnetic tight binding
 </FONT></FONT></A></H2>
The most straightforward extension of the tight binding theory to magnetic systems, 
consistent with the local spin density approximation, is to add a term to the
second order hamiltonian,
<PRE>
     -(1/2)<span>&Sigma;</span><SUB><b>R</b></SUB> J<SUB><b>R</b></SUB> ( &delta;</>q<SUB><b>R</b></SUB>(up)<SUP>2</SUP> + &delta;</>q<SUB><b>R</b></SUB>(down)<SUP>2</SUP> )
</PRE>
which results in an additional term in the effective potential (see Pettifor,
<i>J. Magnetism and Magn. Materials</i>., <b>15-18</b>, 847 (1980))
<PRE>
     -(1/4)<span>&Sigma;</span><SUB><b>R</b></SUB> J<SUB><b>R</b></SUB> m<SUB><b>R</b></SUB>
</PRE>
in which <tt>m<SUB><b>R</b></SUB>=&delta;</>q<SUB><b>R</b></SUB>(up) -
&delta;</>q<SUB><b>R</b></SUB>(down)</tt> is the magnetic moment at
site <b>R</b>. This is a spin-dependent, but orbital
<i>in</i>dependent potential as long as the Stoner parameter <i>J</i>
is averaged over the basis orbitals at site <b>R</b>. The orbital and
spin dependent equivalent of LDA+<i>U</i> is TB+<i>U</i> and is still
under development.

The Stoner parameters are taken from <tt>ctrl</tt> in category <A HREF="tokens.html#SPECcat">SPEC</A>
at the token <tt>JH=</tt> which takes <tt>nl</tt> values which are the <i>J</i>
parameters for each <i>l</i>-channel. This is consistent with the syntax used
in the LDA+<i>U</i> implementation in <b>lmf</b> <A HREF="fp.html">(q.v.)</A>; as
with the Hubbard <i>U</i> these are averaged over the site internally.

Mixing can be tricky in magnetic metals and further work may be
needed. By setting the command line option --mxq2
it is possible to use the functionality of the MIX structure 
in  the category <A HREF="tokens.html#ITERcat">ITER</A>
to make a repeating sequence of mixing charge and magnetic
moment separately or together using different Anderson &beta; parameters:
token <tt>b=</tt> sets the mixing for the charge and 
token <tt>bv=</tt> sets the mixing for the moment. If either
of these are zero for a short sequence then only the other 
quantity is mixed. The other two schemes, <A HREF=#mixing>above</A>, are implemented
except in the case of a non orthogonal basis, in which case only charge
mixing is possible. The magnetic symmetry needs to be broken at the
start of a calculation (unless the restart option <tt>IODEL=T</tt> is
used and a legal restart file from a magnetic state can be found on
disc). For potential mixing (the default) the up and down on-site
energies must be split and this is done in <tt>ctrl</tt> using the
token <tt>DELTA=</tt> in category <A HREF="tokens.html#SITEcat">SITE</A>.  For example in the
test file <tt>ctrl.fecr</tt> there are the lines
<PRE>
SITE    ATOM=Cr POS= 0 0 0         DELTA=0 0 -deltaCr 0 0 deltaCr
        ATOM=Fe POS= 1 0 0+dz+ddz  DELTA=0 0 -deltaFe 0 0 deltaFe
</PRE>
which split the the <i>d</i>-electron on-site energies by plus and minus 
<tt>delta</tt>; NB this is a ferromagnetic starting state: reversing the signs on
one of the atoms would provide an antiferromagnetic starting state. Self consistency
will flip these back if there is no local antiferromagnetic solution. In the case
of charge mixing, invoked by the command line option <tt>--mxq[2]</tt> the input
charge must have a magnetic moment, achieved by adjusting the input <i>0th</i>
moments in category <A HREF="tokens.html#STARTcat">START</A> as described <A HREF=#moments>above</A>. Here
are the lines in the <b>START</b> category from the test file <tt>ctrl.fecr</tt>
(Again, an antiferromagnetic starting state could be made by using 
<tt>momCr={nsp==1?0:-3}</tt>, say.
<PRE>
%const nsp=2 spd=1 NdFe=6 NdCr=4
CONST   q0s={spd?1:0} q0p=0 q0dFe={spd?7:NdFe} q0dCr={spd?5:NdCr}
        esFe=0.2 epFe=0.45 edFe=-0.01 momFe={nsp==1?0:3}
        esCr=0.2 epCr=0.45 edCr=0.01  momCr={nsp==1?0:3}
        U=1 Us=U Up=U UdFe=U UdCr=U
START   CNTROL=T NIT={nitq} CNVG=qtol
        ATOM=Fe   P= 4 4 3 4 4 3
                  Q= q0s/{nsp}            esFe   Us
                     q0p/{nsp}            epFe   Up
                     (q0dFe+momFe)/{nsp}  edFe  UdFe
                     q0s/{nsp}            esFe   Us
                     q0p/{nsp}            epFe   Up
                     (q0dFe-momFe)/{nsp}  edFe  UdFe
        ATOM=Cr   P= 4 4 3 4 4 3
                  Q= q0s/{nsp}            esCr   Us
                     q0p/{nsp}            epCr   Up
                     (q0dCr+momCr)/{nsp}  edCr  UdCr
                     q0s/{nsp}            esCr   Us
                     q0p/{nsp}            epCr   Up
                     (q0dCr-momCr)/{nsp}  edCr  UdCr
</PRE>
Note the use of the value of the token <tt>NSPIN={nsp}</tt> from category 
<A HREF="tokens.html#OPTIONScat">OPTIONS</A> to split the spins in the spin polarised case, yet to provide the
correct input moments in the non spin polarised case also (<tt>nsp=1</tt>).
<P>
It's important to understand the role of the token <tt>NSPIN={nsp}</tt> in category 
<A HREF="tokens.html#OPTIONScat">OPTIONS</A> as interpreted by <b>tbe</b>. If token <tt>UL=F</tt> in category
<b>TB</b> then <b>tbe</b> will do <i>non</i> self consistent tight
binding, in which case <tt>NSPIN=2</tt> turns on the empirical spin orbit coupled branch of the code
(not documented). Alternatively if token <tt>UL=T</tt> in category
<b>TB</b>, <b>tbe</b> will do self consistent tight binding which does not include
empirical spin orbit coupling; in that case the token <tt>NSPIN=2</tt> in category 
<A HREF="tokens.html#OPTIONScat">OPTIONS</A> tells <b>tbe</b> to make a magnetic tight binding
calculation.
<P>

<H2><A name="section5"><FONT size="+1"><FONT size="+1">
5. Molecular dynamics and statics
 </FONT></FONT></A></H2>
Conventions are in line with the input syntax in <b>lmf</b> and the
<b>mol</b> code. Molecular dynamics NVE, NVT and NpT ensembles are implemented
in the code segment <tt>verlet.f90</tt> using exactly the reversible integrators
employing Liouville operators
published by <A HREF="#Martyna">Martyna <i>et al.</i> [9]</A>. Here is the relevant section
from invoking <tt>tbe --input</tt>

<PRE>
 --- Parameters for dynamics and statics ---
 DYN_NIT           opt    i4       1,  1          default = 1
   maximum number of relaxation steps (statics) or time steps (dynamics)
 DYN_MSTAT         opt    ---
   Parameters for molecular statics
 DYN_MSTAT_MODE    reqd   i4       1,  1          default = 0
   0: no relaxation  4: conjugate gradients  5: Fletcher-Powell  6: Broyden
 DYN_MSTAT_HESS    opt    lg       1,  1          default = T
   Read hessian matrix
 DYN_MSTAT_XTOL    opt    r8       1,  1          default = 1e-3
   Convergence criterion in displacements
   XTOL>0: use length;  <0: use max val;  =0: do not use
 DYN_MSTAT_GTOL    opt    r8       1,  1          default = 0
   Convergence criterion in gradients
   GTOL>0: use length;  <0: use max val;  =0: do not use
 DYN_MSTAT_STEP    opt    r8       1,  1          default = 0.015
   Initial (and maximum) step length
 DYN_MSTAT_NKILL   opt    i4       1,  1          default = 0
   Remove hessian after NKILL iter
 DYN_MSTAT_PDEF    opt    r8v      6,  1          default = 0 0 0 ...
   Lattice deformation modes
 DYN_MD            opt    ---
   Parameters for molecular dynamics
 DYN_MD_MODE       reqd   i4       1,  1          default = 0
   0: no MD 1: NVE 2: NVT 3: NPT
 DYN_MD_TSTEP      opt    r8       1,  1          default = 20.671
   Time step (a.u.)
 DYN_MD_TEMP       opt    r8       1,  1          default = 0.00189999
   Temperature (a.u.)
 DYN_MD_TAUP       opt    r8       1,  1          default = 206.71
   Thermostat relaxation time (a.u.)
 DYN_MD_TIME       reqd   r8       1,  1          default = 20671000
   Total MD time (a.u.)
 DYN_MD_TAUB       opt    r8       1,  1          default = 2067.1
   Barostat relaxation time (a.u.)
 DYN_MD_P          opt    r8       1,  1          default = 0
   External pressure
 NB: 1 deg.K = 6.3333e-6 a.u.; 1 fs = 20.67098 a.u.
</PRE>
Category <A HREF="tokens.html#DYNcat">DYN</A> refers to both statics and dynamics which are
chosen by reference to the token <tt>MODE</tt> set in either the MD or
MSTAT structures. MODE=1-3 is reserved for the three MD ensembles and
MODE=4-6 sets the energy minimisation algorithm: Conjugate Gradients,
Fletcher-Powell and Broyden respectively. <A HREF=#units>Units</A>
must be in atomic Rydbergs: useful conversion factors are included in
the segment of output (above). Here's an example few lines from a
typical <tt>ctrl</tt> file:
<PRE>
DYN
% const dyn=0 temp=300 taup=10 taub=100 time=100000 tstep=0.5
% const hess=F relax=0 nit=50 xtol=1d-3 gtol=5d-4 step=0.01 nkill=100 nitf=50
% const fs=0.048377 K=1/0.6333328d-5
% if dyn==1|dyn==2|dyn==3
        MD[MODE={dyn} TSTEP={tstep/fs} TEMP={temp/K} TAUP={taup/fs}
           TIME={time/fs} TAUB={taub/fs} P=0]
% elseif relax>0
        MSTAT[MODE={relax} HESS={hess} XTOL={xtol} GTOL={gtol}
              STEP={step} NKILL={nkill}] NIT={nitf}
% endif        
</PRE>
For MD the mass of the atom is read from category
<A HREF="tokens.html#SPECcat">SPEC</A>. As always units are Rydberg a.u. so for example
the <A HREF="tokens.html#SPECcat">SPEC</A> category may reference a carbon atom as
<PRE>
% const amass=1.09716d-3
        ATOM=C Z=6 R=R/W AMASS=12.0107/{amass}
</PRE>


<H2><A name="section6"><FONT size="+1"><FONT size="+1">
6. Band and DOS plotting
 </FONT></FONT></A></H2>
The command line option <tt>--band[options]</tt> turns on the band plotting. The options
are as described in  <A HREF="generating-energy-bands.html">ASA documentation</A>. In the case
of non self consistent tight binding, <tt>tbe --band</tt> will only plot bands;
if <tt>UL=T</tt> is set then <b>tbe</b> will make the hamiltonian self 
consistent before plotting bands. It will be quicker in that case to invoke
<b>tbe</b> with <tt>IODEL=T</tt>. In either case <b>tbe</b> looks for the
Fermi energy on disc. This may be overidden on the command line, as in the  
<A HREF="generating-energy-bands.html">ASA,</A> with <tt>~ef=#</tt>. 
<P>
Fermi surface plotting and Brillouin zone mapping are not currently implemented
in <b>tbe</b>. 
<P>
For plotting the <i>total</i> DOS, the switch <tt>SAVDOS=</tt> in category <b>BZ</b> 
dumps out a file that can be read by the program <tt>pldos.f</tt> which is in the
distribution. There is also an option to make Mulliken decomposed densities which
interfaces with the ASA program <b>lmdos.f</b> 
(<A href="lmto.html#section9lmdos">q.v.</A>) The procedure is to set the <tt>MULL=</tt>
token to the required value in category <b>BZ</b>. <tt>MULL=</tt> takes an integer
whose <i>one's</i> digit translates to a parameter <tt>mull1</tt> that describes
how the charge on site is deconstructed (by atom, <i>l</i> or <i>lm</i>); whose
<i>ten's</i> digit enables bond order output (<tt>mull2</tt>); and whose <i>100's</i>
digit sets a parameter <tt>imfil</tt> that points to an ASCII input file holding
details of what decomposition is required. The specification of these three parameters
is as follows (see also the segment <tt>mkwttb.f</tt>)
<PRE>
   For (mull=0,1; imfil=0) all the partial DOS channels are generated
     automatically.  All of the angular momentum channels for a given
     atom appear consecutively in the DOS file (see below for specific
     ordering).  The atom ordering follows the class indices for
     (mull=0) and the basis indices for (mull=1).  In the case of
     (nsp=2) all of the spin up channels for a given atom or class
     appear consecutively followed by all of the spin down channels
     for the same atom or class.

  For (mull=0,1; imfil=1) the partial DOS channels are specified in
    the file MULL using the class indices (mull=0) or the basis
    indices (mull=1) and the angular momentum indices below.  The
    format of the lines in this free format file is:

      <ang mom ind 1> <atom ind 1>
      ...

    In the case of (nsp=2) the choice of spin up or down is specified
    in the file MULL by choosing the appropriate lm index (see below).

  For (mull=10,11; imfil=0) the bond charge is automatically
    generated for all atom pairs.  The ordering of the channels is
    done according to the class indices for (mull=10) and the basis
    indices for (mull=11).  The ordering is as follows:

         (mull=11)            (mull=10)

      Atom 1   Atom 2      Atom 1   Atom 2    
      ------   ------      ------   ------
         1        1           1        1    On-site contribution
         1        2           1        1    All others (if existent)
         1        3           1        2
       ...      ...         ...      ...       
         2        2           2        2    On-site contribution
         2        3           2        2    All others (if existent)
         2        4           2        3
       ...      ...         ...      ...

  For (mull=10,11, imfil=1) the bond charge DOS channels are specified
    in the file MULL using the class indices (mull=10) or the basis
    indices (mull=11).  The format of the lines in this free format
    file is:

      <atom ind 1> <atom ind 2> <ionsit>
      ...

     The switch (ionsit) must always be present and must be equal to
     zero unless [mod(mull,10)=0] and the two atom class indices are
     the same.  In this case (ionsit=1) refers to the on-site
     contribution and (ionsit=0) refers to all other contributions
     (if they exist).

   For (mull=20,21) and (mull=30,31) the atoms are indexed according
     to the class index (mull=20,30) or the basis index (mull=21,31).
     Ths DOS channels are specified in the file MULL using these atom
     indices and the angular momentum indices indicated below.  The
     format of the lines in this file is (free format):

       <lm ind 1> <atom ind 1> <lm ind 2> <atom ind 2> <ionsit>
       ...

     The switch (ionsit) is the same as for (mull=10,11; imfil=1)

     In the case of (nsp=2) the spin combination is specified in the
     file MULL by choosing the appropriate lm indices (see below).

   The angular momentum channels for each atom or class for
     (mull=0,20,21) are indexed as follows:
       lm = 1 : s
       lm = 2 : p (summed over m = -1, 0, 1)
       lm = 3 : d (summed over m = -2, -1, 0, 1, 2)
       ...

     In the case of (nsp=2) all of the spin up lm indices appear
     consecutively followed by all of the spin down lm indices
     (i.e. if nl=2 then lm=4 corresponds to spin down p).

   The angular momentum channels for each atom or class for
     (mull=1,30,31) are indexed as follows:
       lm = 1     : s
       lm = 2,3,4 : p_x, p_y, p_z
       lm = 5-9   : d_xy, d_yz, d_zx, d_(x<SUP>2</SUP>-y<SUP>2</SUP>), d_(3z<SUP>2</SUP>-r<SUP>2</SUP>)
       ...

     In the case of (nsp=2) all of the spin up lm indices appear
     consecutively followed by all of the spin down lm indices
     (i.e. if nl=2 then lm=6 corresponds to spin down p_x).

   The DOS channels are symmetrized if needed [ng > 0 and
     mod(mull,10) = 1] for (mull=1,11,21).  No symmetrization is done
     for (mull=30,31) and for (mull=1, L > 2) and therefore the full
     BZ should be used (no special points) or symmetry-equivalent
     channels should be averaged.
</PRE>
Once <b>tbe</b> has run the DOS is to be contructed using 
<PRE>lmdos --dos:tbdos:[other switches ..] ext</PRE>
using the program <A href="lmto.html#section9lmdos">lmdos</A> from the ASA suite.
In the spin polarised tight binding, use
<PRE>lmdos --dos:tbu:[other switches ..] ext</PRE>
When invoking <tt>lmdos</tt>, take care to use the same command line switches
as used to invoke <tt>tbe</tt>, if for example the number of <b>k</b>-points
or spins is different from that specified in <tt>ctrl</tt>. The program
<b>pldos.f</b> in the distribution <tt>FPLOT.*.gz</tt> may used like 
<PRE>pldos -fplot dos.ext</PRE>
to produce a file <tt>dosp.dat</tt> containing columns of data that may be used
in a third party plotting package.

<H2><A name="section7"><FONT size="+1"><FONT size="+1">
7. tbe-specific switches <b>tbe</b>
 </FONT></FONT></A></H2>

<P>The following are command line options specific to <b>tbe</b>.
<PRE>
  --mxq           do charge mixing

  --mxq2          mix spin and charge separately

  --efield=#,#,#  (MOL=T only) apply an electric field (atomic Rydberg units)

  --st           start new MD run (otherwise <b>strt</b> is read); begin new md, mv and xyz files

  --md=#         in MD write info to the <b>md</b> file every # timesteps

  --mc=#         in MD or static relaxation write to the xbs <b>mv</b> file every # steps

  --xyz=#        in MD or static relaxation write to a standard <b>xyz</b> file every # steps
  
  --leanrho      in MPI, try to save memory at the expense of some communication

  MPI process mapping options. In most cases the default mapping is the optimal choice

  --kblocks      Number of rectangular processor blocks over which to distribute the k-points

  --nprows       Number of rows of the ScaLAPACK/BLACS process arrays/blocks.

</PRE>


<h2><A name="references"></A>References</h2>

<FN ID="Chadi"><P>
<b>1.</b> D. J. Chadi, <i>Phys. Rev. Lett.,</i> <b>41</b>, 1062 (1978)
</FN>
<FN ID=Walt><P>
<b>2.</b> W. A. Harrison, <i>Electronic structure and the properties of solids, the physics 
of the chemical bond,</i> (W. H. Freeman, San Francisco) 1980 (now published by Dover)
</FN>
<FN ID=PITB-PRL><P>
<b>3.</b>  M. W. Finnis, A. T. Paxton, M. Methfessel and M. van Schilfgaarde, <i>Phys. Rev. Lett.,</i>
<b>81</b>, 5149 (1998)
</FN>
<FN ID=FinnisBook><P>
<b>4.</b>  M. W. Finnis, <i>Interatomic forces in condensed matter,</i> (OUP, Oxford) 2003
</FN>
<FN ID=Paxton><P>
<b>5.</b> A. T. Paxton, in Multiscale Simulation Methods in Molecular
Sciences, NIC series, Vol. 42, edited by J. Grotendorst, N. Attig,
S. Bluegel, and D. Marx (Institute for Advanced Simulation,
Forschungszentrum Julich) 2009 pp. 145-174.
Available on-line at
<A HREF="http://webarchiv.fz-juelich.de/nic-series/volume42/volume42.html" TARGET=TOP>
http://webarchiv.fz-juelich.de/nic-series/volume42/volume42.html</A>
</FN>
<FN ID="PaxFin"><P>
<b>6.</b> A. T. Paxton and M. W. Finnis, <i>Phys. Rev. B,</i> <b>77</b>, 024428 (2008)
</FN>
<FN ID=SD84><P>
<b>7.</b> D. Spanjaard and M. C. Desjonqueres, <i>Phys. Rev. B,</i> <b>30</b>, 4822 (1984)
</FN>
<FN ID="ChadiXF"><P>
<b>8.</b> D. J. Chadi, in <i>Atomistic simulation of materials: beyond pair potentials,</i>, ed. V. Vitek and D. J.
Srolovitz, (Plenum Press, New York), p. 309,  1989 (ISBN-l3: 978-1-4684-5705-6,  e-ISBN-13: 978-1-4684-5703-2
DOl: 10.1007/ 978-1-4684-5703-2)
</FN>
<FN ID="Martyna"><P>
<b>9.</b> G. J. Martyna, M. E. Tuckerman, D. J. Tobias and M. L. Klein,
<i>Molecular Physics,</i> <b>87</b>, 1117 (1996)
</FN>

<BR><BR><BR><BR><BR><BR><BR><BR>

</HTML>
